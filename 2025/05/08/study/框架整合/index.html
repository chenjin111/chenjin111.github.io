<!DOCTYPE html>
<html>
  <!-- meta/link... -->
  



<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <!-- Global site tag (gtag.js) - Google Analytics -->


  <title>框架整合 | 学习之路</title>

  <link rel="icon" type="image/jpeg" href="/medias/hexo-logo.jpg">
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1911880_c1nvbyezg17.css">
  <link href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="/js/swiper/swiper@5.4.1.min.css" rel="stylesheet">
  
  
  
  
<link rel="stylesheet" href="/css/animate.min.css">

  
<link rel="stylesheet" href="/css/style.css">

  
  
    <link href="https://unpkg.com/@fancyapps/ui@5.0/dist/fancybox/fancybox.css" rel="stylesheet">
  
  
    
<link rel="stylesheet" href="/js/shareJs/share.min.css">

  
  <style>
        @media (max-width: 992px) {
            #waifu {
                display: none;
            }
        }
    </style>
    <script defer src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

    
    
    <!-- 依赖于jquery和vue -->
    <script src="https://unpkg.com/jquery@3.5.1/dist/jquery.min.js"></script>
    <script src="https://unpkg.com/vue@2.6.11/dist/vue.min.js"></script>

    <!-- import link -->
    
        
            
        
            
        
    
    <!-- import script -->
    
        
            
        
            
        
    

<meta name="generator" content="Hexo 7.3.0"></head>

  
  <!-- 预加载动画 -->
  
  
  <div class="preloader_6" id="loader">
  <div class="loader"></div>
</div>
  <script>
    var endLoading = function () {
      document.body.style.overflow = 'auto';
      document.getElementById('loader').classList.add("loaded");
    }
    window.addEventListener('DOMContentLoaded', endLoading);
  </script>


  <body>
    <!-- 判断是否为暗黑风格 -->
    <!-- 判断是否为黑夜模式 -->
<script defer>
  let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');

  if (isDark) {
    $(document.body).addClass('darkModel');
  }
</script>

    <!-- 需要在上面加载的js -->
    <script>
  function loadScript(src, cb) {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }

  //https://github.com/filamentgroup/loadCSS
  var loadCSS = function (src) {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  };

</script> 

<!-- 轮播图所需要的js -->
<script src="/js/swiper/swiper.min.js"></script>
<script src="/js/swiper/vue-awesome-swiper.js"></script>
<script src="/js/swiper/swiper.animate1.0.3.min.js"></script>

<script type="text/javascript">
  Vue.use(window.VueAwesomeSwiper)
</script>


  <script src="/js/vue-typed-js/index.js"></script>


<!-- 首页的公告滚动插件的js需要重新加载 -->
<script src="/js/vue-seamless-scroll/index.js"></script>

<!-- 打字机效果js -->
<script src="https://unpkg.com/typed.js@2.0.11"></script>


    <div id="safearea">
      <main class="main" id="pjax-container">
        <!-- 头部导航 -->
        
<header class="header  " 
  id="navHeader"
  style="position: fixed;
  left: 0; top: 0; z-index: 10;width: 100%;"
>
  <div class="header-content">
    <div class="bars">
      <div id="appDrawer" class="sidebar-image">
  <div class="drawer-box-icon">
    <i class="fas fa-bars" aria-hidden="true" @click="showDialogDrawer"></i>
  </div>
  
  <transition name="fade">
    <div class="drawer-box_mask" v-cloak style="display: none;" v-show="visible" @click.self="cancelDialogDrawer">
    </div>
  </transition>
  <div class="drawer-box" :class="{'active': visible}">
    <div class="drawer-box-head bg-color">
      <img class="drawer-box-head_logo lazyload placeholder" src="/medias/hexo-logo.jpg" class="lazyload placeholder" data-srcset="/medias/hexo-logo.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="logo">
      <h3 class="drawer-box-head_title">学习之路</h3>
      <h5 class="drawer-box-head_desc"></h5>
    </div>
    
    <div class="drawer-box-content">
      <ul class="drawer-box-content_menu">
        
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/" class="drawer-menu-item-link">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">首页</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/archives" class="drawer-menu-item-link">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">归档</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/tags" class="drawer-menu-item-link">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">标签页</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/categories" class="drawer-menu-item-link">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">类别</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="javascript:;" class="drawer-menu-item-link has-children" @click="openOrCloseMenu(4)">
                  <span>
                    
                      <i class="fas fa-link"></i>
                    
                    <span class="name">更多</span>
                  </span>
                  <i class="fas fa-chevron-left arrow " :class="{'icon-rotate': isOpen(4)}" aria-hidden="true"></i>
                </a>
                <ul class="drawer-sub-menu" v-if="isOpen(4)">
                  
                  <li>
                    <a href="/gallery">
                      
                      <i class="fas fa-music" style="margin-top: -20px;"></i>
                      
                      <span>图库</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/huoban">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>友情连接</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/me">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>关于我</span>
                    </a>
                  </li>
                  
                  <li>
                    <a target="_blank" rel="noopener" href="http://baidu.com">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>百度</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
        
          <li class="drawer-box-content_item">
            <a target="_blank" rel="noopener" href="https://github.com/yuang01/hexo-theme-bamboo">
              <i class="fas fa-github" aria-hidden="true"></i>
              <span>Github</span>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDrawer',
    data: {
      visible: false,
      top: 0,
      openArr: [],
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      isOpen(index) {
        if (this.openArr.includes(index)) {
          return true;
        } else {
          return false;
        }
      },
      openOrCloseMenu(curIndex) {
        const index = this.openArr.indexOf(curIndex);
        if (index !== -1) {
          this.openArr.splice(index, 1);
        } else {
          this.openArr.push(curIndex);
        }
      },
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'width: 100%; height: 100%;overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      }
    },
    created() {}
  })
</script>

    </div>
    <div class="blog-title" id="author-avatar">
      
        <div class="avatar">
          <img src="/medias/hexo-logo.jpg" class="lazyload placeholder" data-srcset="/medias/hexo-logo.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="logo">
        </div>
      
      <a href="/" class="logo">学习之路</a>
    </div>
    <nav class="navbar">
      <ul class="menu">
        
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/" class="menu-item-link" title="首页">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">首页</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/archives" class="menu-item-link" title="归档">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">归档</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/tags" class="menu-item-link" title="标签页">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">标签页</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/categories" class="menu-item-link" title="类别">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">类别</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="javascript:;" class="menu-item-link" title="更多">
                  
                    <i class="fas fa-link"></i>
                  
                  <span class="name">更多</span>
                  <i class="fas fa-chevron-down arrow" aria-hidden="true"></i>
                </a>
                <ul class="sub-menu">
                  
                  <li>
                    <a href="/gallery">
                      
                      <i class="fas fa-music" style="margin-top: -20px;"></i>
                      
                      <span>图库</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/huoban">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>友情连接</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/me">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>关于我</span>
                    </a>
                  </li>
                  
                  <li>
                    <a target="_blank" rel="noopener" href="http://baidu.com">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>百度</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
      </ul>
      
      
        <div id="appSearch">
  <div class="search"  @click="showDialog()"><i class="fas fa-search" aria-hidden="true"></i></div>
  <transition name="fade">
    <div class="message-box_wrapper" style="display: none;" v-cloak v-show="dialogVisible" @click.self="cancelDialogVisible()">
      <div class="message-box animated bounceInDown">
        <h2>
          <span>
            <i class="fas fa-search" aria-hidden="true"></i>
            <span class="title">Search</span>
          </span>
          <i class="fas fa-times close" pointer style="float:right;" aria-hidden="true" @click.self="cancelDialogVisible()"></i>
        </h2>
        <form class="site-search-form">
          <input type="text"
            placeholder="Please enter keywords"
            id="local-search-input" 
            @click="getSearchFile()"
            class="st-search-input"
            v-model="searchInput"
          />
        </form>
        <div class="result-wrapper">
          <div id="local-search-result" class="local-search-result-cls"></div>
        </div>
      </div>
    </div>
  </transition>
</div>
<script src="/js/local_search.js"></script>
<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appSearch',
    data: {
      dialogVisible: false,
      searchInput: '',
      top: 0,
    },
    computed: {
    },
    mounted() {
      window.addEventListener('pjax:complete', () => {
        this.cancelDialogVisible();
      })
    },
    methods: {
      showDialog() {
        this.dialogVisible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'overflow: hidden;';
      },
      getSearchFile() {
        if (!this.searchInput) {
          getSearchFile("/search.xml");
        }
      },
      cancelDialogVisible() {
        this.dialogVisible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
    },
    created() {}
  })
</script>
<!-- 解决刷新页面闪烁问题，可以在元素上添加display: none, 或者用vue.extend方法，详情：https://blog.csdn.net/qq_31393401/article/details/81017912 -->
<!-- 下面是搜索基本写法 -->
<!-- <script type="text/javascript" id="local.search.active">
  var inputArea = document.querySelector("#local-search-input");
  inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
  inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script> -->

      

    </nav>
  </div>
  
    <a target="_blank" rel="noopener" href="https://github.com/yuang01/hexo-theme-bamboo" class="github-corner color-primary" aria-label="View source on GitHub"><svg width="60" height="60" viewBox="0 0 250 250" style="fill:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  
  
</header>
        <!-- 内容区域 -->
        
<!-- prismjs 代码高亮 -->




<div class="bg-dark-floor" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;"></div>


  <!-- 文章详情页顶部图片和标题 -->




<div class="post-detail-header" id="thumbnail_canvas" style="background-repeat: no-repeat; background-size: cover; 
  background-position: center center;position: relative;background-image:url('https://picx.zhimg.com/80/v2-85c31120acff76826ab53ea8934ef4bb_1440w.webp')">
  <div class="post-detail-header-mask"></div>
  <canvas id="header_canvas"style="position:absolute;bottom:0;pointer-events:none;"></canvas>
  
  <div class="post-detail-header_info-box">
    <div class="title-box">
      <span class="title">
        框架整合
      </span>
    </div>
    
    
      
        <span class="post-detail-header_date">
          <i class="fas fa-calendar"></i> Published in：2025-05-08 |
        </span>
      

      

      
    
  </div>
  
  
    <script defer src="/js/bubble/bubble.js"></script>
  
</div>





<div class="post-detail-content post-row" 
  style="padding-top: 0px;">
  <div class="main-content">
    <article class="post post-detail">
      <div class="post-content">
        <p>一、Mybatis</p>
<h2 id="1-1配置pom文件"><a href="#1-1配置pom文件" class="headerlink" title="1.1配置pom文件"></a>1.1配置pom文件</h2><p>创建 Maven 来构建项目，则需将下面的依赖代码置于 pom.xml 文件中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line"></span><br><span class="line">&lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">&lt;version&gt;<span class="number">3.5</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;groupId&gt;mysql&lt;/groupId&gt; </span><br><span class="line"></span><br><span class="line">&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">&lt;version&gt;<span class="number">8.0</span><span class="number">.23</span>&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line"></span><br><span class="line">&lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">&lt;version&gt;<span class="number">4.12</span>&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3308/library?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlSessionUtil</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>; </span><br><span class="line"></span><br><span class="line">		InputStream inputStream;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">			sqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;  <span class="comment">//读取mybatis-config.xml转为流</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//生产sqlsession</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">getsession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// BlogMapper mapper = session.getMapper(BlogMapper.class);</span></span><br><span class="line">  		<span class="comment">// Blog blog = mapper.selectBlog(101);</span></span><br><span class="line">		<span class="keyword">return</span> sqlSessionFactory.openSession();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="1-2编写mybatis的配置文件"><a href="#1-2编写mybatis的配置文件" class="headerlink" title="1.2编写mybatis的配置文件"></a>1.2编写mybatis的配置文件</h2><p>(1) 在resources中创建mybatis-config.xml，配置configuration的核心配置文件(其中包含了mybatis的头文件)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE configuration  PUBLIC <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">	&lt;properties resource=<span class="string">&quot;db.properties&quot;</span>&gt;&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">	&lt;environments <span class="keyword">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">		&lt;environment id=<span class="string">&quot;development&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">		&lt;transactionManager type=<span class="string">&quot;JDBC&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">		&lt;dataSource type=<span class="string">&quot;POOLED&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">			&lt;property name=<span class="string">&quot;driver&quot;</span> value=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">			&lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">			&lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">			&lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">		&lt;/dataSource&gt;</span><br><span class="line">		&lt;mappers&gt;</span><br><span class="line"></span><br><span class="line">			&lt;mapper resource=<span class="string">&quot;UserMapper.xml&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">		&lt;/mappers&gt;</span><br><span class="line"></span><br><span class="line">&lt;/environment&gt;</span><br><span class="line"></span><br><span class="line">&lt;/environments&gt;</span><br></pre></td></tr></table></figure>



<p>####扫描xml文件的位置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper resource=<span class="string">&quot;org/mybatis/example/BlogMapper.xml&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mappers&gt;</span><br><span class="line"></span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>



<h2 id="1-3从xml中构建sqlsessionFactory"><a href="#1-3从xml中构建sqlsessionFactory" class="headerlink" title="1.3从xml中构建sqlsessionFactory"></a>1.3从xml中构建sqlsessionFactory</h2><p>每个基于 MyBatis 的应用都是以一个 SqlSessionFactory 的实例为核心的。SqlSessionFactory 的实例可以通过 SqlSessionFactoryBuilder 获得。而 SqlSessionFactoryBuilder 则可以从 XML 配置文件或一个预先配置的 Configuration 实例来构建出 SqlSessionFactory 实例。(SqlSessionFactory &#x3D;&#x3D;&#x3D;&#x3D;&gt;SqlSession)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);  <span class="comment">//读取mybatis-config.xml转为流</span></span><br><span class="line"></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> sqlSessionFactory.openSession();   <span class="comment">//包含了执行了数据库的所有方法</span></span><br></pre></td></tr></table></figure>



<h2 id="1-4-UserMapper"><a href="#1-4-UserMapper" class="headerlink" title="1.4 UserMapper"></a>1.4 UserMapper</h2><p><strong>创建pojo、mapper，在mapper中主要包括UserMapper.xml、UserDao、UserDaoImpl,UserMapper.xml主要是对数据进行操作的sql语句，UserDao文件是一个接口，写出要求返回的数据类型等。</strong></p>
<p><em><strong>*当然也可以将sql语句写入到接口当中*</strong></em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.mybatis.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogMapper</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM blog WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">Blog <span class="title function_">selectBlog</span><span class="params">(<span class="type">int</span> id)</span>;</span><br></pre></td></tr></table></figure>



<p>}</p>
<p><em><strong>*将*<em><strong>BlogMapper.xml，UserDao</strong></em>*分开写：*</strong></em></p>
<p>&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;BlogMapper.xml配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">    &lt;!DOCTYPE mapper</span><br><span class="line"></span><br><span class="line">PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">///////namaspace是命名空间，是与接口产生联系</span></span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;org.mybatis.example.BlogMapper&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=<span class="string">&quot;selectBlog&quot;</span> resultType=<span class="string">&quot;Blog&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">select * from Blog <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> #&#123;id&#125;</span><br><span class="line"></span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////接口(这里的selectBlog必须与UserMapper.xml里对应的Sql里Id值相同)</span></span><br><span class="line"></span><br><span class="line">List&lt;BlogMapper&gt; <span class="title function_">selectBlog</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">///////测试类</span></span><br><span class="line"></span><br><span class="line"><span class="type">UserDao</span> <span class="variable">userdao</span> <span class="operator">=</span> sqlsession.getMapper(UserDao.class);   <span class="comment">////获取接口七调用方法</span></span><br><span class="line"></span><br><span class="line">List&lt;BlogMapper&gt; listBlogMapper = Userdao.selectBlog();</span><br><span class="line"></span><br><span class="line"><span class="comment">////第二种写法</span></span><br><span class="line"></span><br><span class="line">``java``</span><br><span class="line"></span><br><span class="line">List&lt;User&gt; list = sqlsession.selectList(“com.kuabg.dao.Userdao.getUserList”);</span><br></pre></td></tr></table></figure>





<p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wpsD06A.tmp.png" class="lazyload placeholder" data-srcset="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wpsD06A.tmp.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="img"> </p>
<p>在mybatis中执行增、删、改时要提交事务</p>
<p><code>java</code></p>
<p>Sqlsession.commint();</p>
<p>Sqlsession.close();</p>
<p>在配置文件中不能出现乱码</p>
<h2 id="1-5-参数过多问题"><a href="#1-5-参数过多问题" class="headerlink" title="1.5 参数过多问题"></a>1.5 参数过多问题</h2><h5 id="如果在接口传入的参数过多时，可以用Map来封装数据"><a href="#如果在接口传入的参数过多时，可以用Map来封装数据" class="headerlink" title="如果在接口传入的参数过多时，可以用Map来封装数据"></a>如果在接口传入的参数过多时，可以用Map来封装数据</h5><p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wpsD06B.tmp.png" class="lazyload placeholder" data-srcset="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wpsD06B.tmp.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="img"><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wpsD06C.tmp.png" class="lazyload placeholder" data-srcset="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wpsD06C.tmp.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="img"> </p>
<h2 id="1-6配置解析"><a href="#1-6配置解析" class="headerlink" title="1.6配置解析"></a>1.6配置解析</h2><p><strong>·</strong> <em><strong>*configuration（配置）*</strong></em></p>
<p><strong>o</strong> <a href="#properties"><em><strong>*properties（属性）*</strong></em></a></p>
<p><strong>o</strong> <a href="#settings"><em><strong>*settings（设置）*</strong></em></a></p>
<p><strong>o</strong> <a href="#typeAliases"><em><strong>*typeAliases（类型别名）*</strong></em></a></p>
<p><strong>o</strong> <a href="#typeHandlers"><em><strong>*typeHandlers（类型处理器）*</strong></em></a></p>
<p><strong>o</strong> <a href="#objectFactory"><em><strong>*objectFactory（对象工厂）*</strong></em></a></p>
<p><strong>o</strong> <a href="#plugins"><em><strong>*plugins（插件）*</strong></em></a></p>
<p><strong>o</strong> <a href="#environments"><em><strong>*environments（环境配置）*</strong></em></a></p>
<p><strong>§</strong> <em><strong>*environment（环境变量）*</strong></em></p>
<p><strong>§</strong> <em><strong>*transactionManager（事务管理器）*</strong></em></p>
<p><strong>§</strong> <em><strong>*dataSource（数据源）*</strong></em></p>
<p><strong>o</strong> <a href="#databaseIdProvider"><em><strong>*databaseIdProvider（数据库厂商标识）*</strong></em></a></p>
<p><strong>o</strong> <a href="#mappers"><em><strong>*mappers（映射器）*</strong></em></a></p>
<h5 id="（1）Environments：MyBatis-可以配置成适应多种环境，不过要记住：尽管可以配置多个环境，但每个-SqlSessionFactory-实例只能选择一种环境。"><a href="#（1）Environments：MyBatis-可以配置成适应多种环境，不过要记住：尽管可以配置多个环境，但每个-SqlSessionFactory-实例只能选择一种环境。" class="headerlink" title="（1）Environments：MyBatis 可以配置成适应多种环境，不过要记住：尽管可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境。"></a><strong>（1）Environments：MyBatis 可以配置成适应多种环境，不过要记住：尽管可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境。</strong></h5><h5 id="（2）transactionManager：在-MyBatis-中有两种类型的事务管理器（jdbc-MANAGED"><a href="#（2）transactionManager：在-MyBatis-中有两种类型的事务管理器（jdbc-MANAGED" class="headerlink" title="（2）transactionManager：在 MyBatis 中有两种类型的事务管理器（jdbc,MANAGED)"></a>（2）transactionManager：在 MyBatis 中有两种类型的事务管理器（jdbc,MANAGED)</h5><h5 id="（3）DataSource数据源：druid、dbcp、c3p0"><a href="#（3）DataSource数据源：druid、dbcp、c3p0" class="headerlink" title="（3）DataSource数据源：druid、dbcp、c3p0"></a>（3）DataSource数据源：druid、dbcp、c3p0</h5><p>· driver – 这是 JDBC 驱动的 Java 类全限定名（并不是 JDBC 驱动中可能包含的数据源类）。</p>
<p>· url – 这是数据库的 JDBC URL 地址。</p>
<p>· username – 登录数据库的用户名。</p>
<p>· password – 登录数据库的密码。</p>
<p>· defaultTransactionIsolationLevel – 默认的连接事务隔离级别。</p>
<p>· defaultNetworkTimeout – 等待数据库操作完成的默认网络超时时间（单位：毫秒）</p>
<p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wpsD06D.tmp.png" class="lazyload placeholder" data-srcset="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wpsD06D.tmp.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="img"> </p>
<p><em><strong>*Mybatis默认的事务管理器是JDBC,连接池是pooled*</strong></em></p>
<h3 id="4-properties（属性）："><a href="#4-properties（属性）：" class="headerlink" title="(4) properties（属性）："></a>(4) <a href="#properties">properties（属性）</a>：</h3><p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wpsD06E.tmp.png" class="lazyload placeholder" data-srcset="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wpsD06E.tmp.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="img"> </p>
<p>Environments的default的值必须要与environment的ID值相同才能引用</p>
<p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wpsD07F.tmp.png" class="lazyload placeholder" data-srcset="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wpsD07F.tmp.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="img"> </p>
<h3 id="5-类型别名（typeAliases）"><a href="#5-类型别名（typeAliases）" class="headerlink" title="(5)类型别名（typeAliases）"></a>(5)类型别名（typeAliases）</h3><p>类型别名可为 Java 类型设置一个缩写名字。 它仅用于 XML 配置，意在降低冗余的全限定类名书写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line"></span><br><span class="line">&lt;typeAlias alias=<span class="string">&quot;Author&quot;</span> type=<span class="string">&quot;domain.blog.Author&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;typeAlias alias=<span class="string">&quot;Blog&quot;</span> type=<span class="string">&quot;domain.blog.Blog&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;typeAlias alias=<span class="string">&quot;Comment&quot;</span> type=<span class="string">&quot;domain.blog.Comment&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;typeAlias alias=<span class="string">&quot;Post&quot;</span> type=<span class="string">&quot;domain.blog.Post&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;typeAlias alias=<span class="string">&quot;Section&quot;</span> type=<span class="string">&quot;domain.blog.Section&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;typeAlias alias=<span class="string">&quot;Tag&quot;</span> type=<span class="string">&quot;domain.blog.Tag&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/typeAliases&gt;</span><br></pre></td></tr></table></figure>



<p>alias是指定pojo的别名</p>
<p>也可以指定一个包名，MyBatis 会在包名下面搜索需要的 Java Bean，在没有注解的情况下，会使用 Bean 的首字母小写的非限定类名来作为它的别名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">package</span> name=<span class="string">&quot;domain.blog&quot;</span>/&gt;</span><br><span class="line">  &lt;/typeAliases&gt;</span><br><span class="line">    <span class="comment">//别名就是大写的类名</span></span><br></pre></td></tr></table></figure>



<p>有注解的情况下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;author&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Author</span> &#123;</span><br><span class="line"></span><br><span class="line">...&#125;</span><br></pre></td></tr></table></figure>



<p>(5) Settings</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;cacheEnabled&quot;</span> value=<span class="string">&quot;true&quot;</span>/&gt;  ###开启缓存</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;lazyLoadingEnabled&quot;</span> value=<span class="string">&quot;true&quot;</span>/&gt;	###开启懒加载</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;multipleResultSetsEnabled&quot;</span> value=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;useColumnLabel&quot;</span> value=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;useGeneratedKeys&quot;</span> value=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;autoMappingBehavior&quot;</span> value=<span class="string">&quot;PARTIAL&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;autoMappingUnknownColumnBehavior&quot;</span> value=<span class="string">&quot;WARNING&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;defaultExecutorType&quot;</span> value=<span class="string">&quot;SIMPLE&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;defaultStatementTimeout&quot;</span> value=<span class="string">&quot;25&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;defaultFetchSize&quot;</span> value=<span class="string">&quot;100&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;safeRowBoundsEnabled&quot;</span> value=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> value=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;localCacheScope&quot;</span> value=<span class="string">&quot;SESSION&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;jdbcTypeForNull&quot;</span> value=<span class="string">&quot;OTHER&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;setting name=<span class="string">&quot;lazyLoadTriggerMethods&quot;</span> value=<span class="string">&quot;equals,clone,hashCode,toString&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>



<h3 id="6-映射器"><a href="#6-映射器" class="headerlink" title="(6) 映射器"></a><strong>(6)</strong> 映射器</h3><p>注册绑定我们的mapper文件</p>
<p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wpsD080.tmp.png" class="lazyload placeholder" data-srcset="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wpsD080.tmp.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="img"> </p>
<p>方式二：默认的别名就是类的名称第一个首字母小写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 使用映射器接口实现类的完全限定类名 --&gt;&lt;mappers&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper class=<span class="string">&quot;org.mybatis.builder.AuthorMapper&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper class=<span class="string">&quot;org.mybatis.builder.BlogMapper&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper class=<span class="string">&quot;org.mybatis.builder.PostMapper&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure>



<p>方式三：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 将包内的映射器接口实现全部注册为映射器 --&gt;&lt;mappers&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">package</span> name=<span class="string">&quot;org.mybatis.builder&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure>



<p>注意：接口必须与xml文件的名字相同</p>
<h2 id="1-7解决属性名和字段名不一样的问题"><a href="#1-7解决属性名和字段名不一样的问题" class="headerlink" title="1.7解决属性名和字段名不一样的问题"></a>1.7解决属性名和字段名不一样的问题</h2><p>​	（1）起别名</p>
<p>​	（2）resultMap的使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.someapp.model;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  <span class="keyword">private</span> String hashedPassword;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> id;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> username;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.username = username;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getHashedPassword</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> hashedPassword;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHashedPassword</span><span class="params">(String hashedPassword)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.hashedPassword = hashedPassword;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUsers&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">  select user_id, user_name, hashed_password</span><br><span class="line">  from some_table</span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">######数据表与JavaBean的字段不一样，resultMap与resultMap的值相同</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">column数据表的字段名    property：Javabean的字段名   type：数据的返回类型</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;user_name&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span> <span class="attr">column</span>=<span class="string">&quot;hashed_password&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="1-8日志"><a href="#1-8日志" class="headerlink" title="1.8日志"></a>1.8日志</h2><p>1.日志工厂</p>
<p>如果需要打印日志文件，例如：打印sql文件的输出&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;properties——-&gt;settings——-&gt;typeAliases——&gt;plugins</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>logImpl 可选的值有：SLF4J、LOG4J、LOG4J2、JDK_LOGGING、COMMONS_LOGGING、STDOUT_LOGGING、NO_LOGGING</p>
<p>​		<strong>注意：value后面不能加空格</strong></p>
<p>2.log4j</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">log4j.rootLogger=ERROR, stdout</span><br><span class="line"></span><br><span class="line">log4j.logger.org.mybatis.example.BlogMapper=TRACE</span><br><span class="line"></span><br><span class="line">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n</span><br></pre></td></tr></table></figure>

<h2 id="1-9补充"><a href="#1-9补充" class="headerlink" title="1.9补充"></a>1.9补充</h2><h3 id="1-动态sql"><a href="#1-动态sql" class="headerlink" title="1.动态sql"></a>1.动态sql</h3><p>1.1创建pojo文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line">   <span class="keyword">private</span> String name;</span><br><span class="line">   <span class="keyword">private</span> Integer age;</span><br><span class="line">   <span class="keyword">private</span> String position;</span><br></pre></td></tr></table></figure>

<p>1.2创建xml（if标签的使用）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.pojo.Employee&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findEmpl&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;empl&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;empl&quot;</span>&gt;</span></span><br><span class="line">        select id,name,age,position from employee where 1=1</span><br><span class="line">                        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name !=null and name != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">                            and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age !=null and age != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">                            and age like concat(&#x27;%&#x27;,#&#123;age&#125;,&#x27;%&#x27;)</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id !=null and id!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                            and id=#&#123;id&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.3测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> EmployeeCommont.comment();</span><br><span class="line">      <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>,<span class="string">&quot;张三&quot;</span>,<span class="number">13</span>,<span class="string">&quot;经理&quot;</span>);</span><br><span class="line">      List&lt;Employee&gt; findEmpl = session.selectList(<span class="string">&quot;findEmpl&quot;</span>, employee);</span><br><span class="line">      System.out.println(findEmpl);</span><br></pre></td></tr></table></figure>

<p>1.4抽取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-comfig.xml&quot;</span>;</span><br><span class="line">       <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="literal">null</span>;  <span class="comment">//读取mybatis-config.xml转为流</span></span><br><span class="line">       <span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">           <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">           session = sqlSessionFactory.openSession();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> session;</span><br></pre></td></tr></table></figure>



<p>1.5 choose标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findempl&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;empl&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;empl&quot;</span>&gt;</span></span><br><span class="line">        select  * from employee where 1=1</span><br><span class="line">        <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;name !=null and name !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;age !=null and age !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and age like concat(&#x27;%&#x27;,#&#123;age&#125;,&#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;id !=null and id!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and id=#&#123;id&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                and position = #&#123;position &#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.6 where 标签的使用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name !=null and name != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">                            and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">                   <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age !=null and age != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">                            and age like concat(&#x27;%&#x27;,#&#123;age&#125;,&#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id !=null and id!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                            or id=#&#123;id&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.7 trim 标签的使用</p>
<p>​			&lt;1&gt;prefix:添加前缀</p>
<p>​			&lt;2&gt;prefixOverrides：删除前缀</p>
<p>​			&lt;3&gt;suffix:添加后缀</p>
<p>​			&lt;4&gt;suffixOverrides:删除后缀</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findEmpl1&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;empl&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;empl&quot;</span>&gt;</span></span><br><span class="line">      select id,name,age,position from employee</span><br><span class="line">      <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;and&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name !=null and name != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">              and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">          <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age !=null and age != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">              and age like concat(&#x27;%&#x27;,#&#123;age&#125;,&#x27;%&#x27;)</span><br><span class="line">          <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id !=null and id!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">              or id=#&#123;id&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.8 update标签的使用</p>
<p>​			在传统的更新方式中需要将其所有的属性都更新一遍，执行的效率就非常低，mybatis中提供了<set>标签，并且会在最后一个逗号也会去掉</p>
<p>​		注意：如果有多个字段要更新时，<set>语句立面的语句需要打,##########容易出现错误</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;empl&quot;</span>&gt;</span></span><br><span class="line">    update employee </span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name !=null and name !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            name = #&#123;name&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> 1.9update与trim标签的结合使用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;empl&quot;</span>&gt;</span></span><br><span class="line">    update employee </span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;set&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name !=null and name !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            name = #&#123;name&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age !=null and name !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            age = #&#123;age&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.0<foreach>的使用</p>
<p>属性</p>
<p>1️⃣item：表示每一个元素进行垫带的别名，该属性为必选属性</p>
<p>2️⃣index：在数组和list集合当中，index是元素的序号；在map中，index是元素的key。该元素是可选属性</p>
<p>3️⃣open：表示《foreach》语句的开始字符</p>
<p>4️⃣separator：隔开字符</p>
<p>5️⃣close：表示《foreach》语句的关闭字符</p>
<p>6️⃣collection：用于指定遍历参数的类型，该属性必须指定</p>
<p>​	若传入的参数是list类型，collection的属性值为list</p>
<p>​	若传入的参数是数组类型，collection的属性值是array</p>
<p>​	若传入的参数是多参数，collection的属性值是Map</p>
<p>练习</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  批量查询Arrays  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span>  <span class="attr">id</span>=<span class="string">&quot;piLiang&quot;</span>  <span class="attr">parameterType</span>=<span class="string">&quot;java.util.Arrays&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    select  * from users where uid in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;array&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span>  <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> &gt;</span></span><br><span class="line">        #&#123;uid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span>  <span class="attr">id</span>=<span class="string">&quot;piLiang&quot;</span>  <span class="attr">parameterType</span>=<span class="string">&quot;java.util.Arrays&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        select  * from users where uid in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span>  <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> &gt;</span></span><br><span class="line">            #&#123;uid&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  Map  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;maps&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        select * from users where uage = #&#123;uage&#125; and uid in</span><br><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;uids&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">item</span>=<span class="string">&quot;roleMap&quot;</span>&gt;</span></span><br><span class="line">    #&#123;roleMap&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>Test</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void piliang()&#123;</span><br><span class="line">    SqlSession sqlSession = jdbcComment.comment();</span><br><span class="line">    int [] arr=  &#123;1,2,3,4&#125;;</span><br><span class="line">    List&lt;User&gt; piLiang = sqlSession.selectList(&quot;piLiang&quot;, arr);</span><br><span class="line">    System.out.println(piLiang);</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MapTest</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void piliang1()&#123;</span><br><span class="line">    SqlSession sqlSession = jdbcComment.comment();</span><br><span class="line">    Map&lt;String,Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">    List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();</span><br><span class="line">    list.add(1);</span><br><span class="line">    map.put(&quot;uids&quot;,list);</span><br><span class="line">    map.put(&quot;uage&quot;,22);</span><br><span class="line">    List&lt;User&gt; piLiang = sqlSession.selectList(&quot;maps&quot;, map);</span><br><span class="line">    System.out.println(piLiang);</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-嵌套查询"><a href="#2-嵌套查询" class="headerlink" title="2.嵌套查询"></a>2.嵌套查询</h3><p><assiociation>标签的使用</p>
<p>2.1属性：</p>
<p>1️⃣property：指定到映射到实体类对象的属性</p>
<p>2️⃣column：数据库字段</p>
<p>3️⃣JavaType：指定映射到实体类对象的属性类型</p>
<p>4️⃣JdbcType:指定数据库的对应字段的类型</p>
<p>5️⃣autoMapping：用于指定自动映射</p>
<p>6️⃣typeHandler:指定类型处理器</p>
<p>7️⃣fetchType:关联查询是否启用延迟加载</p>
<h4 id="2-2-一对一项目"><a href="#2-2-一对一项目" class="headerlink" title="2.2  一对一项目"></a>2.2  一对一项目</h4><p>案例：一张身份证对应一个人</p>
<p>创建IdCard和Person，在建表时产生关联</p>
<p>Person的属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> Integer age;#####关联</span><br><span class="line"><span class="keyword">private</span> String sex;</span><br><span class="line"><span class="keyword">private</span> IdCard card;</span><br></pre></td></tr></table></figure>

<p>IdCard的属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Integer id;#####关联</span><br><span class="line"><span class="keyword">private</span> String code;</span><br></pre></td></tr></table></figure>

<p>IdCard.xml的配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.IdCard&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.IdCard&quot;</span>&gt;</span></span><br><span class="line">        select  * from idcard where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>CardUser.xml的配置文件</p>
<p>###resultMap标签必须要写在select标签的前面</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.CardUser&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;IdCardWithPerson&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.itheima.pojo.Person&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;card&quot;</span> <span class="attr">column</span>=<span class="string">&quot;card&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">javaType</span>=<span class="string">&quot;com.itheima.pojo.IdCard&quot;</span>  ###<span class="attr">对象类型</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">select</span>=<span class="string">&quot;com.itheima.mapper.IdCard.selectById&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span>   ###相当于进行了子查询</span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByPersonId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;IdCardWithPerson&quot;</span>&gt;</span></span><br><span class="line">        select * from person where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试Java类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cardtest</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> jdbcComment.comment();</span><br><span class="line">     <span class="type">Person</span> <span class="variable">findByPersonId</span> <span class="operator">=</span> sqlSession.selectOne(<span class="string">&quot;findByPersonId&quot;</span>, <span class="number">1</span>);</span><br><span class="line">     System.out.println(findByPersonId);</span><br><span class="line">     sqlSession.close();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3一对多的项目"><a href="#2-3一对多的项目" class="headerlink" title="2.3一对多的项目"></a>2.3一对多的项目</h4><p>案例：一个人有多个订单</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public class Orders &#123;</span><br><span class="line">    private Integer id;		</span><br><span class="line">    private  String number; //订单编号 在数据库当中还设置了user_id</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class Users &#123;</span><br><span class="line">    private Integer id;			//主键关联</span><br><span class="line">    private String username;</span><br><span class="line">    private String address;</span><br><span class="line">    private List&lt;Orders&gt; orders;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;namespace=&quot;mapper/users.xml&quot;&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;UserWithOrdersResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.itheima.pojo.Users&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;orders&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.itheima.pojo.Orders&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;orders_id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;number&quot;</span> <span class="attr">property</span>=<span class="string">&quot;number&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserWithOrders&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserWithOrdersResult&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Integer&quot;</span>&gt;</span></span><br><span class="line">        select  u.* , o.id orders_id ,o.number from tb_user u ,tb_orders o where o.user_id  = u.id and u.id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void findStu4()&#123;</span><br><span class="line">    SqlSession session = JdbcComment.comment();</span><br><span class="line">    Users users = session.selectOne(&quot;findUserWithOrders&quot;,1);</span><br><span class="line">    System.out.println(users);</span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.4多对多</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">use libary</span><br><span class="line"></span><br><span class="line">CREATE TABLE tb<span class="built_in">_</span>product(</span><br><span class="line">id int(32) PRIMARY KEY AUTO<span class="built_in">_</span>INCREMENT,</span><br><span class="line">NAME VARCHAR(32),</span><br><span class="line">price DOUBLE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE TABLE tb<span class="built_in">_</span>orders(</span><br><span class="line">id int(32) PRIMARY KEY AUTO<span class="built_in">_</span>INCREMENT,</span><br><span class="line">number VARCHAR(32),</span><br><span class="line">user<span class="built_in">_</span>id DOUBLE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE TABLE tb<span class="built_in">_</span>ordersitem(</span><br><span class="line">id int(32) PRIMARY KEY AUTO<span class="built_in">_</span>INCREMENT,</span><br><span class="line">orders<span class="built_in">_</span>id int(32),</span><br><span class="line">product<span class="built_in">_</span>id int(32),</span><br><span class="line">FOREIGN KEY (orders<span class="built_in">_</span>id) REFERENCES tb<span class="built_in">_</span>orders(id),</span><br><span class="line">FOREIGN KEY (product<span class="built_in">_</span>id) REFERENCES tb<span class="built_in">_</span>orders(id)</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<p>​	</p>
<h1 id="二、spring"><a href="#二、spring" class="headerlink" title="二、spring"></a>二、spring</h1><h5 id="1-1-IOC理论推论"><a href="#1-1-IOC理论推论" class="headerlink" title="1.1  IOC理论推论&lt;控制反转&gt;"></a>1.1  IOC理论推论&lt;控制反转&gt;</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> vom.hnkj.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Userdao</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getUserdao</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##############################</span><br><span class="line">    </span><br><span class="line"><span class="keyword">package</span> vom.hnkj.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">Userdao</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUserdao</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getUserDao&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#############</span><br><span class="line">    </span><br><span class="line"><span class="keyword">package</span> vom.hnkj.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getuser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#############</span><br><span class="line">    </span><br><span class="line"><span class="keyword">package</span> vom.hnkj.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> vom.hnkj.dao.Userdao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserserviceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Userdao userdao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserdao</span><span class="params">(Userdao userdao)</span> &#123;				######Iop控制反转的基本思想</span><br><span class="line">        <span class="built_in">this</span>.userdao = userdao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getuser</span><span class="params">()</span> &#123;</span><br><span class="line">        userdao.getUserdao();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">###############测试类</span><br><span class="line"><span class="keyword">import</span> vom.hnkj.dao.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> vom.hnkj.service.UserService;</span><br><span class="line"><span class="keyword">import</span> vom.hnkj.service.UserserviceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IocTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserserviceImpl</span>();</span><br><span class="line">        ((UserserviceImpl) userService).setUserdao(<span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>());</span><br><span class="line">        userService.getuser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;5.3.15&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">   &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<p><img src="D:\QQ截图20220223222148.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220223222148.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220223222148"></p>
<p>​	</p>
<p>​		运用配置来创建对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</span><br><span class="line">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=&quot;user&quot; class=&quot;vom.hnkj.pojo.User&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;username&quot; value=&quot;张三&quot;&gt;&lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> vom.hnkj.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;username=&#x27;&quot;</span> + username + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;bean.xml&quot;);   //获取spring的上下文对象</span><br><span class="line">        User user = (User) context.getBean(&quot;user&quot;);</span><br><span class="line">        System.out.println(user.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userdaoimpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;vom.hnkj.dao.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>	#####创建对象</span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userdao1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;vom.hnkj.service.UserserviceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userdao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userdaoimpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span>		###属性赋值</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = new ClassPathXmlApplicationContext(&quot;bean.xml&quot;);    //获取spring的上下文对象</span><br><span class="line">    UserserviceImpl userservice = (UserserviceImpl)context.getBean(&quot;userdao1&quot;);</span><br><span class="line">    System.out.println(userservice);</span><br></pre></td></tr></table></figure>



<h5 id="1-2依赖注入"><a href="#1-2依赖注入" class="headerlink" title="1.2依赖注入"></a>1.2依赖注入<DI></h5><h6 id="1-构造器注入"><a href="#1-构造器注入" class="headerlink" title="(1) 	构造器注入"></a>(1) 	构造器注入</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;vom.hnkj.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> vom.hnkj.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;username=&#x27;&quot;</span> + username + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="2-set方法的注入"><a href="#2-set方法的注入" class="headerlink" title="(2)set方法的注入"></a>(2)set方法的注入</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line">    <span class="keyword">private</span> String [] books;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; hobby;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,String&gt; card;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; games;</span><br><span class="line">    <span class="keyword">private</span> String wife;</span><br><span class="line">    <span class="keyword">private</span> Properties properties;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;address&quot;</span> <span class="attr">class</span>=<span class="string">&quot;vom.hnkj.pojo.Address&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">value</span>=<span class="string">&quot;益阳&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;vom.hnkj.pojo.Student&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ck&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--     bean注入   --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;address&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  数组 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;books&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>java<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>linux<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>python<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--     list   --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>moveing<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>编程<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    Map    --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;身份证&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    set    --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;games&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>wz<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>lol<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        null--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;wife&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">null</span>&gt;</span><span class="tag">&lt;/<span class="name">null</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        properties--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;properties&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;序号&quot;</span>&gt;</span>1234<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;sex&quot;</span>&gt;</span>男<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="3-p标签的命名空间的使用（set注入）"><a href="#3-p标签的命名空间的使用（set注入）" class="headerlink" title="(3)p标签的命名空间的使用（set注入）"></a>(3)p标签的命名空间的使用（set注入）</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//p标签的命名空间</span><br><span class="line">xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--   p标签的使用 （充当属性赋值）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;address1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;vom.hnkj.pojo.Address&quot;</span> <span class="attr">p:address</span>=<span class="string">&quot;益阳&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="4-c标签的命名空间-构造器"><a href="#4-c标签的命名空间-构造器" class="headerlink" title="(4)c标签的命名空间(构造器)"></a>(4)c标签的命名空间(构造器)</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:c=&quot;http://www.springframework.org/schema/c&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--   c标签的使用 （充当属性赋值）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;address1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;vom.hnkj.pojo.Address&quot;</span> <span class="attr">c:address</span>=<span class="string">&quot;益阳&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="1-3bean的作用域"><a href="#1-3bean的作用域" class="headerlink" title="1.3bean的作用域"></a>1.3bean的作用域<Bean scopes></h5><table>
<thead>
<tr>
<th>Scope</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>singleton</td>
<td>（默认）为每个Spring IoC容器创建单个实例。单例作用域</td>
</tr>
<tr>
<td>prototype</td>
<td>多例作用域，为每个请求创建一个新的bean实例</td>
</tr>
<tr>
<td>request</td>
<td>单个HTTP请求的生命周期。也就是说，每个HTTP请求都有自己的bean实例，这些实例是在单个bean定义的基础上创建的。仅在可感知web的Spring应用程序上下文中有效。</td>
</tr>
<tr>
<td>session</td>
<td>HTTPSession的生命周期。仅在可感知web的Spring应用程序上下文中有效。</td>
</tr>
<tr>
<td>application</td>
<td>ServletContext的生命周期。仅在可感知web的Spring应用程序上下文中有效。</td>
</tr>
<tr>
<td>websocket</td>
<td>websocket的生命周期。仅在可感知web的Spring应用程序上下文中有效。</td>
</tr>
</tbody></table>
<h6 id="1-单列模式"><a href="#1-单列模式" class="headerlink" title="(1) 单列模式"></a>(1) 单列模式</h6><p>spring默认的singleton  Scope</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;vom.hnkj.pojo.User&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);    <span class="comment">//获取spring的上下文对象</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) context.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> context.getBean(User.class, <span class="string">&quot;user&quot;</span>);</span><br><span class="line">        System.out.println(user==user1);    <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<h6 id="2-原型模式"><a href="#2-原型模式" class="headerlink" title="(2)原型模式"></a>(2)原型模式</h6><p>每次从容器中get的时候，都会产生一个新对象</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;vom.hnkj.pojo.User&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="1-4Bean的自动装配"><a href="#1-4Bean的自动装配" class="headerlink" title="1.4Bean的自动装配"></a>1.4Bean的自动装配</h5><p>​		@Autowired的依赖注入：直接在属性上可以使用，但前提的条件是在IOC容器中存在这样的bean并且的名字符合byName规则</p>
<p>使用注解须知：</p>
<p>​	1.导入context约束</p>
<p>​	2.开启注解支持	 <a href="context:annotation-config/">context:annotation-config/</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.spring.test1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	@Nullable   表示这个字段是可以为空</p>
<p>1.5AOP(面向切面)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</span><br><span class="line">	http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">	http://www.springframework.org/schema/aop   </span><br><span class="line">    http://www.springframework.org/schema/aop/spring-aop-3.1.xsd</span><br><span class="line">    http://www.springframework.org/schema/context  </span><br><span class="line">    http://www.springframework.org/schema/context/spring-context-3.0.xsd&quot;&gt;</span><br><span class="line">     &lt;import resource=&quot;cn/aop/Test1/aop.xml&quot;/&gt;		</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</span><br><span class="line">	http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">	http://www.springframework.org/schema/aop   </span><br><span class="line">     http://www.springframework.org/schema/aop/spring-aop-3.1.xsd&quot;&gt;</span><br><span class="line">     &lt;bean id=&quot;auth&quot; class=&quot;cn.aop.Test1.Auth&quot;&gt;&lt;/bean&gt;		&lt;!--位于目标方法前面的方法叫前置通知--&gt;</span><br><span class="line">     &lt;bean id=&quot;bankServiceImpl&quot; class=&quot;cn.aop.Test1.BankServiceImpl&quot;&gt;&lt;/bean&gt;	&lt;!--目标方法--&gt;</span><br><span class="line">     &lt;bean id=&quot;clear1&quot; class=&quot;cn.aop.Test1.Clear1&quot;&gt;&lt;/bean&gt;	&lt;!--位于目标方法后面的方法叫后置通知--&gt;</span><br><span class="line">     &lt;bean id=&quot;sercurity&quot; class=&quot;cn.aop.Test1.Sercurity&quot;&gt;&lt;/bean&gt;</span><br><span class="line">     &lt;bean id=&quot;rizhi&quot; class=&quot;cn.aop.Test1.Rizhi&quot;&gt;&lt;/bean&gt;</span><br><span class="line">     &lt;bean id=&quot;yuer&quot; class=&quot;cn.aop.Test1.Printaop&quot;&gt;&lt;/bean&gt;</span><br><span class="line">     &lt;bean id=&quot;chucuo&quot; class=&quot;cn.aop.Test1.Global&quot;&gt;&lt;/bean&gt;</span><br><span class="line">     &lt;aop:config&gt;</span><br><span class="line">     	&lt;aop:pointcut expression=&quot;execution(* cn.aop.Test1.BankServiceImpl.*(..))&quot; id=&quot;aaa&quot;/&gt;</span><br><span class="line">     	&lt;!-- BankServiceImpl里面的方法都是切入点 ，切点类似于类的形式--&gt;</span><br><span class="line">     	&lt;aop:aspect ref=&quot;auth&quot;&gt;</span><br><span class="line">     		&lt;aop:around method=&quot;isUserexiset&quot; pointcut-ref=&quot;aaa&quot;/&gt;	&lt;!--环绕通知（一般用于安全环境）--&gt;</span><br><span class="line">     	&lt;/aop:aspect&gt;</span><br><span class="line">     	</span><br><span class="line">     	&lt;aop:aspect ref=&quot;sercurity&quot;&gt;</span><br><span class="line">     		&lt;aop:before method=&quot;isercurity&quot; pointcut-ref=&quot;aaa&quot;/&gt;&lt;!--前置通知（一般先要进行安全的校验）--&gt;</span><br><span class="line">     	&lt;/aop:aspect&gt;</span><br><span class="line">     	</span><br><span class="line">     	&lt;aop:aspect ref=&quot;yuer&quot;&gt;			&lt;!-- 在getMoney切入点中带有返回值就用returning --&gt;</span><br><span class="line">     		&lt;aop:after-returning method=&quot;getMoney&quot; pointcut-ref=&quot;aaa&quot; returning=&quot;m&quot;/&gt;</span><br><span class="line">     	&lt;/aop:aspect&gt;</span><br><span class="line">     	</span><br><span class="line">     	&lt;aop:aspect ref=&quot;chucuo&quot;&gt;		&lt;!--接收异常的通知--&gt;</span><br><span class="line">     		&lt;aop:after-throwing method=&quot;globaoTest&quot; pointcut-ref=&quot;aaa&quot; throwing=&quot;ex&quot;/&gt;</span><br><span class="line">     	&lt;/aop:aspect&gt;</span><br><span class="line">     	</span><br><span class="line">     	&lt;aop:aspect ref=&quot;rizhi&quot; order=&quot;2&quot;&gt;		&lt;!--order优先级（数字越大优先级就越高）--&gt;</span><br><span class="line">     		&lt;aop:after method=&quot;rizhi&quot; pointcut-ref=&quot;aaa&quot;/&gt;</span><br><span class="line">     	&lt;/aop:aspect&gt;</span><br><span class="line">     	</span><br><span class="line">     	&lt;aop:aspect ref=&quot;clear1&quot; order=&quot;1&quot;&gt;</span><br><span class="line">     		&lt;aop:after method=&quot;clearrr&quot; pointcut-ref=&quot;aaa&quot;/&gt;</span><br><span class="line">     	&lt;/aop:aspect&gt;</span><br><span class="line">     	</span><br><span class="line">     &lt;/aop:config&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>



<h1 id="三、ssm整合"><a href="#三、ssm整合" class="headerlink" title="三、ssm整合"></a>三、ssm整合</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">log4j.rootLogger=debug,stdout</span><br><span class="line">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.Target=System.err</span><br><span class="line">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern=%d %l %m %n</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line"> 				xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">  				xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</span><br><span class="line"> 				xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; </span><br><span class="line">  				xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">  				xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</span><br><span class="line">  				xmlns:task=&quot;http://www.springframework.org/schema/task&quot;</span><br><span class="line">  				xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span><br><span class="line">http://www.springframework.org/schema/tx </span><br><span class="line">http://www.springframework.org/schema/tx/spring-tx-4.2.xsd</span><br><span class="line">http://www.springframework.org/schema/aop </span><br><span class="line">http://www.springframework.org/schema/aop/spring-aop-4.2.xsd</span><br><span class="line">http://www.springframework.org/schema/context</span><br><span class="line">http://www.springframework.org/schema/context/spring-context-4.2.xsd</span><br><span class="line">http://www.springframework.org/schema/mvc</span><br><span class="line">http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd</span><br><span class="line">http://www.springframework.org/schema/task</span><br><span class="line">http://www.springframework.org/schema/task/spring-task-4.2.xsd&quot;&gt;</span><br><span class="line">	&lt;!-- 配置包扫描 --&gt;</span><br><span class="line">	&lt;context:component-scan base-package=&quot;cn.java.*&quot;/&gt;	</span><br><span class="line">	&lt;!-- MVC注解驱动 --&gt;</span><br><span class="line">	&lt;mvc:annotation-driven/&gt;</span><br><span class="line">	&lt;!-- 视图解析器 --&gt;</span><br><span class="line">	&lt;bean id=&quot;internalResourceViewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;</span><br><span class="line">		&lt;!-- 配置前缀 --&gt;</span><br><span class="line">		&lt;property name=&quot;prefix&quot; value=&quot;/pages/&quot;&gt;&lt;/property&gt;</span><br><span class="line">		&lt;!-- 配置后缀 --&gt;</span><br><span class="line">		&lt;property name=&quot;suffix&quot; value=&quot;&quot;&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;!-- 文件上传 --&gt;</span><br><span class="line">	&lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;</span><br><span class="line">		&lt;!-- 配置默认编码 --&gt;</span><br><span class="line">		&lt;property name=&quot;defaultEncoding&quot; value=&quot;utf-8&quot;&gt;&lt;/property&gt;</span><br><span class="line">		&lt;!-- 配置文件上传的大小 --&gt;</span><br><span class="line">		&lt;property name=&quot;maxUploadSize&quot; value=&quot;1048576&quot;&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	 &lt;!-- 配置校验的配置 --&gt;</span><br><span class="line">    &lt;mvc:annotation-driven validator=&quot;validator&quot;&gt;&lt;/mvc:annotation-driven&gt;</span><br><span class="line">    &lt;bean id=&quot;validator&quot; class=&quot;org.springframework.validation.beanvalidation.LocalValidatorFactoryBean&quot;&gt;</span><br><span class="line">    	&lt;property name=&quot;providerClass&quot; value=&quot;org.hibernate.validator.HibernateValidator&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">	&lt;!-- 定时器 --&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 配置拦截器 --&gt;</span><br><span class="line">	&lt;!-- &lt;mvc:interceptors&gt;</span><br><span class="line">		&lt;mvc:interceptor&gt;</span><br><span class="line">		先写路径在写拦截</span><br><span class="line">		    &lt;mvc:mapping path=&quot;/**&quot;/&gt;</span><br><span class="line">		    不进行拦截，能配置多个</span><br><span class="line">		    &lt;mvc:exclude-mapping path=&quot;/selectUser.shtml&quot;/&gt;</span><br><span class="line">			&lt;bean id=&quot;oneInterceptor&quot; class=&quot;cn.java.interceptor.OneInterceptor&quot;&gt;&lt;/bean&gt;</span><br><span class="line">		&lt;/mvc:interceptor&gt;</span><br><span class="line">	&lt;/mvc:interceptors&gt; --&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#mysql</span><br><span class="line">driver=com.mysql.cj.jdbc.Driver</span><br><span class="line">url=jdbc:mysql://localhost:3308/library?serverTimezone=UTC</span><br><span class="line">username=root</span><br><span class="line">password=root</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line"> 				xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">  				xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</span><br><span class="line"> 				xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; </span><br><span class="line">  				xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">  				xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</span><br><span class="line">  				xmlns:task=&quot;http://www.springframework.org/schema/task&quot;</span><br><span class="line">  				xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span><br><span class="line">http://www.springframework.org/schema/tx </span><br><span class="line">http://www.springframework.org/schema/tx/spring-tx-4.2.xsd</span><br><span class="line">http://www.springframework.org/schema/aop </span><br><span class="line">http://www.springframework.org/schema/aop/spring-aop-4.2.xsd</span><br><span class="line">http://www.springframework.org/schema/context</span><br><span class="line">http://www.springframework.org/schema/context/spring-context-4.2.xsd</span><br><span class="line">http://www.springframework.org/schema/mvc</span><br><span class="line">http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd</span><br><span class="line">http://www.springframework.org/schema/task</span><br><span class="line">http://www.springframework.org/schema/task/spring-task-4.2.xsd&quot;&gt;</span><br><span class="line">				&lt;!-- 读取properties文件 --&gt;</span><br><span class="line">				 &lt;bean id=&quot;propertyPlaceholderConfigurer&quot; class=&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;&gt;</span><br><span class="line">					&lt;property name=&quot;location&quot; value=&quot;classpath:database.properties&quot;&gt;&lt;/property&gt;</span><br><span class="line">				&lt;/bean&gt; </span><br><span class="line">				</span><br><span class="line">				&lt;!-- 配置数据源 --&gt;</span><br><span class="line">			    &lt;bean id=&quot;basicDataSource&quot; class=&quot;org.apache.commons.dbcp2.BasicDataSource&quot;&gt;</span><br><span class="line">	 			&lt;!-- 配置数据库驱动 --&gt;</span><br><span class="line">	 			&lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;driver&#125;&quot;/&gt;</span><br><span class="line">	 			&lt;!-- 配置URL--&gt;</span><br><span class="line">	 			&lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt;</span><br><span class="line">	 			&lt;!--配置用户名 密码--&gt;</span><br><span class="line">	 			&lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt;</span><br><span class="line">	 			&lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt;</span><br><span class="line">	 		&lt;/bean&gt;</span><br><span class="line">	 		</span><br><span class="line">			&lt;bean id=&quot;sqlSessionFactoryBean&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;</span><br><span class="line">				&lt;!--指定数据源--&gt;</span><br><span class="line">				&lt;property name=&quot;dataSource&quot; ref=&quot;basicDataSource&quot;&gt;&lt;/property&gt;</span><br><span class="line">				&lt;!-- 指定mapper.xml文件所在的位置 --&gt;</span><br><span class="line">				&lt;property name=&quot;mapperLocations&quot; value=&quot;classpath*:cn/java/mapper/*.xml&quot;&gt;&lt;/property&gt;</span><br><span class="line">			&lt;/bean&gt;</span><br><span class="line">			</span><br><span class="line">			&lt;!-- 让mapper与xml配置文件的SQL语句产生关联 --&gt;</span><br><span class="line">			&lt;bean id=&quot;mapperScannerConfigurer&quot; class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;</span><br><span class="line">			&lt;!-- 如果UserMapper和xml文件的名字相同，就会相关联 --&gt;</span><br><span class="line">				&lt;property name=&quot;basePackage&quot; value=&quot;cn.java.mapper&quot;&gt;&lt;/property&gt;</span><br><span class="line">			&lt;/bean&gt;</span><br><span class="line">			</span><br><span class="line">			&lt;!-- 配制数据源在哪里配制事务就在那里 --&gt;</span><br><span class="line">			&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">				&lt;property name=&quot;dataSource&quot; ref=&quot;basicDataSource&quot;&gt;&lt;/property&gt;</span><br><span class="line">			&lt;/bean&gt;</span><br><span class="line">			&lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot; proxy-target-class=&quot;true&quot;/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span><br><span class="line">xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; </span><br><span class="line">xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee </span><br><span class="line">http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot; id=&quot;WebApp_ID&quot; version=&quot;2.5&quot;&gt;</span><br><span class="line">  &lt;display-name&gt;ssm&lt;/display-name&gt;</span><br><span class="line">  &lt;welcome-file-list&gt;</span><br><span class="line">    &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;</span><br><span class="line">  &lt;/welcome-file-list&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 配置过滤器 --&gt;</span><br><span class="line">  &lt;context-param&gt;</span><br><span class="line">    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt;</span><br><span class="line">  &lt;/context-param&gt;</span><br><span class="line">  &lt;listener&gt;</span><br><span class="line">    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;</span><br><span class="line">  &lt;/listener&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">      &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">  &lt;/servlet&gt;</span><br><span class="line">  &lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;*.shtml&lt;/url-pattern&gt;</span><br><span class="line">  &lt;/servlet-mapping&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;error-page&gt;</span><br><span class="line">    &lt;error-code&gt;404&lt;/error-code&gt;</span><br><span class="line">    &lt;location&gt;/pages/error/404.jsp&lt;/location&gt;</span><br><span class="line">  &lt;/error-page&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>



<h1 id="四、shiro（Apache）"><a href="#四、shiro（Apache）" class="headerlink" title="四、shiro（Apache）"></a>四、shiro（Apache）</h1><p>shiro的核心代码就是授权和认证、加密、缓存等，也就是realm的实现类。</p>
<p><img src="D:\QQ截图20220224182943.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220224182943.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220224182943"></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * subject用户</span><br><span class="line"> * SecurityManger 管理所有的用户</span><br><span class="line"> * Realm    连接数据</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>

<p>​	（1）shiro的必要依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.github.theborakompanioni&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;thymeleaf-extras-shiro&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.0.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.1.21&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.2.1&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;thymeleaf-extras-java8time&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--       shiro与spring的整合包 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;shiro-spring&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.3.2&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * anon：如何人都能访问</span><br><span class="line">    * authc：必须认证才能访问</span><br><span class="line">    * user：必须要实现记住我功能</span><br><span class="line">    * perms：拥有某一个资源才能访问 permission的简写</span><br><span class="line">    * role：拥有某一个角色才能访问</span><br><span class="line">    * @param defaultWebSecurityManager</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>这是一个配制类，不需要去实现或继承方法    </span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> UserRealm <span class="title function_">userRealm</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserRealm</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;defaultWebSecurityManager&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DefaultWebSecurityManager <span class="title function_">getDefaultWebSecurityManger</span><span class="params">(<span class="meta">@Qualifier(&quot;userRealm&quot;)</span> UserRealm userRealm)</span>&#123;</span><br><span class="line">        <span class="type">DefaultWebSecurityManager</span> <span class="variable">defaultWebSecurityManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSecurityManager</span>();</span><br><span class="line">                 defaultWebSecurityManager.setRealm(userRealm);</span><br><span class="line">            <span class="keyword">return</span> defaultWebSecurityManager;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterFactoryBean <span class="title function_">getshiroFilterFactoryBean</span><span class="params">(<span class="meta">@Qualifier(&quot;defaultWebSecurityManager&quot;)</span> DefaultWebSecurityManager defaultWebSecurityManager)</span>&#123;</span><br><span class="line">        <span class="type">ShiroFilterFactoryBean</span> <span class="variable">shiroFilterFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(defaultWebSecurityManager);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; filterChainDefinitionMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>();</span><br><span class="line">        <span class="comment">//设置权限，必须设置在拦截器的前面</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/user/add&quot;</span>,<span class="string">&quot;perms[user:add]&quot;</span>);</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/user/update&quot;</span>,<span class="string">&quot;perms[user:update]&quot;</span>);</span><br><span class="line">        <span class="comment">//必须要认证才能访问该资源</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/user/*&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">        <span class="comment">//如果没有登录就跳到该页面</span></span><br><span class="line">        shiroFilterFactoryBean.setLoginUrl(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">        <span class="comment">//没有认证就跳转页面路径</span></span><br><span class="line">        shiroFilterFactoryBean.setUnauthorizedUrl(<span class="string">&quot;/noauth&quot;</span>);</span><br><span class="line"></span><br><span class="line">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public class UserRealm extends AuthorizingRealm &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    //授权</span><br><span class="line">    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) &#123;</span><br><span class="line">        SimpleAuthorizationInfo info = new SimpleAuthorizationInfo();</span><br><span class="line">        Subject subject = SecurityUtils.getSubject();</span><br><span class="line">        User user = (User)subject.getPrincipal();</span><br><span class="line">        info.addStringPermission(user.getAuthor());</span><br><span class="line">        Session session = subject.getSession();</span><br><span class="line">        session.setAttribute(&quot;loginUser&quot;,user);</span><br><span class="line">        return info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    //认证</span><br><span class="line">    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authenticationToken) throws AuthenticationException &#123;</span><br><span class="line">      //登录</span><br><span class="line">        UsernamePasswordToken token = (UsernamePasswordToken) authenticationToken;</span><br><span class="line">        User user = userService.queryUserByName(token.getUsername());</span><br><span class="line">        if(user==null)&#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        return new SimpleAuthenticationInfo(user,user.getPassword(),&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(&quot;noauth&quot;)</span><br><span class="line"> @ResponseBody</span><br><span class="line"> public String toNoAuthor()&#123;</span><br><span class="line">     return &quot;您还没有该权限访问&quot;;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h1 id="五-springboot"><a href="#五-springboot" class="headerlink" title="五.springboot"></a>五.springboot</h1><p>springboot的头部配置文件（连接数据库）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.hnkj.springbootandmybatis.mapper.FindStudentMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryUserByName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.hnkj.springbootandmybatis.pojo.Student&quot;</span>&gt;</span></span><br><span class="line">        select * from student</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1springboot的思维导图</p>
<p><img src="D:\QQ截图20220310111027.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220310111027.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220310111027"></p>
<p>官网：<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-boot">https://spring.io/projects/spring-boot</a></p>
<h2 id="1-springboot的特点："><a href="#1-springboot的特点：" class="headerlink" title="1.springboot的特点："></a>1.springboot的特点：</h2><p>1️⃣管理依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span>			####这是一个父工程</span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span>			</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span>			###子项目，声明了所有依赖的版本</span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2️⃣依赖管理的自动仲裁</p>
<properties>
		<mysql.verson>5.1.43</mysql.verson>
	</properties>

<p>3️⃣profile的环境切换</p>
<p>1.默认的properties、properties-prod、properties-test的环境切换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.profiles.actives = test</span><br></pre></td></tr></table></figure>

<p>2.命令行激活</p>
<p>java -jar 包名 –spring.profiles.actives &#x3D; test</p>
<p>####也可以修改配置文件的任意值</p>
<p>java -jar 包名 –spring.profiles.actives &#x3D; test –person.name&#x3D;zhangsan</p>
<p>####指定环境与默认环境都会运行，如果默认的配置与指定环境的配置相同时，制定环境的配置会覆盖默认环境的配置</p>
<p>3.profile条件装配</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建Worker.java</span></span><br><span class="line"><span class="meta">@Profile(&quot;test&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Worker</span> <span class="keyword">implements</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建Boss.java</span></span><br><span class="line"><span class="meta">@Profile(&quot;prod&quot;)</span>		<span class="comment">//指定环境</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Boss</span> <span class="keyword">implements</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line">    Integer <span class="title function_">getAge</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">zhangsan</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>3️⃣springboot的自动装配的原理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Demo2Application.class, args);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>1.@SpringBootApplication注解中包含了三种注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootConfiguration</span>   <span class="comment">//@Configuration  ===》主配置类</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span>	</span><br><span class="line"><span class="meta">@ComponentScan</span>   <span class="comment">//配置包扫描</span></span><br></pre></td></tr></table></figure>

<p>2.@EnableAutoConfiguration</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span></span><br></pre></td></tr></table></figure>

<p>3.@AutoConfigurationPackage自动配置包？</p>
<p>子包@Import({Registrar.class})</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">    <span class="comment">//metadata参数是注解的信息    </span></span><br><span class="line">    <span class="comment">//registry导入了主类下面的所有的组件</span></span><br><span class="line">    AutoConfigurationPackages.register(registry, (String[])(</span><br><span class="line">             <span class="keyword">new</span> 			        <span class="title class_">AutoConfigurationPackages</span>.PackageImports(metadata)).getPackageNames().toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]));</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>new AutoConfigurationPackages.PackageImports(metadata)&#x3D;&#x3D;&#x3D;》当前的主程序下的包</p>
<p>Import({Registrar.class})导入了当前的主程序下的包极其子包下的组件</p>
<p>4.@Import({AutoConfigurationImportSelector.class})选择性导入组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">    if (!this.isEnabled(annotationMetadata)) &#123;</span><br><span class="line">        return NO_IMPORTS;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        AutoConfigurationImportSelector.AutoConfigurationEntry autoConfigurationEntry = this.getAutoConfigurationEntry(annotationMetadata);</span><br><span class="line">        return StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>this.getAutoConfigurationEntry(annotationMetadata)给容器中导入一系列的组件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; configurations = <span class="built_in">this</span>.getCandidateConfigurations(annotationMetadata, attributes);<span class="comment">//导入需要导入容器中需要的组件</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(<span class="built_in">this</span>.getSpringFactoriesLoaderFactoryClass(), <span class="built_in">this</span>.getBeanClassLoader())   <span class="comment">//运用工厂加载所有组件</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Enumeration</span> <span class="variable">urls</span> <span class="operator">=</span> classLoader.getResources(<span class="string">&quot;META-INF/spring.factories&quot;</span>);<span class="comment">//读取该文件下的配置</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.LifecycleAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveElasticsearchRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveElasticsearchRestClientAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.jdbc.JdbcRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoReactiveDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoReactiveRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jReactiveDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jReactiveRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.r2dbc.R2dbcDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.r2dbc.R2dbcRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.elasticsearch.ElasticsearchRestClientAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.http.HttpMessageConvertersAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.http.codec.CodecsAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.influx.InfluxDbAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jsonb.JsonbAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.availability.ApplicationAvailabilityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.MongoReactiveAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.neo4j.Neo4jAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.netty.NettyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.quartz.QuartzAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.r2dbc.R2dbcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.r2dbc.R2dbcTransactionManagerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.rsocket.RSocketMessagingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.rsocket.RSocketRequesterAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.rsocket.RSocketServerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.rsocket.RSocketStrategiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.reactive.ReactiveSecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.reactive.ReactiveUserDetailsServiceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.rsocket.RSocketSecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.saml2.Saml2RelyingPartyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.session.SessionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.oauth2.client.reactive.ReactiveOAuth2ClientAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.oauth2.resource.reactive.ReactiveOAuth2ResourceServerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.sql.init.SqlInitializationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.task.TaskSchedulingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.HttpHandlerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.ReactiveMultipartAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.ReactiveWebServerFactoryAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.WebFluxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.WebSessionIdResolverAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.error.ErrorWebFluxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.function.client.ClientHttpConnectorAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.reactive.WebSocketReactiveAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.servlet.WebSocketServletAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.servlet.WebSocketMessagingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.webservices.client.WebServiceTemplateAutoConfiguration</span><br></pre></td></tr></table></figure>

<p>springboot启动时会自动加载这些组件</p>
<p>但是在springboot自动导入时并没有这么多的组件，所以有条件装配导入一些配置类</p>
<h2 id="2-configuration注解"><a href="#2-configuration注解" class="headerlink" title="2.@configuration注解"></a>2.@configuration注解</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Spring3.0开始，@Configuration用于定义配置类，定义的配置类可以替换xml文件，一般和@Bean注解联合使用。</span><br><span class="line"></span><br><span class="line">@Configuration注解主要标注在某个类上，相当于xml配置文件中的&lt;beans&gt;</span><br><span class="line"></span><br><span class="line">@Bean注解主要标注在某个方法上，相当于xml配置文件中的&lt;bean&gt;</span><br></pre></td></tr></table></figure>

<p>注解的使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConfig</span> &#123;</span><br><span class="line">	<span class="meta">@Bean</span>		<span class="meta">@Bean</span>的方法名如果没有命名就默认按方法，name可以定义<span class="meta">@Bean</span>的名字，方法的返回值就是Bean的保存的对象</span><br><span class="line">        <span class="comment">//方法返回的类型为Bean的类型</span></span><br><span class="line">	<span class="keyword">public</span> com.hnkjdemo.User <span class="title function_">user</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">com</span>.hnkjdemo.User(<span class="string">&quot;zhangsan&quot;</span>, <span class="number">12</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">	ConfigurableApplicationContext run = SpringApplication.run(SpringbootTestApplication.class, args);</span><br><span class="line">	User bean = run.getBean(&quot;user&quot;,com.hnkjdemo.pojo.User.class);</span><br><span class="line">	System.out.println(bean);    //  User&#123;username=&#x27;张三&#x27;, age=12&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>4️⃣从容器获取的组件默认为单实例的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">	ConfigurableApplicationContext run = SpringApplication.run(SpringbootTestApplication.class, args);</span><br><span class="line">	User bean = run.getBean(&quot;user&quot;,com.hnkjdemo.pojo.User.class);</span><br><span class="line">	User bean1 = run.getBean(&quot;user&quot;,com.hnkjdemo.pojo.User.class);</span><br><span class="line">	System.out.println(bean==bean2);  //true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5️⃣配置类也是容器中的Bean实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserConfig bean2 = run.getBean(com.hnkjdemo.config.UserConfig.class);</span><br></pre></td></tr></table></figure>

<p>​	在@Bean中proxyBeanMethods代理Bean方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Configuration(proxyBeanMethods=true)	//保持了组件的单实例</span><br><span class="line">public class UserConfig &#123;</span><br><span class="line">	@Bean</span><br><span class="line">	public com.hnkjdemo.User user() &#123;</span><br><span class="line">		return new com.hnkjdemo.User(&quot;zhangsan&quot;, 12);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UserConfig bean2 = run.getBean(com.hnkjdemo.config.UserConfig.class);</span><br><span class="line">User user = bean2.user();</span><br><span class="line">User user1 = bean2.user();</span><br><span class="line">System.out.println(user==user1);   //true</span><br></pre></td></tr></table></figure>

<p>proxyBeanMethods实现了组件之间的相互依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">    private String username;</span><br><span class="line">    private Integer age;</span><br><span class="line">    private Pet pet;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public class Pet &#123;</span><br><span class="line">    private  String name;</span><br><span class="line">    private Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Configuration(proxyBeanMethods = true)</span><br><span class="line">public class UserConfig &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    public User user()&#123;				//user组件依赖了pet组件</span><br><span class="line">        User user = new User();</span><br><span class="line">        user.setUsername(&quot;张三&quot;);</span><br><span class="line">        user.setAge(12);</span><br><span class="line">        user.setPet(pet());</span><br><span class="line">        return user;</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean</span><br><span class="line">    public Pet pet()&#123;</span><br><span class="line">        return new Pet(&quot;唐老鸭&quot;,2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">      ConfigurableApplicationContext run = SpringApplication.run(SpringbootTestApplication.class, args);</span><br><span class="line">      User user = run.getBean(&quot;user&quot;, User.class);</span><br><span class="line">      System.out.println(user);			//User(username=张三, age=12, pet=Pet(name=唐老鸭, age=2))</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-import注解"><a href="#3-import注解" class="headerlink" title="3.@import注解"></a>3.@import注解</h2><p>给容器导入一系列的组件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;User.class&#125;)</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">12</span>);</span><br><span class="line">        user.setPet(pet());</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Pet <span class="title function_">pet</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pet</span>(<span class="string">&quot;唐老鸭&quot;</span>,<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    ConfigurableApplicationContext run = SpringApplication.run(SpringbootTestApplication.class, args);</span><br><span class="line">    String[] beanNamesForType = run.getBeanNamesForType(User.class);</span><br><span class="line">    for (String u:beanNamesForType) &#123;</span><br><span class="line">        System.out.println(u);</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">    com.guigu.springboottest.pojo.User</span><br><span class="line">user</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>



<h2 id="4-conditional注解"><a href="#4-conditional注解" class="headerlink" title="4.conditional注解"></a>4.conditional注解</h2><p>1️⃣@ConditionalOnBean：有某一个组件才注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;User.class&#125;)</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConfig</span> &#123;</span><br><span class="line">    <span class="meta">@ConditionalOnBean(name = &quot;pet&quot;)</span>		<span class="comment">//有pet组件时才注册user组件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">12</span>);</span><br><span class="line">        user.setPet(pet());</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Pet <span class="title function_">pet</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pet</span>(<span class="string">&quot;唐老鸭&quot;</span>,<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2️⃣@ConditionalOnMissingBean(name &#x3D; “pet”)当容器中没有改组件时才注册组件</p>
<p>3️⃣@ImportResource(“classpath:beans.xml”) 导入xml等资源</p>
<h2 id="5-configurationproperties注解"><a href="#5-configurationproperties注解" class="headerlink" title="5.configurationproperties注解"></a>5.configurationproperties注解</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mycar.brand</span>=<span class="string">BYD</span></span><br><span class="line"><span class="attr">mycar.price</span>=<span class="string">100000</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;mycar&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.@EnableConfigurationProperties(User.class)</p>
<p>User组件自动注册 User的配置绑定&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;》导入其他的第三方包</p>
<h2 id="6-springboot自动配置原理"><a href="#6-springboot自动配置原理" class="headerlink" title="6.springboot自动配置原理"></a>6.springboot自动配置原理</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootConfiguration</span>	===》<span class="meta">@Configuration</span>配置类</span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span>	===》<span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@ComponentScan(				//包扫描</span></span><br><span class="line"><span class="meta">    excludeFilters = &#123;@Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;TypeExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">), @Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">)&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure>

<h2 id="7-lombok"><a href="#7-lombok" class="headerlink" title="7.lombok"></a>7.lombok</h2><p>简化get、set、tostring、有参 无参 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span>					get set方法</span><br><span class="line"><span class="meta">@ToString</span>				Tostring方法</span><br><span class="line"><span class="meta">@AllArgsConstructor</span>		有参构造</span><br><span class="line"><span class="meta">@NoArgsConstructor</span>		无参构造</span><br></pre></td></tr></table></figure>

<h2 id="8-dev-tools"><a href="#8-dev-tools" class="headerlink" title="8.dev-tools"></a>8.dev-tools</h2><p>作用：避免修改代码时重复的重启实例</p>
<p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>###ctrl+F9即可重启实例</p>
<h2 id="9-spring-initializr"><a href="#9-spring-initializr" class="headerlink" title="9.spring-initializr"></a>9.spring-initializr</h2><p>构建项目时可以直接选择要导入的依赖即可</p>
<p>####需要联网idea自动下载依赖</p>
<h2 id="10-springboot的核心功能"><a href="#10-springboot的核心功能" class="headerlink" title="10.springboot的核心功能"></a>10.springboot的核心功能</h2><h3 id="1-yaml的用法"><a href="#1-yaml的用法" class="headerlink" title="1.yaml的用法"></a>1.yaml的用法</h3><p>1️⃣yaml的基本用法</p>
<ul>
<li>在kv之间需要有间隔</li>
<li>大小写敏感</li>
<li>使用缩进表示层级关系</li>
<li>缩进时不允许使用tab键，只能使用空格</li>
<li>缩进的空格数不重要，只要层级的元素左对齐即可</li>
<li>#号表示注释</li>
</ul>
<p>2️⃣数据类型</p>
<ul>
<li><p>字符串</p>
</li>
<li><p>布尔值</p>
</li>
<li><p>整数</p>
</li>
<li><p>浮点数</p>
</li>
<li><p>Null</p>
</li>
<li><p>时间</p>
</li>
<li><p>日期</p>
<h2 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(&quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span>  <span class="type">boolean</span> boss;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Pet pet;</span><br><span class="line">    <span class="keyword">private</span> String [] inters;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; animal;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; score;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Double&gt; salary;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,List&lt;Pet&gt;&gt; allPets;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建一个application.yaml配置文件</p>
<p><img src="D:\QQ截图20220310225752.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220310225752.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220310225752"></p>
<p><img src="D:\QQ截图20220310225854.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220310225854.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220310225854"></p>
</li>
</ul>
<h2 id="11、web开发"><a href="#11、web开发" class="headerlink" title="11、web开发"></a>11、web开发</h2><p>导图</p>
<p><img src="D:\QQ截图20220311205744.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220311205744.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220311205744"></p>
<h4 id="1-静态资源的访问"><a href="#1-静态资源的访问" class="headerlink" title="1.静态资源的访问"></a>1.静态资源的访问</h4><p>1️⃣静态资源的目录（除templates下的目录）</p>
<p><img src="D:\QQ截图20220311210547.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220311210547.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220311210547"></p>
<p>访问静态资源的方式：项目名&#x2F;+资源名字</p>
<p>####当访问的动态资源目录与静态资源的路径一样时，优先访问动态路径，在去访问静态资源，如果动态、静态资源都没有找到时，出现状态码404</p>
<p>2️⃣配置添加静态资源的前缀</p>
<p>默认是没有前缀的</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">static-path-pattern:</span> [<span class="string">/res/</span>]</span><br></pre></td></tr></table></figure>



<p>指定静态资源的路径</p>
<p>在haha的内路径下是一个静态资源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  web:</span><br><span class="line">    resources:</span><br><span class="line">      static-locations: /haha/</span><br></pre></td></tr></table></figure>

<p>###在访问时不需要把静态的名字放在访问的路径上</p>
<p>3️⃣webjars</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="D:\QQ截图20220311213834.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220311213834.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220311213834"></p>
<h4 id="2-welcome与favicon的功能"><a href="#2-welcome与favicon的功能" class="headerlink" title="2.welcome与favicon的功能"></a>2.welcome与favicon的功能</h4><h5 id="1-欢迎页支持"><a href="#1-欢迎页支持" class="headerlink" title="1.欢迎页支持"></a>1.欢迎页支持</h5><p>在静态资源下创建index.html页面</p>
<p>1️⃣可以配置静态资源的路径</p>
<p>2️⃣但是不可以添加静态的前缀，否则导致HTML不会被默认访问（localhost:8080&#x2F;&#x3D;&#x3D;&#x3D;&gt;直接进入到index的界面）</p>
<h5 id="2-favicon的使用"><a href="#2-favicon的使用" class="headerlink" title="2.favicon的使用"></a>2.favicon的使用</h5><p>在静态资源中创建favicon.ico（图标）</p>
<p>####不能自定义前缀，否则不能刷新出来；或者在浏览器当中禁用缓存</p>
<h5 id="3-静态配置原理"><a href="#3-静态配置原理" class="headerlink" title="3.静态配置原理"></a>3.静态配置原理</h5><h4 id="3-请求参数的处理"><a href="#3-请求参数的处理" class="headerlink" title="3.请求参数的处理"></a>3.请求参数的处理</h4><p>rest风格(get、post、put、delete等各种的请求)</p>
<p>但是在<from>表单当中的method默认是没有delete、put请求，需要以下的两步操作</p>
<p>1️⃣</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;/user&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;delete&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;delete提交&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>2️⃣</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">hiddenmethod:</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="4-常用的注解"><a href="#4-常用的注解" class="headerlink" title="4.常用的注解"></a>4.常用的注解</h4><p>1️⃣@PathVariable：获取路径中的变量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/car/&#123;id&#125;/owner/&#123;username&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">car</span><span class="params">(<span class="meta">@PathVariable</span> String id,</span></span><br><span class="line"><span class="params">                              <span class="meta">@PathVariable</span> String username,</span></span><br><span class="line"><span class="params">                              <span class="meta">@PathVariable</span> Map&lt;String,String&gt; pv)</span>&#123;</span><br><span class="line">    Map&lt;String,Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    hashMap.put(<span class="string">&quot;id&quot;</span>,id);</span><br><span class="line">    hashMap.put(<span class="string">&quot;username&quot;</span>,username);</span><br><span class="line">    hashMap.put(<span class="string">&quot;pv&quot;</span>,pv);</span><br><span class="line">    <span class="keyword">return</span> hashMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2️⃣@RequestHeader(“User-Agent”) ：获取请求头的信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;/car/&#123;id&#125;/owner/&#123;username&#125;&quot;)</span><br><span class="line">@ResponseBody</span><br><span class="line">public Map&lt;String,Object&gt; car(@PathVariable(&quot;id&quot;) String id,</span><br><span class="line">                              @PathVariable(&quot;username&quot;) String username,</span><br><span class="line">                              @PathVariable Map&lt;String,String&gt; pv,</span><br><span class="line">                              @RequestHeader(&quot;User-Agent&quot;) String userAgent)&#123;</span><br><span class="line">    Map&lt;String,Object&gt; hashMap = new HashMap&lt;&gt;();</span><br><span class="line">    hashMap.put(&quot;id&quot;,id);</span><br><span class="line">    hashMap.put(&quot;username&quot;,username);</span><br><span class="line">    hashMap.put(&quot;pv&quot;,pv);</span><br><span class="line">    hashMap.put(&quot;User_Agent&quot;,userAgent);</span><br><span class="line">    return hashMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3️⃣@RequestParam（“ID”）：获取请求的参数</p>
<p>4️⃣@CookieValue(“NMTID”):获取cookie的值</p>
<p>​	 @cookieValue(“NMTID”) Cookie cookie 将所有的cookie拿到</p>
<p>5️⃣@requestBody:获取请求体【post】</p>
<p>6️⃣@requestAttribute:获取请求域属性</p>
<p><img src="D:\QQ截图20220312155118.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220312155118.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220312155118"></p>
<p>7️⃣@matrixVariable</p>
<p>实现webmvcConfig</p>
<p><img src="D:\QQ截图20220312160955.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220312160955.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220312160955"></p>
<p><img src="D:\QQ截图20220312161152.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220312161152.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220312161152"></p>
<h2 id="12文件上传"><a href="#12文件上传" class="headerlink" title="12文件上传"></a>12文件上传</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/upload&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>邮箱<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>名字<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>头像<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;headerImg&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>生活照<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;photos&quot;</span> <span class="attr">multiple</span>&gt;</span>		<span class="comment">&lt;!--multiple为多文件上传--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>设置文件上传的大小和请求文件上传的大小</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">10MB</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">100MB</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(&quot;email&quot;)</span> String email,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(&quot;username&quot;)</span> String username,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestPart(&quot;headerImg&quot;)</span>MultipartFile headerImg,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestPart(&quot;photos&quot;)</span> MultipartFile [] photos)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">if</span>(!headerImg.isEmpty())&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> headerImg.getOriginalFilename();</span><br><span class="line">        headerImg.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D://音乐/&quot;</span>+originalFilename));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(photos.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (MultipartFile photo : photos) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> photo.getOriginalFilename();</span><br><span class="line">            photo.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D://音乐/&quot;</span>+originalFilename));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>  <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="springboot默认处理机制"><a href="#springboot默认处理机制" class="headerlink" title="springboot默认处理机制"></a>springboot默认处理机制</h2><p>在springboot中常见的错误有404，5xx</p>
<p>###如果想要自己的错误页面，在template中创建error的项目，建立5xx.html和404.html(需要引入Thymeleaf标签)</p>
<p>##在template中创建error项目？</p>
<p>##可动态路径指向error中的资源，当动态路径没有找到资源时，会在静态资源当中查找。</p>
<h2 id="13-Redis"><a href="#13-Redis" class="headerlink" title="13.Redis"></a>13.Redis</h2><p>序列化方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class RdisConfig &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    RedisConnectionFactory redisConnectionFactory ;</span><br><span class="line">    @Bean</span><br><span class="line">    public RedisTemplate&lt;String,Object&gt; redisTemplate()&#123;</span><br><span class="line">        RedisTemplate&lt;String,Object&gt; redisTemplate  = new RedisTemplate&lt;&gt;() ;</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">//        指定kv的序列化方式</span><br><span class="line">        Jackson2JsonRedisSerializer jsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class) ;</span><br><span class="line">//        redisTemplate.setDefaultSerializer(jsonRedisSerializer);</span><br><span class="line">        redisTemplate.setValueSerializer(jsonRedisSerializer) ;</span><br><span class="line">        redisTemplate.setKeySerializer(new StringRedisSerializer());</span><br><span class="line">        return redisTemplate ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="1-Nosql"><a href="#1-Nosql" class="headerlink" title="1.Nosql"></a>1.Nosql</h3><p>即就是非关系型数据库，作为关系型数据库的补充。</p>
<p>作用：</p>
<ol>
<li>可扩容、可伸缩</li>
<li>大数据量高性能</li>
<li>灵活的数据模型</li>
<li>高可用</li>
</ol>
<p>特征：</p>
<p>1.数据之间没有关联关系</p>
<p>2.内部采用单线程进行工作</p>
<p>3.高性能</p>
<p>4.多数据类型的支持</p>
<p>5.持久化支持</p>
<h3 id="2-Redis的下载安装"><a href="#2-Redis的下载安装" class="headerlink" title="2.Redis的下载安装"></a>2.Redis的下载安装</h3><p> ###基于Windows版</p>
<p>下载的路径：E:\Redis</p>
<p>Redis的运行：在redis-server.exe的目录中用cmd在输入redis-server redis.windows.conf就可以启动了</p>
<p>linux版：<code>https://download.redis.io/releases/</code></p>
<h3 id="3、Redis的入门"><a href="#3、Redis的入门" class="headerlink" title="3、Redis的入门"></a>3、Redis的入门</h3><p>1️⃣在Redis中设置值</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.查看所有的键值</span><br><span class="line">keys *</span><br><span class="line"><span class="number">2</span>.查看是否有值</span><br><span class="line">exists list0</span><br><span class="line"><span class="number">3</span>.删除键</span><br><span class="line"> <span class="built_in">del</span> list0</span><br><span class="line"><span class="number">4</span>.判断键值的类型</span><br><span class="line"><span class="built_in">type</span> 键  ##如果没有该键的话，就会返回一个none</span><br><span class="line"><span class="number">5</span>.设置过期的时间</span><br><span class="line">expire 键名 时间</span><br><span class="line">查看键还有多少时间过期</span><br><span class="line">ttl 键    ### -<span class="number">1</span>是永不过期 -<span class="number">2</span>是已经过期</span><br><span class="line">flushdb 清空所有的键值</span><br><span class="line"><span class="number">6</span>.setnx 键 值</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> name itheima  ## 重新设置key会重置值</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2️⃣在Redis中获取值</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get name</span><br></pre></td></tr></table></figure>

<p>3️⃣帮助</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">help</span> get</span><br></pre></td></tr></table></figure>

<p>4️⃣退出客户端的命令</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">exit</span>    或者 esc   quit</span><br></pre></td></tr></table></figure>

<h3 id="4-Redis数据储存类型的介绍"><a href="#4-Redis数据储存类型的介绍" class="headerlink" title="4.Redis数据储存类型的介绍"></a>4.Redis数据储存类型的介绍</h3><p>Redis的基本数据类型</p>
<ol>
<li>String</li>
<li>hash</li>
<li>list</li>
<li>set</li>
<li>sorted_set</li>
</ol>
<h5 id="1-String数据类型的操作"><a href="#1-String数据类型的操作" class="headerlink" title="1.String数据类型的操作"></a>1.String数据类型的操作</h5><ul>
<li>添加、修改数据</li>
</ul>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> name zhangsan</span><br><span class="line">######一次性储存多个数据</span><br><span class="line">mset username zhangsan password <span class="number">1234</span></span><br></pre></td></tr></table></figure>

<ul>
<li>获取数据</li>
</ul>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">get name</span><br><span class="line">#####一次性获取多个数据</span><br><span class="line">mget username password</span><br><span class="line">####获取数据字符的个数</span><br><span class="line">strlen password</span><br><span class="line">####追加数据</span><br><span class="line"><span class="built_in">append</span> password <span class="number">300</span>   ####<span class="number">7</span>，字符的长度</span><br></pre></td></tr></table></figure>

<ul>
<li>删除数据</li>
</ul>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">del</span> name</span><br></pre></td></tr></table></figure>

<p>#####如果在次删除的话，就显示0，表示删除失败</p>
<h5 id="2-String类型数据的拓展操作"><a href="#2-String类型数据的拓展操作" class="headerlink" title="2.String类型数据的拓展操作"></a>2.String类型数据的拓展操作</h5><p>1️⃣数值自动加1</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incr num    ###没有定义num就默认是<span class="number">0</span>  ====》<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>2️⃣指定数值加几</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incrby num <span class="number">10</span>    ====&gt;<span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>3️⃣数值自动减</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">decr num</span><br></pre></td></tr></table></figure>

<p>4️⃣指定数值减几</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">decrby num <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>5️⃣指定数值加小数</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incrbyfloat num <span class="number">1</span>.<span class="number">5</span>   ===&gt;<span class="number">1</span>.<span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>####如果使用incr来加小数，会超出范围</p>
<p>6️⃣设置数据具有生命周期</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setex num <span class="number">10</span> <span class="number">1</span>     ####num的值是<span class="number">1</span>，num的值储存在的时间为<span class="number">10</span>秒 =====》具体的使用的场景是投票</span><br></pre></td></tr></table></figure>

<p>7️⃣String类型的注意事项</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220314093006855.png" class="lazyload placeholder" data-srcset="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220314093006855.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220314093006855"></p>
<h5 id="3-String类型的应用场景"><a href="#3-String类型的应用场景" class="headerlink" title="3.String类型的应用场景"></a>3.String类型的应用场景</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> user:id:<span class="number">00078</span>:fans <span class="number">1000</span></span><br></pre></td></tr></table></figure>

<h5 id="4-hash类型的数据操作"><a href="#4-hash类型的数据操作" class="headerlink" title="4.hash类型的数据操作"></a>4.hash类型的数据操作</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hset user name zhangsan   ====&gt;(integer)<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>获取数据</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hget user name  ====&gt;&quot;zhangsan&quot;</span><br></pre></td></tr></table></figure>

<p>获取所有数据</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgetall user	</span><br></pre></td></tr></table></figure>

<p>获取多个数据</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hmget user name age				<span class="number">1</span>) &quot;zhangsan&quot; <span class="number">2</span>) &quot;<span class="number">20</span>&quot;</span><br></pre></td></tr></table></figure>

<p>设置多个数据</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hmset user name zhangsanfen age <span class="number">50</span> weight <span class="number">60</span></span><br></pre></td></tr></table></figure>

<p>查找hash表中是否存在该字段（存在1，不存在0）</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexists user age ====&gt;<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>查看hash表中字段的个数</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hlen user    =====&gt;<span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>获取hash表中key值</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hkeys user</span><br></pre></td></tr></table></figure>

<p>获取has后的values值</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hvlus user</span><br></pre></td></tr></table></figure>

<p>指定User中age加一</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hget user name   ====&gt;<span class="number">50</span></span><br></pre></td></tr></table></figure>

<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hincrby user age <span class="number">1</span> =====&gt;<span class="number">51</span>    ####指定一个值加一</span><br></pre></td></tr></table></figure>

<p>提取hash</p>
<p>hsetnx 0002 goods03:desc {cs}    ####用户编号有goods03的商品</p>
<h5 id="5-list类型"><a href="#5-list类型" class="headerlink" title="5.list类型"></a>5.list类型</h5><p>储存的需求：储存多个数据，并对数据进入储存空间的顺序进行区分</p>
<p>需要的储存结构：一个储存空间可以有多个数据，双向链表的实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">###list类型数据存储</span><br><span class="line">lpush list0 a b   ####在list0数组中存储a、b数据</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">###去除list类型数据</span><br><span class="line">lpop list0 		  ####在插入的时候从左侧，取出数据时从右边开始  先b后a</span><br></pre></td></tr></table></figure>

<h5 id="6-list数据的拓展操作"><a href="#6-list数据的拓展操作" class="headerlink" title="6.list数据的拓展操作"></a>6.list数据的拓展操作</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">####查看所有数据</span><br><span class="line">lrange list0 <span class="number">0</span> -<span class="number">1</span></span><br><span class="line">####指定移除的元素</span><br><span class="line">lrem list0 <span class="number">1</span> d     #####d是list0里面的元素</span><br></pre></td></tr></table></figure>

<h5 id="7-list的注意事项"><a href="#7-list的注意事项" class="headerlink" title="7.list的注意事项"></a>7.list的注意事项</h5><p>一、list保存的数据都是String类型，数据总容量是有限，最多是2**32-1</p>
<p>二、list具有索引的概念</p>
<p>三、list里面的最后一个数据的索引是-1</p>
<h5 id="8-set数据的存储（双向链表）"><a href="#8-set数据的存储（双向链表）" class="headerlink" title="8.set数据的存储（双向链表）"></a>8.set数据的存储（双向链表）</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">####数据存储,添加键值,name为键 ，其他的为值,如果存入了相同的值就会去掉后面的相同的值</span><br><span class="line">sadd name &#x27;lizhien&#x27; &#x27;iu&#x27;</span><br><span class="line">####取出键的所有值</span><br><span class="line">smembers name</span><br><span class="line">####判断键的值是否包含该值</span><br><span class="line">sismember name lizhien</span><br><span class="line">#### 删除集合中的一个元素</span><br><span class="line">srem name iu</span><br><span class="line">####随机在集合中吐出一个值,取出之后就没有了该值(场景：随机抽奖的场景)</span><br><span class="line">spop name</span><br><span class="line">####随机在集合吐出一个值但是不会去掉该值</span><br><span class="line">srandmember name</span><br><span class="line">####将一个<span class="built_in">set</span>集合的数据放入到另一个<span class="built_in">set</span>集合，一次性只能转一个数据</span><br><span class="line">smove 原集合 目标集合 原目标数据</span><br><span class="line">####返回两个集合的差集元素，这里的集合相当于是一个键，集合的元素相当于是键的值</span><br><span class="line">sdiff 集合<span class="number">1</span> 集合<span class="number">2</span></span><br></pre></td></tr></table></figure>

<h5 id="9-redis的Hash部分"><a href="#9-redis的Hash部分" class="headerlink" title="9.redis的Hash部分"></a>9.redis的Hash部分</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redis的hash实际上是键值对的集合</span><br><span class="line">什么是键值对的集合？就相当于键是String类型的，但是键的值是object类型，hash特别适用于存储对象</span><br><span class="line"></span><br><span class="line">存储对象的三种方式</span><br><span class="line"><span class="number">1</span>.把对象进行序列化成字符串但是这样对对象进行的属性操作比较花费时间</span><br><span class="line"><span class="number">2</span>.将对象的属性进行分开比如：user:id 、 user:name 、 user:age，好操作对象的属性，但是这样数据会很混乱</span><br><span class="line"><span class="number">3</span>.运用hash，直接将对象存入到Redis中即可</span><br></pre></td></tr></table></figure>

<p>基本使用：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; hset student:<span class="number">1001</span> id <span class="number">1</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; hget student:<span class="number">1001</span> id</span><br><span class="line">&quot;<span class="number">1</span>&quot;</span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; hset student:<span class="number">1001</span> name lizhien</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; hget student:<span class="number">1001</span> name</span><br><span class="line">&quot;lizhien&quot;</span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; hmset student:<span class="number">1002</span> id <span class="number">2</span> name jjy</span><br><span class="line">OK</span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; hget student:<span class="number">1002</span> name</span><br><span class="line">&quot;jjy&quot;</span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; hexists student:<span class="number">1001</span> name</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; hkeys student:<span class="number">1002</span>  ### 遍历所有的key</span><br><span class="line"><span class="number">1</span>) &quot;id&quot;</span><br><span class="line"><span class="number">2</span>) &quot;name&quot;</span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; hvals student:<span class="number">1002</span>  ### 遍历所有的value</span><br><span class="line"><span class="number">1</span>) &quot;<span class="number">2</span>&quot;</span><br><span class="line"><span class="number">2</span>) &quot;jjy&quot;</span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; hset student:<span class="number">1002</span> age <span class="number">30</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; hincrby student:<span class="number">1002</span> age -<span class="number">10</span></span><br><span class="line">(integer) <span class="number">20</span></span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt;hsetnx student:<span class="number">1002</span> gender <span class="number">1</span>  ##当对象不含有该属性时才会添加</span><br><span class="line">(integer) <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h5 id="10-zset有序集合"><a href="#10-zset有序集合" class="headerlink" title="10.zset有序集合"></a>10.zset有序集合</h5><p>语法：zadd <key> <score1><value1><score2><value2>…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd topn 200 java 400 php 300 c++    ### 在这里它会自动进行排序</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; zrange topn 0 -1   ### 遍历score1(值)的value(评分)</span><br><span class="line">1) &quot;java&quot;</span><br><span class="line">2) &quot;c++&quot;</span><br><span class="line">3) &quot;php&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrange topn 0 -1 withscores   ###显示值和评分==》withscores显示评分</span><br><span class="line">1) &quot;java&quot;</span><br><span class="line">2) &quot;200&quot;</span><br><span class="line">3) &quot;c++&quot;</span><br><span class="line">4) &quot;300&quot;</span><br><span class="line">5) &quot;php&quot;</span><br><span class="line">6) &quot;400&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore topn 300 500 withscores  ###300~500之间的值并显示评分(在这里根据评分进行数据的查询)</span><br><span class="line">1) &quot;c++&quot;</span><br><span class="line">2) &quot;300&quot;</span><br><span class="line">3) &quot;php&quot;</span><br><span class="line">4) &quot;400&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrevrangebyscore topn 500 300   ###从大到小排序</span><br><span class="line">1) &quot;php&quot;</span><br><span class="line">2) &quot;c++&quot;</span><br><span class="line">127.0.0.1:6379&gt; zincrby topn 50 java</span><br><span class="line">&quot;250&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrem topn java         ### 删除set集合的元素</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zrange topn 0 -1</span><br><span class="line">1) &quot;c++&quot;</span><br><span class="line">2) &quot;php&quot;</span><br><span class="line">127.0.0.1:6379&gt; zcount topn 300 400    ### 查询在评分在300~400之间值的个数</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; zrange topn 0 -1 withscores</span><br><span class="line">1) &quot;c++&quot;</span><br><span class="line">2) &quot;300&quot;</span><br><span class="line">3) &quot;php&quot;</span><br><span class="line">4) &quot;400&quot;</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line">127.0.0.1:6379&gt; zrank topn c++		###显示排名从0开始</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; zrank topn php     </span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-消息的订阅与发布"><a href="#5-消息的订阅与发布" class="headerlink" title="5.消息的订阅与发布"></a>5.消息的订阅与发布</h3><p>1.开启两个客户端</p>
<p>注意：先要订阅消息第一次发布的消息才能成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">## 第一个客户端，先启动</span><br><span class="line">127.0.0.1:6379&gt; SUBSCRIBE channell</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) &quot;subscribe&quot;</span><br><span class="line">2) &quot;channell&quot;</span><br><span class="line">3) (integer) 1</span><br><span class="line">1) &quot;message&quot;</span><br><span class="line">2) &quot;channell&quot;</span><br><span class="line">3) &quot;lizhien&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">###第二个客户端</span><br><span class="line">127.0.0.1:6379&gt; publish channell hello</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; PUBLISH channell lizhien</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

<h3 id="6-新数据类型"><a href="#6-新数据类型" class="headerlink" title="6.新数据类型"></a>6.新数据类型</h3><p>bitMaps类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setbit student:20200101 1 1   ### 设置值(第一个1是偏移量，第二个1是设置的值)</span><br><span class="line">getbit student:20200101 1    ## 通过偏移量取值</span><br></pre></td></tr></table></figure>

<p>bitcount类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; bitcount student:20200101</span><br></pre></td></tr></table></figure>

<p>HyperLogLog类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">### 添加数据</span><br><span class="line">127.0.0.1:6379&gt; pfadd studnet lizhien iu ck</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfcount student</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; flushdb</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; pfadd program &quot;java&quot; &quot;c++&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfcount program  ## 计算program的个数</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; pfadd program &quot;java&quot;</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; pfadd k1 1 2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfcount k1</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; pfmerge k100 k1 program  ## 放入到一起</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; pfcount k100</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<p>Geospatial类型（存地理坐标）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">geoadd china:city 121.47 31.23 beijing</span><br><span class="line">geopos china:city beijing</span><br></pre></td></tr></table></figure>

<h3 id="7-jedis"><a href="#7-jedis" class="headerlink" title="7.jedis"></a>7.jedis</h3><h4 id="1-jedis的连接redis"><a href="#1-jedis的连接redis" class="headerlink" title="1.jedis的连接redis"></a>1.jedis的连接redis</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">6379</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">ping</span> <span class="operator">=</span> jedis.ping();</span><br><span class="line">System.out.println(ping);</span><br><span class="line"><span class="comment">// 如果是要连接Linux的IP，需要进行以下的操作</span></span><br><span class="line"><span class="comment">//1.bind指令需要注释掉</span></span><br><span class="line"><span class="comment">//2.关掉保护模式然后重启</span></span><br><span class="line"><span class="comment">//3.Linux系统的防火墙需要关掉</span></span><br></pre></td></tr></table></figure>

<h4 id="2-jedis的代码"><a href="#2-jedis的代码" class="headerlink" title="2.jedis的代码"></a>2.jedis的代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">		<span class="type">String</span> <span class="variable">ping</span> <span class="operator">=</span> jedis.ping();</span><br><span class="line">		System.out.println(ping); <span class="comment">//PONG：连接Redis成功</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//使用jedis操作String类型的数据</span></span><br><span class="line">		<span class="comment">//添加数据</span></span><br><span class="line"><span class="comment">//		jedis.set(&quot;name&quot;, &quot;李知恩&quot;);</span></span><br><span class="line"><span class="comment">//		jedis.set(&quot;name&quot;, &quot;鞠婧祎&quot;);</span></span><br><span class="line"><span class="comment">//		//取出数据</span></span><br><span class="line"><span class="comment">//		String name = jedis.get(&quot;name&quot;);</span></span><br><span class="line"><span class="comment">//		System.out.println(name); //鞠婧祎</span></span><br><span class="line">		</span><br><span class="line"><span class="comment">//		jedis.mset(&quot;name&quot;,&quot;鞠婧祎&quot;,&quot;name1&quot;,&quot;iu&quot;);</span></span><br><span class="line"><span class="comment">//		List&lt;String&gt; mget = jedis.mget(&quot;name&quot;,&quot;name1&quot;);</span></span><br><span class="line"><span class="comment">//		System.out.println(mget);</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取所有的键</span></span><br><span class="line"><span class="comment">//		Set&lt;String&gt; keys = jedis.keys(&quot;*&quot;);</span></span><br><span class="line"><span class="comment">//		for (String key : keys) &#123;</span></span><br><span class="line"><span class="comment">//			System.out.println(key);</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//使用jedis操作list数据</span></span><br><span class="line"><span class="comment">//		jedis.lpush(&quot;studentName&quot;, &quot;lizhien&quot;,&quot;iu&quot;,&quot;鞠婧祎&quot;,&quot;程潇&quot;);</span></span><br><span class="line"><span class="comment">//		List&lt;String&gt; studentNames = jedis.lrange(&quot;studentName&quot;, 0, -1);</span></span><br><span class="line"><span class="comment">//		for (String studentName : studentNames) &#123;</span></span><br><span class="line"><span class="comment">//			System.out.println(studentName);</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line"><span class="comment">//		String lpopStudentName = jedis.lpop(&quot;studentName&quot;);</span></span><br><span class="line"><span class="comment">//		System.out.println(lpopStudentName);</span></span><br><span class="line"><span class="comment">//		Long num = jedis.lrem(&quot;studentName&quot;, 0, &quot;程潇&quot;); //删除指定的数据</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//操作set数据</span></span><br><span class="line"><span class="comment">//		jedis.sadd(&quot;studentName&quot;, &quot;李知恩&quot;,&quot;iu&quot;);</span></span><br><span class="line"><span class="comment">//		Set&lt;String&gt; studentNames = jedis.smembers(&quot;studentName&quot;);</span></span><br><span class="line"><span class="comment">//		for (String studentName : studentNames) &#123;</span></span><br><span class="line"><span class="comment">//			System.out.println(studentName);</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line">		<span class="comment">//判断一个值是否存在</span></span><br><span class="line"><span class="comment">//		Boolean sismember = jedis.sismember(&quot;studentName&quot;, &quot;李知恩&quot;);</span></span><br><span class="line"><span class="comment">//		Boolean sismember2 = jedis.sismember(&quot;studentName&quot;, &quot;浮梦&quot;);</span></span><br><span class="line"><span class="comment">//		System.out.println(sismember+&quot;\n&quot;+sismember2);</span></span><br><span class="line">		<span class="comment">//随机取出一个值但是不删除</span></span><br><span class="line"><span class="comment">//		String studentName = jedis.srandmember(&quot;studentName&quot;);</span></span><br><span class="line"><span class="comment">//		System.out.println(&quot;随机取出的值为&quot;+studentName);</span></span><br><span class="line">		<span class="comment">//指定删除该值</span></span><br><span class="line"><span class="comment">//		Long srem1 = jedis.srem(&quot;studentName&quot;,&quot;李知恩&quot;);</span></span><br><span class="line"><span class="comment">//		System.out.println(srem1);</span></span><br><span class="line">		<span class="comment">//随机在集合中吐出一个值,取出之后就没有了该值(场景：随机抽奖的场景)</span></span><br><span class="line"><span class="comment">//		String spop = jedis.spop(&quot;studentName&quot;);</span></span><br><span class="line"><span class="comment">//		System.out.println(&quot;随机取出的数据是：&quot;+spop);</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//jedis操作hash类型的数据</span></span><br><span class="line"><span class="comment">//		Map&lt;String, String&gt; hash = new HashMap&lt;&gt;();</span></span><br><span class="line"><span class="comment">//		hash.put(&quot;1001&quot;, &quot;李知恩&quot;);</span></span><br><span class="line"><span class="comment">//		hash.put(&quot;1002&quot;, &quot;iu&quot;);</span></span><br><span class="line"><span class="comment">//		hash.put(&quot;1003&quot;, &quot;程潇&quot;);</span></span><br><span class="line"><span class="comment">//		jedis.hmset(&quot;studentName&quot;, hash);</span></span><br><span class="line"><span class="comment">//		String hget = jedis.hget(&quot;studentName&quot;, &quot;1001&quot;);</span></span><br><span class="line"><span class="comment">//		System.out.println(hget);</span></span><br><span class="line">		<span class="comment">//判断是否存在该值</span></span><br><span class="line"><span class="comment">//		Boolean hexists = jedis.hexists(&quot;studentName&quot;, &quot;1005&quot;);</span></span><br><span class="line"><span class="comment">//		System.out.println(hexists);</span></span><br><span class="line"><span class="comment">//		//遍历所有的键</span></span><br><span class="line"><span class="comment">//		Set&lt;String&gt; hkeys = jedis.hkeys(&quot;studentName&quot;);</span></span><br><span class="line"><span class="comment">//		for (String hkey : hkeys) &#123;</span></span><br><span class="line"><span class="comment">//			System.out.println(hkey);</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line"><span class="comment">//		//遍历所有的值</span></span><br><span class="line"><span class="comment">//		List&lt;String&gt; hvals = jedis.hvals(&quot;studentName&quot;);</span></span><br><span class="line"><span class="comment">//		for (String hval : hvals) &#123;</span></span><br><span class="line"><span class="comment">//			System.out.println(hval);</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//jedis操作zset类型数据</span></span><br><span class="line">		jedis.zadd(<span class="string">&quot;topn&quot;</span>, <span class="number">200</span> ,<span class="string">&quot;java&quot;</span>);</span><br><span class="line">		jedis.zadd(<span class="string">&quot;topn&quot;</span>, <span class="number">400</span> ,<span class="string">&quot;mysql&quot;</span>);</span><br><span class="line">		jedis.zadd(<span class="string">&quot;topn&quot;</span>, <span class="number">300</span> ,<span class="string">&quot;c语言&quot;</span>);</span><br><span class="line">		<span class="comment">//自动回从小到大排序输出</span></span><br><span class="line"><span class="comment">//		Set&lt;String&gt; zrange = jedis.zrange(&quot;topn&quot;, 0, -1);</span></span><br><span class="line"><span class="comment">//		for (String s : zrange) &#123;</span></span><br><span class="line"><span class="comment">//			System.out.println(s);</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line">		<span class="comment">//该从小到大的规则(排序的准则是积分的大小来定)</span></span><br><span class="line"><span class="comment">//		Set&lt;String&gt; byScore = jedis.zrevrangeByScore(&quot;topn&quot;, 400, 300);</span></span><br><span class="line"><span class="comment">//		for (String s : byScore) &#123;</span></span><br><span class="line"><span class="comment">//			System.out.println(s);</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line">		<span class="comment">//按条件查询并且显示积分</span></span><br><span class="line">		Set&lt;Tuple&gt; zrangeByScoreWithScores = jedis.zrangeByScoreWithScores(<span class="string">&quot;topn&quot;</span>, <span class="number">200</span>, <span class="number">300</span>);</span><br><span class="line">		<span class="keyword">for</span> (Tuple s : zrangeByScoreWithScores) &#123;</span><br><span class="line">			System.out.println(s);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-模拟手机验证码的发送"><a href="#3-模拟手机验证码的发送" class="headerlink" title="3.模拟手机验证码的发送"></a>3.模拟手机验证码的发送</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">String</span> <span class="variable">randomCode</span> <span class="operator">=</span> randomCode();</span><br><span class="line">	verifyCode(<span class="string">&quot;19958814235&quot;</span>,randomCode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//每一个手机号一天只能发三次验证码，将验证码放到Redis中，并且设置过期时间</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">verifyCode</span><span class="params">(String phone,String randomCode)</span> &#123;</span><br><span class="line">	<span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//手机发送验证码的次数</span></span><br><span class="line">	<span class="type">String</span> <span class="variable">countKey</span> <span class="operator">=</span> <span class="string">&quot;verifCode&quot;</span>+phone+<span class="string">&quot;:count&quot;</span>;</span><br><span class="line">	<span class="comment">//手机发送的验证码</span></span><br><span class="line">	<span class="type">String</span> <span class="variable">codeKey</span> <span class="operator">=</span> <span class="string">&quot;verifCode&quot;</span>+phone+<span class="string">&quot;:code&quot;</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//取出发送验证码的次数</span></span><br><span class="line">	<span class="type">String</span> <span class="variable">count</span> <span class="operator">=</span> jedis.get(countKey);</span><br><span class="line">	System.out.println(count);</span><br><span class="line">	<span class="comment">//第一次发送验证码</span></span><br><span class="line">	<span class="keyword">if</span>(count==<span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="comment">//存入数据的时间的单位是秒</span></span><br><span class="line">		jedis.setex(countKey, <span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(Integer.parseInt(count)&lt;=<span class="number">2</span>) &#123;</span><br><span class="line">		jedis.incr(countKey);</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(Integer.parseInt(count)&gt;<span class="number">2</span>)&#123;</span><br><span class="line">		System.err.println(<span class="string">&quot;今天发送的次数已经没有了.....&quot;</span>);</span><br><span class="line">		jedis.close();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//最后发送验证码到Redis上</span></span><br><span class="line">	jedis.setex(codeKey, <span class="number">120</span>, randomCode);</span><br><span class="line">	jedis.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//生成6位为验证码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">randomCode</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="type">String</span> <span class="variable">random</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">		random +=<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">10</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> random;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-事务和锁的机制"><a href="#5-事务和锁的机制" class="headerlink" title="5.事务和锁的机制"></a>5.事务和锁的机制</h3><h5 id="1-概念：什么是事务？"><a href="#1-概念：什么是事务？" class="headerlink" title="1.概念：什么是事务？"></a>1.概念：什么是事务？</h5><p>Redis事务中分为了3部分，multi，exec，discard，multi将要执行的命令放入到队列当中，如果队列中有报错则所有的队列的命令都不会执行，exec执行队列的命令，discard将放入到队列的命令全部取出，在执行exec后就不会执行指令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; multi</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; set name lizhien</span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; set age <span class="number">30</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; exec</span><br><span class="line"><span class="number">1</span>) OK</span><br><span class="line"><span class="number">2</span>) OK</span><br></pre></td></tr></table></figure>

<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; multi</span><br><span class="line">OK</span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> name zs</span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> age <span class="number">11</span>a</span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; incr age</span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; exec</span><br><span class="line"><span class="number">1</span>) OK</span><br><span class="line"><span class="number">2</span>) OK</span><br><span class="line"><span class="number">3</span>) (error) ERR value is <span class="keyword">not</span> an integer or out of range</span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt;</span><br><span class="line"></span><br><span class="line">### 就只有age执行失败，后面正常执行</span><br></pre></td></tr></table></figure>

<h5 id="6-乐观锁和悲观锁"><a href="#6-乐观锁和悲观锁" class="headerlink" title="6.乐观锁和悲观锁"></a>6.乐观锁和悲观锁</h5><h6 id="1-概念"><a href="#1-概念" class="headerlink" title="1.概念"></a>1.概念</h6><p>1.悲观锁：在每次操作之前会上一把锁，上了锁就不能进行操作，除非等上一个操作进行完并解锁才能进行下一步操作</p>
<p><img src="D:\图片\悲观锁.jpg" class="lazyload placeholder" data-srcset="D:\图片\悲观锁.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"></p>
<p>2.乐观锁：进行操作的数据会有一个版本号的标识，随机进行一个操作后标识会改变，如果下一个数据进行下一步操作会包标识进行查询，数据库的标识是哪一个就在哪一个执行</p>
<p><img src="D:\图片\乐观锁.jpg" class="lazyload placeholder" data-srcset="D:\图片\乐观锁.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"></p>
<h6 id="案例：乐观锁"><a href="#案例：乐观锁" class="headerlink" title="案例：乐观锁"></a>案例：乐观锁</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">第一个终端</span><br><span class="line">127.0.0.1:6379&gt; watch balance</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; incrby balance 10</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line">第二个终端</span><br><span class="line">127.0.0.1:6379&gt; watch balance</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi	</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; incrby balance 10</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">1) (integer) 10</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="6-模拟秒杀"><a href="#6-模拟秒杀" class="headerlink" title="6.模拟秒杀"></a>6.模拟秒杀</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">          &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.7.0&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;!-- 解决redis连接超时的问题--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.11.1&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;!-- 连接Redis--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;3.3.0&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">	@PostMapping(&quot;sec_kill&quot;)</span><br><span class="line">	public String doSecKill(String uid, String proid) &#123;</span><br><span class="line">		// 校验商品、用户的id</span><br><span class="line">		if (uid == null || proid == null) &#123;</span><br><span class="line">			return &quot;校验不合法&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">		// 连接redis</span><br><span class="line">		Jedis jedis = new Jedis(&quot;127.0.0.1&quot;, 6379);</span><br><span class="line"></span><br><span class="line">		// 创建商品数量的key</span><br><span class="line">		String kcKey = &quot;doSecKill&quot; + proid + &quot;:qt&quot;;</span><br><span class="line">		//创建秒杀清单用户的key</span><br><span class="line">		String userKey = &quot;doSecKill&quot; + proid + &quot;:user&quot;;</span><br><span class="line">		</span><br><span class="line">		//解决了超卖问题，设置并发</span><br><span class="line">		jedis.watch(kcKey);</span><br><span class="line"></span><br><span class="line">		// 判断redis中是否有商品，没有商品则强光</span><br><span class="line">		String kc = jedis.get(kcKey);</span><br><span class="line">		if(kc==null) &#123;</span><br><span class="line">			System.out.println(&quot;秒杀还没有开始！！&quot;);</span><br><span class="line">			jedis.close();</span><br><span class="line">			return &quot;秒杀还没有开始！！&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		//判断用户是否重复秒杀</span><br><span class="line">		if(jedis.sismember(userKey, uid)) &#123;</span><br><span class="line">			System.out.println(&quot;你已经抢过了该商品，不能重复秒杀了!!&quot;);</span><br><span class="line">			jedis.close();</span><br><span class="line">			return &quot;你已经抢过了该商品，不能重复秒杀了!!&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		//如果商品的数量小于1则秒杀结束</span><br><span class="line">		if(Integer.parseInt(kc)&lt;1) &#123;</span><br><span class="line">			System.out.println(&quot;秒杀结束&quot;);</span><br><span class="line">			jedis.close();</span><br><span class="line">			return &quot;秒杀结束&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		//秒杀的过程</span><br><span class="line">		//1.商品数量-1</span><br><span class="line">//		Long decr = jedis.decr(kc);</span><br><span class="line">//		System.out.println(decr);</span><br><span class="line"></span><br><span class="line">		//组队操作</span><br><span class="line">		Transaction multi = jedis.multi();</span><br><span class="line"></span><br><span class="line">		multi.decr(kcKey);</span><br><span class="line">		multi.sadd(userKey, uid);</span><br><span class="line">		List&lt;Object&gt; result = multi.exec();</span><br><span class="line">		if(result.size() ==0 || result==null) &#123;</span><br><span class="line">			System.out.println(&quot;秒杀失败&quot;);</span><br><span class="line">			jedis.close();</span><br><span class="line">			return &quot;秒杀失败&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">		//2.秒杀成功的用户放入到秒杀清单中</span><br><span class="line">//		jedis.sadd(userKey, uid);</span><br><span class="line">//		jedis.set(kcKey, (Integer.parseInt(jedis.get(kcKey))-1)+&quot;&quot;);</span><br><span class="line">		jedis.close();</span><br><span class="line">		</span><br><span class="line">		return &quot;秒杀成功&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="7-redis的持久化操作"><a href="#7-redis的持久化操作" class="headerlink" title="7.redis的持久化操作"></a>7.redis的持久化操作</h3><h5 id="1-持久化的概念"><a href="#1-持久化的概念" class="headerlink" title="1.持久化的概念"></a>1.持久化的概念</h5><p>所谓的持久化是将Redis内存的数据转入到磁盘上的过程</p>
<h5 id="2-持久化的方式"><a href="#2-持久化的方式" class="headerlink" title="2.持久化的方式"></a>2.持久化的方式</h5><p>RDB(redis DataBase)</p>
<p>AOF(append OfFile)</p>
<h5 id="3-RDB是什么"><a href="#3-RDB是什么" class="headerlink" title="3.RDB是什么"></a>3.RDB是什么</h5><p>在指定的时间间隔将内存中的数据集快照写入磁盘</p>
<h5 id="4-RDB进行备份"><a href="#4-RDB进行备份" class="headerlink" title="4.RDB进行备份"></a>4.RDB进行备份</h5><p>Redis,会单独创建( fork )一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何IO操的，这就确保了极高的性能如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。<em><strong>RDB的缺点是最后一次持久化后的数据可能丢失</strong></em>。</p>
<p>在这里涉及到一个技术：写时复制技术</p>
<p><img src="D:\图片\QQ截图20220828141258.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220828141258.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"></p>
<p>不将Redis内存对数据直接写入到dump.rdb到原因就是为了防止Redis宕机时数据丢失</p>
<h6 id="5-redis的配置-Redis数据隔时拷贝到dump-rdb"><a href="#5-redis的配置-Redis数据隔时拷贝到dump-rdb" class="headerlink" title="5.redis的配置 Redis数据隔时拷贝到dump.rdb"></a>5.redis的配置 Redis数据隔时拷贝到dump.rdb</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">配置fork默认拷贝到的文件</span><br><span class="line"># The filename where to dump the DB</span><br><span class="line">## 创建dump.rdb文件，默认到名字为dump.rdb</span><br><span class="line">dbfilename dump.rdb</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Note that you must specify a directory here, not a file name.</span><br><span class="line"># dump.rdb创建到位置</span><br><span class="line">dir ./</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 当Redis无法写入时，就关闭Redis到写操作</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#   In the example below the behaviour will be to save:</span><br><span class="line">#   after 900 sec (15 min) if at least 1 key changed</span><br><span class="line">#   after 300 sec (5 min) if at least 10 keys changed</span><br><span class="line">#   after 60 sec if at least 10000 keys changed</span><br><span class="line">#</span><br><span class="line">#   Note: you can disable saving completely by commenting out all &quot;save&quot; lines.</span><br><span class="line">#</span><br><span class="line">#   It is also possible to remove all the previously configured save</span><br><span class="line">#   points by adding a save directive with a single empty string argument</span><br><span class="line">#   like in the following example:</span><br><span class="line">#</span><br><span class="line">#   save &quot;&quot;</span><br><span class="line"># redis 隔时拷贝到文件dump.rdb,这是根据keys值到改变来进行Redis到写操作</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure>

<p>解释：<em><strong>RDB的缺点是最后一次持久化后的数据可能丢失</strong></em>。</p>
<p>当Redis在最后隔时时并Redis服务宕机时，Redis并不会进行拷贝到dump.rdb中，导致了dump.rdb数据到丢失</p>
<p>12.2.9.优势<br>     1.适合大规模的数据恢复<br>	2.对数据完整性和一致性要求不高更适合使用<br>	3.节省磁盘空间<br>	4.恢复速度快</p>
<h5 id="5-AOF的持久化"><a href="#5-AOF的持久化" class="headerlink" title="5.AOF的持久化"></a>5.AOF的持久化</h5><p>append only file</p>
<p>以日志的形式记录写的操作，把用户执行的每个“写”指令（包括添加、编辑、删除）备份到文件中，还原文件时将这些命令重新执行一次，达到数据本次存储的效果</p>
<p>缺点：如果数据量大，高并发时，还原时成本比较高<br>优点：保证完全的数据持久化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 开启AOF持久化</span><br><span class="line">appendonly no</span><br><span class="line"># The name of the append only file (default: &quot;appendonly.aof&quot;)</span><br><span class="line"># 当重新启动Redis时会读取该文件，以日志的形式记录每一个写操作，将Redis执行到执行记录下来(读取操作不会记录)，只会追加文件但是不</span><br><span class="line">#会改写文件</span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br></pre></td></tr></table></figure>

<p>如果RDB和AOF同时开启，Redis会听从AOF，就不会读取RDB文件了。那么之前存入到RDB文件到数据就拿不到了</p>
<p>appendponly.aof文件到修复</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-check-aof --fix appendOnly.aof</span><br></pre></td></tr></table></figure>

<h3 id="8-主从复制"><a href="#8-主从复制" class="headerlink" title="8.主从复制"></a>8.主从复制</h3><h5 id="1-为什么需要主从复制"><a href="#1-为什么需要主从复制" class="headerlink" title="1.为什么需要主从复制"></a>1.为什么需要主从复制</h5><p>1️⃣：读写分离，主机只需要进行写操作</p>
<p>2️⃣：容灾快速恢复：从机宕机之后快速切换另一个从机</p>
<p> <img src="D:\图片\QQ截图20220828204042.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220828204042.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"></p>
<p>1.1一主多仆</p>
<h5 id="2-搭建一主多从"><a href="#2-搭建一主多从" class="headerlink" title="2.搭建一主多从"></a>2.搭建一主多从</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## 在/下创建myRedis</span><br><span class="line">## vi redis6379.conf</span><br><span class="line">include /myredis/redis.conf</span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line">port 6379</span><br><span class="line">dbfilename dump6379.rdb</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 启动服务器</span><br><span class="line">redis-server redis6379.conf</span><br><span class="line">redis-server redis6380.conf</span><br><span class="line">redis-server redis6381.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 启动客户端</span><br><span class="line">redis-cli -p 6379</span><br><span class="line">redis-cli -p 6380</span><br><span class="line">redis-cli -p 6381	</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 设置从机(将6380设置为从机，以6379为主机)</span><br><span class="line">127.0.0.1:6380&gt; slaveof 127.0.0.1 6379</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6380&gt; set a b    ## 从机只有只读到操作，没有写操作</span><br><span class="line">(error) READONLY You can&#x27;t write against a read only replica.</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 查看客户端的信息</span><br><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"># Replication</span><br><span class="line">role:master</span><br><span class="line">connected_slaves:1</span><br><span class="line">slave0:ip=127.0.0.1,port=6380,state=online,offset=42,lag=1</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:8dd030eab8abe59f114663715784b4f8852b5dc6</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:42</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:42</span><br></pre></td></tr></table></figure>

<h5 id="3-薪火相传"><a href="#3-薪火相传" class="headerlink" title="3.薪火相传"></a>3.薪火相传</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从机中在挂载从机</span><br></pre></td></tr></table></figure>

<h5 id="4-反客为主"><a href="#4-反客为主" class="headerlink" title="4.反客为主"></a>4.反客为主</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">主机宕机从机充当主机</span><br><span class="line">slaveof no one</span><br><span class="line">## 必须手动启动</span><br></pre></td></tr></table></figure>

<h5 id="5-设置哨兵模式"><a href="#5-设置哨兵模式" class="headerlink" title="5.设置哨兵模式"></a>5.设置哨兵模式</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">反客为主的自动版</span><br><span class="line"># 创建配置文件 sentinel.conf ，最后一个1代表的是至少有一个哨兵可以变为主机</span><br><span class="line">sentinel monitor myredis 127.0.0.1 6381 1  </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 使用Redis自带到测试工具redis-sentinel</span><br><span class="line">redis-sentinel sentinel.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">当主机宕机时，redis-sentinel会自动选出从机当主机，根据以下到标准</span><br><span class="line">1.优先级：priority redis.conf</span><br><span class="line"># By default the priority is 100.</span><br><span class="line">  replica-priority 100</span><br><span class="line">2.偏移量</span><br><span class="line">3.其他</span><br></pre></td></tr></table></figure>

<h6 id="1-延迟复制"><a href="#1-延迟复制" class="headerlink" title="1.延迟复制"></a>1.延迟复制</h6><p>主机复制到从机的时间</p>
<h3 id="9-redis的集群"><a href="#9-redis的集群" class="headerlink" title="9.redis的集群"></a>9.redis的集群</h3><h3 id="10-redis缓存穿透"><a href="#10-redis缓存穿透" class="headerlink" title="10.redis缓存穿透"></a>10.redis缓存穿透</h3><p>1.什么是缓存穿透？<br>缓存穿透是指：客户端请求的数据在缓存中和数据库中都不存在，这时缓存就永远不会生效，这些请求都打到数据库从而导致数据库压力过大。</p>
<p>2.出现缓存穿透的解决方案，以下是常用的两种：</p>
<p>(1）做缓存空对象：<br>如果一个查询返回的数据为空（不管是数据是否不存在），我们仍然把这个空结果（null）进行缓存，设置空结果的过期时间会很短，最长不超过五分钟。<br>缓存空对象的优缺点：<br>优点：实现简单，维护方便<br>缺点：额外的内存消耗，以及可能造成短期的数据不一致。（如果在做了空缓存之后，我们向数据库中插入了新的数据，而插入的数据正好是之前做了空缓存的数据，此时就会出现短期数据不一致的问题)</p>
<p>(2）使用布隆过滤器：</p>
<p>布隆过滤器（Bloom Filter），它实际上是一个很长的二进制向量（位图）和一系列的随机映射函数（哈希函数），它可以用于检索一个元素是否存在一个集合中，他的优点是空间的查询效率和查询时间都远远超过一般算法，缺点是有一定的误识别率和删除比较困难。</p>
<p><img src="D:\图片\QQ截图20221031111032.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20221031111032.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"></p>
<p>使用布隆过滤器的优缺点：<br>优点：内存占用少，没有多余的key<br>缺点：实现的过程比较复杂，并且存在误判的可能</p>
<h3 id="15-redis击穿"><a href="#15-redis击穿" class="headerlink" title="15.redis击穿"></a>15.redis击穿</h3><p> 概念：缓存击穿也叫热点key问题，就是一个被高并发访问并且缓存业务重构复杂的key突然失效了，无数的请求会在瞬间给数据库带来巨大的冲击。</p>
<p>解决方案：（1）增加key的时间</p>
<p>​					（2）使用锁</p>
<h3 id="16、redis雪崩"><a href="#16、redis雪崩" class="headerlink" title="16、redis雪崩"></a>16、redis雪崩</h3><p>缓存雪崩是指：在同一时间段大量的缓存key失效或者Redis宕机，这时候大量的请求向数据库请求信息，此时可能就会把数据库压垮。</p>
<p>出现缓存雪崩的解决方案常用的有如下：<br>（1）给不同的key的TTL设置随机值<br>（2）利用Redis集群提高服务的可用性<br>（3) 给缓存业务添加限流降级的策略<br>（4）给业务添加多级缓存</p>
<h3 id="17-redis分布式锁"><a href="#17-redis分布式锁" class="headerlink" title="17.redis分布式锁"></a>17.redis分布式锁</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setnx username lizhien   ##自带锁</span><br><span class="line">expire username 19  </span><br><span class="line"># 缺陷：设置了username没有设置过期时间则不能设置锁的过期时间</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set username lizhien  nx ex 20</span><br></pre></td></tr></table></figure>

<p>未完成</p>
<h3 id="18、redis的事务"><a href="#18、redis的事务" class="headerlink" title="18、redis的事务"></a>18、redis的事务</h3><h3 id="redis哨兵-sentinel"><a href="#redis哨兵-sentinel" class="headerlink" title="redis哨兵(sentinel)"></a>redis哨兵(sentinel)</h3><h5 id="1、是什么"><a href="#1、是什么" class="headerlink" title="1、是什么"></a>1、是什么</h5><p>吹哨人巡查监控后台master主机是否故障，如果故障了根据<strong>投票数</strong>自动将某一个从库转换为新主库，继续对外服务、</p>
<h5 id="2-能干嘛？"><a href="#2-能干嘛？" class="headerlink" title="2.能干嘛？"></a>2.能干嘛？</h5><p><strong>主从监控</strong><br>监控主从redis库运行是否正常<br><strong>消息通知</strong><br>哨兵可以将故障转移的结果发送给客户端如果Master异常，则会进行主从切换，<br><strong>故障转移</strong><br>将其中一个Slave作为新Master<br><strong>配置中心</strong></p>
<p>客户端通过连接哨兵来获得当前Redis服务的主节点地址</p>
<h3 id="14-springboot集成Redis使用"><a href="#14-springboot集成Redis使用" class="headerlink" title="14.springboot集成Redis使用"></a>14.springboot集成Redis使用</h3><p>1.导入Redis依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>      </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>     </span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.jettison<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>      </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jettison<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>           </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span>       </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">配置</span><br><span class="line">spring.redis.host=127.0.0.1</span><br><span class="line">spring.redis.port=6379</span><br><span class="line">spring.redis.database=3</span><br><span class="line">spring.redis.timeout=1800000             </span><br><span class="line">spring.redis.lettuce.pool.max-active=20  ## 最大的客户端连接数</span><br><span class="line">spring.redis.lettuce.pool.max-wait=-1    ## 最大的阻塞等待时间，负数代表没有限制</span><br><span class="line">spring.redis.lettuce.pool.min-idle=0     ## 最小的空闲连接数</span><br><span class="line">spring.redis.lettuce.pool.max-idle=5     ##最大的空闲连接数</span><br></pre></td></tr></table></figure>

<p>2.实现pojo的实例化，并在主配置类中开启缓存@EnableCaching,util的工具类E:\Redis</p>
<p>3.个注解的解释</p>
<p>1️⃣@cacheNames 与 @value 都是定义缓存的名字</p>
<p>2️⃣定义缓存的键(默认就是方法参数)</p>
<p>3️⃣condition：必须满足该条件才缓存</p>
<p>4️⃣unless：与3️⃣相反</p>
<ol start="4">
<li></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(value = &quot;findStuList&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">findStuList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> findStudentMapper.queryUserByName();</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>







<h2 id="14-原生注解的注入"><a href="#14-原生注解的注入" class="headerlink" title="14.原生注解的注入"></a>14.原生注解的注入</h2><h3 id="1-原生的servlet、Listener、filter的注入"><a href="#1-原生的servlet、Listener、filter的注入" class="headerlink" title="1.原生的servlet、Listener、filter的注入"></a>1.原生的servlet、Listener、filter的注入</h3><p>一、扫描servlet的注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ServletComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActiveMqApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ActiveMqApplication.class, args);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>二、创建servlet、Listener、filter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/my&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Myservlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.getWriter().println(<span class="string">&quot;66666&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;项目初始化完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">      log.info(<span class="string">&quot;项目销毁完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(urlPatterns = &#123;&quot;/my&quot;&#125;)</span>				####过滤访问的访问路径</span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        log.info(<span class="string">&quot;filter初始化完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;filter销毁完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">           filterChain.doFilter(servletRequest,servletResponse); <span class="comment">//自动放行</span></span><br><span class="line">            log.info(<span class="string">&quot;filter正在工作&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-spring注入的方式"><a href="#2-spring注入的方式" class="headerlink" title="2.spring注入的方式"></a>2.spring注入的方式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//proxyBeanMethod=true:保证依赖的组件始终是单实例的</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRegisterOnConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">myServlet</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Myservlet</span> <span class="variable">myservlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Myservlet</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(myservlet,<span class="string">&quot;/my&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">myFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MyFilter</span> <span class="variable">myFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyFilter</span>();</span><br><span class="line">        <span class="type">FilterRegistrationBean</span> <span class="variable">filterRegistrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>(myFilter);</span><br><span class="line">        filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/my&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="15、druid数据源的使用"><a href="#15、druid数据源的使用" class="headerlink" title="15、druid数据源的使用"></a>15、druid数据源的使用</h2><h4 id="1-springboot整合第三方技术的方式"><a href="#1-springboot整合第三方技术的方式" class="headerlink" title="1.springboot整合第三方技术的方式"></a>1.springboot整合第三方技术的方式</h4><p>1.自定义</p>
<p>2.引入对应的场景</p>
<h5 id="2-自定义整合"><a href="#2-自定义整合" class="headerlink" title="2.自定义整合"></a>2.自定义整合</h5><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    username: root</span><br><span class="line">    password: root</span><br><span class="line">    url: jdbc:mysql://localhost:3308/student?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line"></span><br><span class="line">mybatis:</span><br><span class="line">  mapper-locations: mapper/*.xml</span><br><span class="line">  type-aliases-package: com.activemq.model</span><br></pre></td></tr></table></figure>

<p>创建MyDataSourceConfig的类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyDataSourceConfig</span> &#123;</span><br><span class="line">  <span class="meta">@ConfigurationProperties(&quot;spring.datasource&quot;)</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        <span class="comment">//开启监控,防火墙的功能</span></span><br><span class="line">        dataSource.setFilters(<span class="string">&quot;stat,wall&quot;</span>);     <span class="comment">//在这里可以访问localhost:8080/druid   就可以进入到内置监控当中</span></span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//查看监控的界面</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">statViewServlet</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">StatViewServlet</span> <span class="variable">statViewServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StatViewServlet</span>();</span><br><span class="line">        ServletRegistrationBean&lt;StatViewServlet&gt; registrationBean = <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>&lt;&gt;(statViewServlet,<span class="string">&quot;/druid/*&quot;</span>);</span><br><span class="line">  <span class="comment">//设置druid账号和密码</span></span><br><span class="line">        registrationBean.addInitParameter(<span class="string">&quot;loginUsername&quot;</span>,<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        registrationBean.addInitParameter(<span class="string">&quot;loginPassword&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//webstatfilter用于采集web-jdbc关联监控的数据</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">webstatFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">WebStatFilter</span> <span class="variable">webStatFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebStatFilter</span>();</span><br><span class="line">        FilterRegistrationBean&lt;Filter&gt; filterFilterRegistrationBean = <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>&lt;&gt;(webStatFilter);</span><br><span class="line">        <span class="comment">//拦截哪些路径</span></span><br><span class="line">        filterFilterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/*&quot;</span>));</span><br><span class="line">        <span class="comment">//这些资源不需要拦截</span></span><br><span class="line">        filterFilterRegistrationBean.addInitPrameter(<span class="string">&quot;exclusions&quot;</span>,<span class="string">&quot;*.js , /durid/* , *.gif&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> filterFilterRegistrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DataSource dataSource;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(dataSource.getClass());             </span><br><span class="line">        <span class="comment">//class com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-引入对应的场景的方式"><a href="#3-引入对应的场景的方式" class="headerlink" title="3.引入对应的场景的方式"></a>3.引入对应的场景的方式</h5><p>1.引入场景</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="D:\图片\QQ截图20220324192947.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220324192947.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220324192947"></p>
<h2 id="15-缓存"><a href="#15-缓存" class="headerlink" title="15.缓存"></a>15.缓存</h2><h5 id="1-依赖导入"><a href="#1-依赖导入" class="headerlink" title="1.依赖导入"></a>1.依赖导入</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.cache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cache-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2-理论"><a href="#2-理论" class="headerlink" title="2.理论"></a>2.理论</h5><p>​		Java Caching定义了5个核心接口，分别是CachingProvider(缓存提供者)、CacheManager(缓存管理器)、Cache(缓存)、Entry(缓存键值对)和Expiry(缓存时效)。</p>
<p>​		CachingProvider定义了创建、配置、获取、管理和控制多个CacheManager。一个应用可以在运行期访问多个CachingProvider。</p>
<p>  CacheManager定义了创建、配置、获取、管理和控制多个唯一命名的Cache，这些Cache存在于CacheManager的上下文中。一个CacheManager仅被一个CachingProvider所拥有。<br>  Cache是一个类似Map的数据结构并临时存储以Key为索引的值。一个Cache仅被一个CacheManager所拥有。<br>  Entry是一个存储在Cache中的key-value对。<br>  Expiry 每一个存储在Cache中的条目有一个定义的有效期。一旦超过这个时间，条目为过期的状态。一旦过期，条目将不可访问、更新和删除。缓存有效期可以通过ExpiryPolicy设置。</p>
<h5 id="3-几个重要概念-缓存注解："><a href="#3-几个重要概念-缓存注解：" class="headerlink" title="3.几个重要概念&amp;缓存注解："></a>3.几个重要概念&amp;缓存注解：</h5><table>
<thead>
<tr>
<th><strong>概念&#x2F;注解</strong></th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>Cache</td>
<td>缓存接口，定义缓存操作。实现有：RedisCache、EhCacheCache、ConcurrentMapCache等</td>
</tr>
<tr>
<td>CacheManager</td>
<td>缓存管理器，管理各种缓存(Cache)组件</td>
</tr>
<tr>
<td>@Cacheable</td>
<td>主要针对方法配置，能够根据方法的请求参数对其结果进行缓存</td>
</tr>
<tr>
<td>@CacheEvict</td>
<td>清空缓存</td>
</tr>
<tr>
<td>@CachePut</td>
<td>保证方法被调用，又希望结果被缓存。</td>
</tr>
<tr>
<td>@EnableCaching</td>
<td>开启基于注解的缓存</td>
</tr>
<tr>
<td>keyGenerator</td>
<td>缓存数据时key生成策略</td>
</tr>
<tr>
<td>serialize</td>
<td>缓存数据时value序列化策略</td>
</tr>
</tbody></table>
<h5 id="4-缓存的使用"><a href="#4-缓存的使用" class="headerlink" title="4.缓存的使用"></a>4.缓存的使用</h5><p>1.开启基于注解的缓存</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.bdm.cache.mappers&quot;)</span></span><br><span class="line"><span class="meta">@EnableCaching</span> <span class="comment">//开启基于注解的缓存</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringbootCacheApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SpringbootCacheApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.标注缓存相关注解：@Cacheable、CacheEvict、CachePut<br> ###@Cacheable：将方法运行的结果进行缓存，以后再获取相同的数据时，直接从缓存中获取，不再调用方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(cacheNames = &#123;&quot;emp&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> Employee <span class="title function_">getEmpById</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">	<span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> employeeMapper.getEmpById(id);</span><br><span class="line">	<span class="keyword">return</span> emp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1️⃣@Cacheable注解的属性：</p>
<table>
<thead>
<tr>
<th align="center"><strong>属性名</strong></th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">cacheNames&#x2F;value</td>
<td>指定缓存的名字，缓存使用CacheManager管理多个缓存组件Cache，这些Cache组件就是根据这个名字进行区分的。对缓存的真正CRUD操作在Cache中定义，每个缓存组件Cache都有自己唯一的名字，通过cacheNames或者value属性指定，相当于是将缓存的键值对进行分组，缓存的名字是一个数组，也就是说可以将一个缓存键值对分到多个组里面</td>
</tr>
<tr>
<td align="center">key</td>
<td>缓存数据时的key的值，默认是使用方法参数的值，可以使用SpEL表达式计算key的值</td>
</tr>
<tr>
<td align="center">keyGenerator</td>
<td>缓存的生成策略，和key二选一，都是生成键的，keyGenerator可自定义</td>
</tr>
<tr>
<td align="center">cacheManager</td>
<td>指定缓存管理器(如ConcurrentHashMap、Redis等)</td>
</tr>
<tr>
<td align="center">cacheResolver</td>
<td>和cacheManager功能一样，和cacheManager二选一</td>
</tr>
<tr>
<td align="center">condition</td>
<td>指定缓存的条件(满足什么条件时才缓存)，可用SpEL表达式(如#id&gt;0，表示当入参id大于0时才缓存)</td>
</tr>
<tr>
<td align="center">unless</td>
<td>否定缓存，即满足unless指定的条件时，方法的结果不进行缓存，使用unless时可以在调用的方法获取到结果之后再进行判断(如#result&#x3D;&#x3D;null，表示如果结果为null时不缓存)</td>
</tr>
<tr>
<td align="center">sync</td>
<td>是否使用异步模式进行缓存</td>
</tr>
</tbody></table>
<p><img src="D:\图片\QQ截图20220315160722.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220315160722.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220315160722"></p>
<p>复杂规则</p>
<p><img src="D:\图片\QQ截图20220315161712.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220315161712.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220315161712"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheConfig(cacheNames = &quot;user&quot;)</span><span class="comment">//抽取公共的缓存的名字</span></span><br></pre></td></tr></table></figure>

<h2 id="16-actuator监控"><a href="#16-actuator监控" class="headerlink" title="16.actuator监控"></a>16.actuator监控</h2><p>1.actuator的使用</p>
<p>依赖的导入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>访问路径</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/actuator">http://localhost:8080/actuator</a></p>
<img src="D:\图片\QQ截图20220426210158.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220426210158.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" style="zoom:93%;" />



<p><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/health">http://localhost:8080/actuator/health</a> 可以查看是否有微服务宕机现象</p>
<p>测试</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="D:\图片\QQ截图20220426210407.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220426210407.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" style="zoom:80%;" />

<p>Redis出现了宕机</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#将所有监控endpoints(端点)都暴露出来</span><br><span class="line">management.endpoints.web.exposure.include=*</span><br><span class="line">再次访问http://localhost:8080/actuator</span><br></pre></td></tr></table></figure>

<p>可视化界面更简单</p>
<p>官方文档 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator">https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator</a></p>
<p>​		您可以<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.endpoints.enabling">启用或禁用</a>每个单独的端点并<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.endpoints.exposing">通过 HTTP 或 JMX 公开它们（使它们可以远程访问）</a>。当端点被启用和公开时，它被认为是可用的。内置端点仅在可用时才会自动配置。大多数应用程序选择通过 HTTP 公开，其中端点的 ID 和前缀<code>/actuator</code>映射到 URL。例如，默认情况下，<code>health</code>端点映射到<code>/actuator/health</code>.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">management:</span><br><span class="line">#  开启默认的启动端点设置</span><br><span class="line">  endpoints:</span><br><span class="line">    enabled-by-default: true</span><br><span class="line">#    使用web方式暴露端点的方式(指定端口暴露)</span><br><span class="line">    web:</span><br><span class="line">      exposure:</span><br><span class="line">#        include: info , beans , health</span><br><span class="line">#        暴露所有的端点</span><br><span class="line">         include: &quot;*&quot;</span><br><span class="line"></span><br><span class="line">以jmx的方式来暴露端点</span><br><span class="line"># 暴露指定的端点</span><br><span class="line"># management.endpoints.jmx.exposure.include=health,info</span><br><span class="line"></span><br><span class="line"># 通过 HTTP 公开除env和beans端点之外的所有内容</span><br><span class="line"># management.endpoints.web.exposure.include=*</span><br><span class="line"># management.endpoints.web.exposure.exclude=env,beans</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>查看端点metrics(运行时指标监控)</p>
<p><a target="_blank" rel="noopener" href="http://localhost:9999/actuator/metrics">http://localhost:9999/actuator/metrics</a></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;names&quot;:[</span><br><span class="line">        &quot;application.ready.time&quot;,</span><br><span class="line">        &quot;application.started.time&quot;,</span><br><span class="line">        &quot;disk.free&quot;,</span><br><span class="line">        &quot;disk.total&quot;,</span><br><span class="line">        &quot;executor.active&quot;,</span><br><span class="line">        &quot;executor.completed&quot;,</span><br><span class="line">        &quot;executor.pool.core&quot;,</span><br><span class="line">        &quot;executor.pool.max&quot;,</span><br><span class="line">        &quot;executor.pool.size&quot;,</span><br><span class="line">        &quot;executor.queue.remaining&quot;,</span><br><span class="line">        .....</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里</p>
<p><a target="_blank" rel="noopener" href="http://localhost:9999/actuator/metrics/executor.queue.remaining">http://localhost:9999/actuator/metrics/executor.queue.remaining</a></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;:&quot;executor.queue.remaining&quot;,</span><br><span class="line">    &quot;description&quot;:&quot;The number of additional elements that this queue can ideally accept without blocking&quot;,</span><br><span class="line">    &quot;baseUnit&quot;:&quot;tasks&quot;,</span><br><span class="line">    &quot;measurements&quot;:[</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;statistic&quot;:&quot;VALUE&quot;,</span><br><span class="line">            &quot;value&quot;:2147483647</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;availableTags&quot;:[</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;tag&quot;:&quot;name&quot;,</span><br><span class="line">            &quot;values&quot;:[</span><br><span class="line">                &quot;applicationTaskExecutor&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>1️⃣、health端点</p>
<p>​		可以使用健康信息来检查正在运行的应用程序的状态。当生产系统出现故障时，监控软件经常使用它来提醒某人.</p>
<table>
<thead>
<tr>
<th align="left">name</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>never</code></td>
<td align="left">从不显示细节。</td>
</tr>
<tr>
<td align="left"><code>when-authorized</code></td>
<td align="left">详细信息仅向授权用户显示。可以使用 配置授权角色<code>management.endpoint.health.roles</code>。</td>
</tr>
<tr>
<td align="left"><code>always</code></td>
<td align="left">向所有用户显示详细信息。</td>
</tr>
</tbody></table>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.endpoint.health.show-details = always</span><br></pre></td></tr></table></figure>

<p><img src="D:\图片\QQ截图20220518180919.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220518180919.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Lq4y1J77x?p=33">https://www.bilibili.com/video/BV1Lq4y1J77x?p=33</a></p>
<p>1️⃣health端点的监控</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//自定义监控的信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyHealth</span> <span class="keyword">extends</span> <span class="title class_">AbstractHealthIndicator</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doHealthCheck</span><span class="params">(Health.Builder builder)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Map&lt;String,Object&gt; healthMsg = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">1</span>==<span class="number">1</span>)&#123;</span><br><span class="line">            builder.status(Status.UP);</span><br><span class="line">            healthMsg.put(<span class="string">&quot;count&quot;</span>, <span class="number">1</span>);</span><br><span class="line">            healthMsg.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;successful up&quot;</span>) ;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            builder.status(Status.DOWN);</span><br><span class="line">            healthMsg.put(<span class="string">&quot;count&quot;</span>, <span class="number">2</span>);</span><br><span class="line">            healthMsg.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;error up&quot;</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line">           builder.withDetail(<span class="string">&quot;code&quot;</span>,<span class="number">200</span>)</span><br><span class="line">                   .withDetails(healthMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\图片\QQ截图20220525215602.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220525215602.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"></p>
<p>2️⃣meteric端点的监控</p>
<p>监控&#x2F;hello访问的请求次数：图中这个请求访问了10次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">/**</span><br><span class="line"> * meterRegistry指标注册中心</span><br><span class="line"> */</span><br><span class="line">public class MeterRegistryConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private MeterRegistry meterRegistry;</span><br><span class="line"></span><br><span class="line">    public Counter counter()&#123;</span><br><span class="line">        return meterRegistry.counter(&quot;myController.saveCity.count&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@ResponseBody</span><br><span class="line">@Controller</span><br><span class="line">public class HelloController &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    MeterRegistryConfig meterRegistryConfig;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/hello&quot;)</span><br><span class="line">    public String hello()&#123;</span><br><span class="line">        HelloServiceImpl.helloTest();</span><br><span class="line">        meterRegistryConfig.counter().increment();</span><br><span class="line">        return &quot;指标监控&quot; ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\图片\QQ截图20220525220050.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220525220050.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"></p>
<p>3️⃣自定义端点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义端点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//定义了端口名字</span></span><br><span class="line"><span class="meta">@Endpoint(id = &quot;dockerendpoint&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DockerEndPoint</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ReadOperation</span></span><br><span class="line">    <span class="keyword">public</span> Map <span class="title function_">getDockerInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.singletonMap(<span class="string">&quot;info&quot;</span>,<span class="string">&quot;docker started&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@WriteOperation</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">restartDockerInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;docker stop&quot;</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="D:\图片\QQ截图20220525220437.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220525220437.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"></p>
<p>当然，也可以通过jconsole来信息</p>
<img src="D:\图片\QQ截图20220525220704.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220525220704.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" style="zoom:50%;" />

<p>4️⃣定义info端口信息</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">info:</span><br><span class="line">  appName: boot-admin</span><br><span class="line">  appVersion: 1.0</span><br><span class="line">#项目的名字</span><br><span class="line">  mavenProjectName: @project.artifactId@   </span><br><span class="line">#项目的版本</span><br><span class="line">  mavenProjectVersion: @project.version@</span><br></pre></td></tr></table></figure>



<h2 id="17-spring安全框架"><a href="#17-spring安全框架" class="headerlink" title="17.spring安全框架"></a>17.spring安全框架</h2><p>官网：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.0.9.RELEASE/guides/html5/helloworld-boot.html">https://docs.spring.io/spring-security/site/docs/5.0.9.RELEASE/guides/html5/helloworld-boot.html</a></p>
<p>依赖的导入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--用于个人权限的显示--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-springsecurity4<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>	</span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KungfuController</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PREFIX</span> <span class="operator">=</span> <span class="string">&quot;pages/&quot;</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 欢迎页</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;welcome&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 登陆页</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/userlogin&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">loginPage</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> PREFIX+<span class="string">&quot;login&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * level1页面映射</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/level1/&#123;path&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">level1</span><span class="params">(<span class="meta">@PathVariable(&quot;path&quot;)</span>String path)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> PREFIX+<span class="string">&quot;level1/&quot;</span>+path;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * level2页面映射</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/level2/&#123;path&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">level2</span><span class="params">(<span class="meta">@PathVariable(&quot;path&quot;)</span>String path)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> PREFIX+<span class="string">&quot;level2/&quot;</span>+path;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * level3页面映射</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/level3/&#123;path&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">level3</span><span class="params">(<span class="meta">@PathVariable(&quot;path&quot;)</span>String path)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> PREFIX+<span class="string">&quot;level3/&quot;</span>+path;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">@EnableWebSecurity</span><br><span class="line">public class MySecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">        //super.configure(http);</span><br><span class="line">        //定制请求的授权规则</span><br><span class="line">        http.authorizeRequests().antMatchers(&quot;/&quot;).permitAll()</span><br><span class="line">                .antMatchers(&quot;/level1/**&quot;).hasRole(&quot;VIP1&quot;)</span><br><span class="line">                .antMatchers(&quot;/level2/**&quot;).hasRole(&quot;VIP2&quot;)</span><br><span class="line">                .antMatchers(&quot;/level3/**&quot;).hasRole(&quot;VIP3&quot;);</span><br><span class="line"></span><br><span class="line">        //开启自动配置的登陆功能，效果，如果没有登陆，没有权限就会来到登陆页面</span><br><span class="line">        http.formLogin().usernameParameter(&quot;user&quot;).passwordParameter(&quot;pwd&quot;)</span><br><span class="line">                .loginPage(&quot;/userlogin&quot;);</span><br><span class="line">        //1、/login来到登陆页</span><br><span class="line">        //2、重定向到/login?error表示登陆失败</span><br><span class="line">        //3、更多详细规定</span><br><span class="line">        //4、默认post形式的 /login代表处理登陆</span><br><span class="line">        //5、一但定制loginPage；那么 loginPage的post请求就是登陆</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        //开启自动配置的注销功能。</span><br><span class="line">        http.logout().logoutSuccessUrl(&quot;/&quot;);//注销成功以后来到首页</span><br><span class="line">        //1、访问 /logout 表示用户注销，清空session</span><br><span class="line">        //2、注销成功会返回 /login?logout 页面；</span><br><span class="line"></span><br><span class="line">        //开启记住我功能</span><br><span class="line">        http.rememberMe().rememberMeParameter(&quot;remeber&quot;);</span><br><span class="line">        //登陆成功以后，将cookie发给浏览器保存，以后访问页面带上这个cookie，只要通过检查就可以免登录</span><br><span class="line">        //点击注销会删除cookie</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //定义认证规则</span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class="line">        //super.configure(auth);</span><br><span class="line">        auth.inMemoryAuthentication()</span><br><span class="line">                .withUser(&quot;zhangsan&quot;).password(&quot;123456&quot;).roles(&quot;VIP1&quot;,&quot;VIP2&quot;)</span><br><span class="line">                .and()</span><br><span class="line">                .withUser(&quot;lisi&quot;).password(&quot;123456&quot;).roles(&quot;VIP2&quot;,&quot;VIP3&quot;)</span><br><span class="line">                .and()</span><br><span class="line">                .withUser(&quot;wangwu&quot;).password(&quot;123456&quot;).roles(&quot;VIP1&quot;,&quot;VIP3&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span></span></span><br><span class="line"><span class="tag">	  <span class="attr">xmlns:sec</span>=<span class="string">&quot;http://www.thymeleaf.org/thymeleaf-extras-springsecurity4&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span>欢迎光临武林秘籍管理系统<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;!isAuthenticated()&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h2</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span>游客您好，如果想查看武林秘籍 <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/userlogin&#125;&quot;</span>&gt;</span>请登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;isAuthenticated()&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>，您好,您的角色有：</span><br><span class="line">		<span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;principal.authorities&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/logout&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;注销&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;hasRole(&#x27;VIP1&#x27;)&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>普通武功秘籍<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level1/1&#125;&quot;</span>&gt;</span>罗汉拳<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level1/2&#125;&quot;</span>&gt;</span>武当长拳<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level1/3&#125;&quot;</span>&gt;</span>全真剑法<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;hasRole(&#x27;VIP2&#x27;)&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>高级武功秘籍<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level2/1&#125;&quot;</span>&gt;</span>太极拳<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level2/2&#125;&quot;</span>&gt;</span>七伤拳<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level2/3&#125;&quot;</span>&gt;</span>梯云纵<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;hasRole(&#x27;VIP3&#x27;)&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>绝世武功秘籍<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level3/1&#125;&quot;</span>&gt;</span>葵花宝典<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level3/2&#125;&quot;</span>&gt;</span>龟派气功<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level3/3&#125;&quot;</span>&gt;</span>独孤九剑<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="18-dubbo"><a href="#18-dubbo" class="headerlink" title="18.dubbo"></a>18.dubbo</h2><p>1.概念：面向接口代理的高性能RPC调用提供高性能的基于代理的远程调用能力，服务以接口为粒度，为开发者屏蔽远程调用底层细节。</p>
<p>官方文档：dubbo.apache.org&#x2F;zh-cn&#x2F;docs&#x2F;user&#x2F;quick-start.html</p>
<h3 id="2-1dubbo的应用"><a href="#2-1dubbo的应用" class="headerlink" title="2.1dubbo的应用"></a>2.1dubbo的应用</h3><p>1️⃣：在Linux中启动dubbo </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name zookeeper  -p 2181:2181 -d zookeeper:latest</span><br></pre></td></tr></table></figure>

<p>2️⃣：引入依赖  provider-ticket、provider-user模块</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.101tec/zkclient --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- zookeeper客户端工具--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.101tec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo.application.name</span>=<span class="string">provider-ticket</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dubbo.registry.address</span>=<span class="string">zookeeper://192.168.5.130:2181</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dubbo.scan.base-packages</span>=<span class="string">com.guigu.ticket.service</span></span><br></pre></td></tr></table></figure>

<p>provider-ticket 中serverImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Service</span>  <span class="comment">//dubbo的注解,将服务发布出去</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TickerServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">TicketService</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTicket</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;《厉害了，我的国》&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>provider-user 中重新铐入provider-ticket的接口&lt;发布的服务&gt;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    TicketService tickerService ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ticket</span> <span class="operator">=</span> tickerService.getTicket();</span><br><span class="line">        System.out.println(<span class="string">&quot;拿到了&quot;</span>+ticket);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootTest</span><br><span class="line">class ProviderUserApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    UserService userService;</span><br><span class="line">    @Test</span><br><span class="line">    void contextLoads() &#123;</span><br><span class="line">        userService.hello();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-2dubbo配置"><a href="#2-2dubbo配置" class="headerlink" title="2.2dubbo配置"></a>2.2dubbo配置</h3><p>详情见官网：<a target="_blank" rel="noopener" href="https://dubbo.apache.org/zh/docsv2.7/user/configuration/xml/">https://dubbo.apache.org/zh/docsv2.7/user/configuration/xml/</a></p>
<h3 id="2-3dubbo监控"><a href="#2-3dubbo监控" class="headerlink" title="2.3dubbo监控"></a>2.3dubbo监控</h3><p>官网：<a target="_blank" rel="noopener" href="https://dubbo.apache.org/zh/docsv2.7/user/references/xml/dubbo-monitor/">https://dubbo.apache.org/zh/docsv2.7/user/references/xml/dubbo-monitor/</a></p>
<h1 id="六-springcloud"><a href="#六-springcloud" class="headerlink" title="六.springcloud"></a>六.springcloud</h1><h2 id="1-1搭建eureka服务器"><a href="#1-1搭建eureka服务器" class="headerlink" title="1.1搭建eureka服务器"></a>1.1搭建eureka服务器</h2><p>引入对应的版本</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--    nacos管理依赖--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>​	（1）导入pom依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	(2)配置application.yaml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 10086</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: eurekaserver</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://localhost:10086/eureka</span><br></pre></td></tr></table></figure>

<p>(3)开启eureka</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(EurekaApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>开启服务器，访问localhost:10086,看到eureka的服务界面</p>
<h2 id="1-2eureka的服务注册"><a href="#1-2eureka的服务注册" class="headerlink" title="1.2eureka的服务注册"></a>1.2eureka的服务注册</h2><p>（1）导入pom文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>(2)配置application.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">orderservice</span>    <span class="comment">#（1）将服务器注册到eureka中，指定服务器的名字</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:10086/eureka</span>   <span class="comment">#将服务器注册到eureka中</span></span><br></pre></td></tr></table></figure>

<p>#####模拟使用多实例进行部署：右击实例，点击Copy configuration   &#x3D;&#x3D;&#x3D;》vm options框中输入-Dserver.port &#x3D; 自己定义接口（接口不能使用被占用的）</p>
<h2 id="1-3微服务的远程调用"><a href="#1-3微服务的远程调用" class="headerlink" title="1.3微服务的远程调用"></a>1.3微服务的远程调用</h2><p>注册resttemplate</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Resttemplate <span class="title function_">resttemplate</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Resttemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user-service的代码</span><br><span class="line">     <span class="keyword">public</span> User <span class="title function_">queryById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.findById(id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">order-service的代码</span><br><span class="line">    <span class="meta">@AutoWired</span></span><br><span class="line">    <span class="keyword">private</span> Resttemplate restTemplate;</span><br><span class="line"><span class="keyword">public</span> Order <span class="title function_">queryOrderById</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.查询订单</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line">    <span class="comment">//利用Resttemplate来查询用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(<span class="string">&quot;http://localhost:8080/user/&quot;</span> + order.getUserId(), User.class);</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        <span class="comment">// 4.返回</span></span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-4eureka的服务发现"><a href="#1-4eureka的服务发现" class="headerlink" title="1.4eureka的服务发现"></a>1.4eureka的服务发现</h2><p>eureka的服务拉取就是基于服务名称获取服务列表，然后在对服务列表进行负载均衡</p>
<p>（1）注册resttemplate中添加注解@LoadBalance</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalance</span>		<span class="comment">//实现负载均衡</span></span><br><span class="line"><span class="keyword">public</span> Resttemplate <span class="title function_">resttemplate</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Resttemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）在服务代码修改访问的远程调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Order <span class="title function_">queryOrderById</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.查询订单</span></span><br><span class="line">    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(<span class="string">&quot;http://userservice/user/&quot;</span> + order.getUserId(), User.class);</span><br><span class="line">    order.setUser(user);</span><br><span class="line">    <span class="comment">// 4.返回</span></span><br><span class="line">    <span class="keyword">return</span> order;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="1-5eureka的随机访问实例"><a href="#1-5eureka的随机访问实例" class="headerlink" title="1.5eureka的随机访问实例"></a>1.5eureka的随机访问实例</h2><p>###全局配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> IRule <span class="title function_">rule</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>###局部配置（只限制指定的实例）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userservice:</span></span><br><span class="line">      <span class="attr">ribbon:</span></span><br><span class="line">        <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.netflix.loadbalancer.RandomRule</span></span><br></pre></td></tr></table></figure>



<h2 id="1-6Ribbon的饥饿加载"><a href="#1-6Ribbon的饥饿加载" class="headerlink" title="1.6Ribbon的饥饿加载"></a>1.6Ribbon的饥饿加载</h2><p>Ribbon默认是采用懒加载，即第一次访问时才会去创建loadbalanceclient,则第一次请求的时间会很长，而饿加载会在项目启动时创建，降低了第一次访问的时间。之需要添加以下的配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ribbon:</span><br><span class="line">  eager-load:</span><br><span class="line">    enabled: true #开启饥饿加载</span><br><span class="line">    clients:		#指定饥饿加载的实例</span><br><span class="line">      -userservice</span><br></pre></td></tr></table></figure>

<h2 id="2-nacos注册中心"><a href="#2-nacos注册中心" class="headerlink" title="2 nacos注册中心"></a>2 nacos注册中心</h2><h2 id="2-1nacos的快速入门"><a href="#2-1nacos的快速入门" class="headerlink" title="2.1nacos的快速入门"></a>2.1nacos的快速入门</h2><p>nacos的中文官网 <a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/use-nacos-with-springcloud.html">https://nacos.io/zh-cn/docs/use-nacos-with-springcloud.html</a></p>
<p>​		git clone <a target="_blank" rel="noopener" href="https://github.com/nacos-group/nacos-docker.git">https://github.com/nacos-group/nacos-docker.git</a>  克隆项目</p>
<p>​		文件下载到的路径：D:\springcould\nacos\bin</p>
<p>​		###开启nacos服务器<br>​		startup.cmd -m standalone</p>
<p>application.yaml文件的配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span>		<span class="comment">#nacos的实例名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#配置nacos的服务地址(可以不用进行配置)</span></span><br></pre></td></tr></table></figure>

<p>导入客户端依赖包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2nacos的服务分级存储模型"><a href="#2-2nacos的服务分级存储模型" class="headerlink" title="2.2nacos的服务分级存储模型"></a>2.2nacos的服务分级存储模型</h2><p>概念：将一个服务的多个实例部署到不同的集群当中</p>
<p>2.2.1   服务跨集群访问的问题：服务调用尽可能选择本地集群的服务，跨集群调用延迟高，当本地的集群不可访问时，在去跨集群的访问</p>
<p>2.2.2   服务集群的配置（设置集群的名字）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#配置nacos的服务地址</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">sh</span> <span class="comment">#设置集群名字</span></span><br></pre></td></tr></table></figure>

<p>在nacos     服务管理&#x3D;&#x3D;&#x3D;&#x3D;》服务列表    中能够查看</p>
<p>2.2.3  nacos的nacos-Rule的负载均衡（优先选择同集群访问，默认是轮询机制）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userservice:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.alibaba.cloud.nacos.ribbon.NacosRule</span></span><br></pre></td></tr></table></figure>

<p>####在本地集群调用服务时采用随机调用，当本地集群都挂了时候，就会去调用远程服务，访问远程的服务的同时，远地nacos控制台会出现警告信息。</p>
<ol start="2">
<li><p>2.4  nacos服务实例的权重设置（维护性能差的电脑）</p>
<p>操作 ： 服务管理&#x3D;&#x3D;&#x3D;&#x3D;》服务列表&#x3D;&#x3D;&#x3D;》操作里的编辑 &#x3D;&#x3D;&#x3D;》权重</p>
</li>
</ol>
<h2 id="2-4-nacos-namespace环境隔离"><a href="#2-4-nacos-namespace环境隔离" class="headerlink" title="2.4  nacos  namespace环境隔离"></a>2.4  nacos  namespace环境隔离</h2><p>2.4.1 概念：nacos的namespace环境隔离是基于开发，生产环境等进行划分。</p>
<p>2.4.2 生成namespace的ID：命名空间&#x3D;&#x3D;&#x3D;》创建命名空间&#x3D;&#x3D;&#x3D;》填写命名空间名和描述&#x3D;&#x3D;&#x3D;》自动生成了namespace的ID</p>
<p>2.4.3修改实例的环境</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#配置nacos的服务地址</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">sh</span> <span class="comment">#设置集群名字</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">354c3010-7aff-423d-b138-f170c56fa705</span> <span class="comment">#命名空间，orderserver的请求会接收不到，进行了隔离</span></span><br></pre></td></tr></table></figure>

<p>###不同服务的namespace是不能访问的</p>
<h2 id="2-5nacos与eureka的对比"><a href="#2-5nacos与eureka的对比" class="headerlink" title="2.5nacos与eureka的对比"></a>2.5nacos与eureka的对比</h2><p>2.5.1 nacos 与 eureka的区别：</p>
<p>​	临时实例：默认所有的实例都是为临时实例，当nacos注册中心采用心跳机制主动询问临时实例而临时实例挂了时，临时实例就会被剔除，但是非临时实例不会被剔除，只是会出现不健康的状态，等待非临时实例的恢复。</p>
<p>​	eureka只会讲服务消费者向eureka的注册中心pull定时拉取服务，但是这样发现服务消费者出现宕机的状况比较低下，在nacos中，不仅结合了pull定时拉取服务，还结合了nacos中主动变更消息，以便更快的发现服务消费者出现宕机的情况。</p>
<p><img src="D:\QQ截图20220308110231.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220308110231.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220308110231"></p>
<p>2.5.2 设置非临时实例</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#配置nacos的服务地址</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">sh</span> <span class="comment">#设置集群名字</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">354c3010-7aff-423d-b138-f170c56fa705</span> <span class="comment">#命名空间，orderserver的请求会接收不到，进行了隔离</span></span><br><span class="line">        <span class="attr">ephemeral:</span> <span class="literal">false</span>  <span class="comment">#是否是实例</span></span><br></pre></td></tr></table></figure>

<h2 id="2-6-nacos的配置管理"><a href="#2-6-nacos的配置管理" class="headerlink" title="2.6 nacos的配置管理"></a>2.6 nacos的配置管理</h2><p>2.6.1 作用：将所有动态的配置写入到配置内容中，并且能够实现热更新（所有的集群都会读取该配置文件且不需要重启服务器）</p>
<p>2.6.2新建开发配置文件</p>
<p>​	配置管理&#x3D;&#x3D;&#x3D;》配置列表&#x3D;&#x3D;&#x3D;》点击新建&#x3D;&#x3D;&#x3D;》Data ID(配置文件的名字：命名的规则是实例名-生产环境.yaml)</p>
<p>在配置内容中填写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pattern:</span></span><br><span class="line">  <span class="attr">dateformat:</span> <span class="string">yyyy/MM/dd</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></table></figure>



<h3 id="2-7-nacos的服务配置读取"><a href="#2-7-nacos的服务配置读取" class="headerlink" title="2.7 nacos的服务配置读取"></a>2.7 nacos的服务配置读取</h3><p><img src="D:\QQ截图20220308113116.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220308113116.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220308113116"></p>
<p>####bootstrap.yml的优先级比application.yml高</p>
<p>微服务获取配置文件的内容</p>
<p>2.7.1引入nacos的配置管理客户端依赖</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&lt;dependency&gt;</span></span><br><span class="line">      <span class="string">&lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span></span><br><span class="line">      <span class="string">&lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;</span></span><br><span class="line">    <span class="string">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.7.2 在resource目录下创建bootstrap.yaml文件，这是一个引导文件，优先级高于application.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#运用微服务获取nacos配置的值</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span>   <span class="comment">#配置Profiles的运行时环境</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span>   <span class="comment">#配置nacos的服务地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span>      <span class="comment">#配置nacos的后缀名</span></span><br></pre></td></tr></table></figure>

<p>2.7.3获取在nacos文件中配置文件里面的内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;pattern.dateformat&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String dataformate;</span><br></pre></td></tr></table></figure>



<h3 id="2-8nacos配置热更新"><a href="#2-8nacos配置热更新" class="headerlink" title="2.8nacos配置热更新"></a>2.8nacos配置热更新</h3><p>2.8.1nacos中配置文件变更后，微服务无需重启就可以感知，可以通过两种配置来实现：</p>
<p>第一种：</p>
<p>添加@RefreshScope</p>
<pre><code>@RefreshScpoe

@RestController

publi void UserController()&#123;
@Value(&quot;$&#123;pattern.dateformat&#125;&quot;)
private String dataformate;
	
&#125;
</code></pre>
<p>第二种：@configurationProperties</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@Component</span>		<span class="comment">//注册一个Bean组件</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;pattern&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PatternProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String dateformat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> <span class="keyword">private</span> PatternProperties patternProperties;</span><br><span class="line"><span class="meta">@GetMapping(&quot;prop&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> PatternProperties <span class="title function_">properties</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> patternProperties;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-7nacos多环境配置共享"><a href="#2-7nacos多环境配置共享" class="headerlink" title="2.7nacos多环境配置共享"></a>2.7nacos多环境配置共享</h2><p>2.7.1 创建nacos的多环境共享</p>
<p>​	配置管理&#x3D;&#x3D;&#x3D;》配置列表&#x3D;&#x3D;&#x3D;》点击新建</p>
<p>2.7.2 编写nacos的配置文件的内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pattern:</span><br><span class="line">  envSharedValue: 环境共享属性值</span><br></pre></td></tr></table></figure>

<p>####改变实例的环境：右击实例&#x3D;&#x3D;&#x3D;&#x3D;》&#x3D;&#x3D;&#x3D;》Edit configuration&#x3D;&#x3D;&#x3D;》Active Profiles&#x3D;&#x3D;&#x3D;&#x3D;》填写环境的类型Test</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@Component</span>		#注册一个Bean组件</span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;pattern&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PatternProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String dateformat;    ====&gt;<span class="literal">null</span></span><br><span class="line">    <span class="keyword">private</span> String envSharedValue;  ===&gt;环境共享属性值</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>####多环境共享能在不同的环境当中拿到</p>
<p>####如果在多个配置文件具有相同的配置，多种环境的配置优先级：服务名-profile.yaml ()&gt;服务名.yaml(多环境配置共享)&gt;本地配置（application.yml）</p>
<h2 id="2-8-nacos的服务搭建"><a href="#2-8-nacos的服务搭建" class="headerlink" title="2.8 nacos的服务搭建"></a>2.8 nacos的服务搭建</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、进入文件：/lib/systemd/system</span><br><span class="line">2、修改配置文件 vi docker.service</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">3、查看端口是否被监听  netstat -nlpt	</span><br><span class="line">4、查看修改配置 curl http://localhost:2375/version</span><br><span class="line">5、到浏览器中访问 121.36.72.245:2375/version</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230409111459400.png" class="lazyload placeholder" data-srcset="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230409111459400.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20230409111459400"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230409111648358.png" class="lazyload placeholder" data-srcset="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230409111648358.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20230409111648358"></p>
<h2 id="2-9-feign的远程调用"><a href="#2-9-feign的远程调用" class="headerlink" title="2.9 feign的远程调用"></a>2.9 feign的远程调用</h2><p>2.9.1 feign 的存在原因：在resttemplate中代码的可读性比较差，编程的体验不统一，参数复杂URL难以维护，并且feign集成了resttemplate，实现了负载均衡。</p>
<p>2.9.2 定义和使用feign</p>
<p>1️⃣导入feign依赖（添加到声明feign的模块当中）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2️⃣在order-sevice中启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;cn.itcast.order.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3️⃣在order-sevice中声明feign，创建一个feign的模块</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;userservice&quot;)</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * feignClient :  请求的服务器的名字</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">queryById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4️⃣调用feign的模块接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Order <span class="title function_">queryOrderById1</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userClient.queryById(order.getUserId());   <span class="comment">//调用了feign客户端的接口</span></span><br><span class="line">    order.setUser(user);</span><br><span class="line">    <span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-0-feign的自定义配置"><a href="#3-0-feign的自定义配置" class="headerlink" title="3.0 feign的自定义配置"></a>3.0 feign的自定义配置</h2><h4 id="1-日志配置（level）"><a href="#1-日志配置（level）" class="headerlink" title="1.日志配置（level）"></a>1.日志配置（level）</h4><p>​		NONE:不输出如何的日志</p>
<p>​		BASIC：只输出请求方法的URL和响应状态码以及接口执行时间</p>
<p>​		HEADERS：将basic信息和请求头信息进行输出</p>
<p>​		FULL：输出完整的请求信息</p>
<h4 id="2-响应结果的解析器（decoder）"><a href="#2-响应结果的解析器（decoder）" class="headerlink" title="2.响应结果的解析器（decoder）"></a>2.响应结果的解析器（decoder）</h4><p>HTTP远程调用的结果做解析，最常见的就是将json格式的数据转为Java对象</p>
<h4 id="3-请求参数的编码（Encoder）"><a href="#3-请求参数的编码（Encoder）" class="headerlink" title="3.请求参数的编码（Encoder）"></a>3.请求参数的编码（Encoder）</h4><p>默认将请求的数据转为一个请求体</p>
<h4 id="4-支持注解的格式（契约配置-contract）"><a href="#4-支持注解的格式（契约配置-contract）" class="headerlink" title="4.支持注解的格式（契约配置 contract）"></a>4.支持注解的格式（契约配置 contract）</h4><p>默认的支持的是springmvc的注解</p>
<h4 id="5-失败重试机制-Retryer"><a href="#5-失败重试机制-Retryer" class="headerlink" title="5.失败重试机制(Retryer)"></a>5.失败重试机制(Retryer)</h4><p>请求失败的重试机制，默认是没有的，不过会有Ribbon重试（例如：查询一条数据时受到了网络等其他原因的波动，它会请求其他的服务器，直到将数据查到为止）</p>
<h3 id="6-配置feign的日志"><a href="#6-配置feign的日志" class="headerlink" title="6.配置feign的日志"></a>6.配置feign的日志</h3><p>配置feign的日志有两种方式</p>
<p>​	第一种全局的方式(order-service)</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">FULL</span>   <span class="comment">###输出了所有的信息</span></span><br></pre></td></tr></table></figure>

<p>​	第二种局部</p>
<p><img src="D:\QQ截图20220309185621.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220309185621.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220309185621"></p>
<h2 id="3-1feign的性能优化"><a href="#3-1feign的性能优化" class="headerlink" title="3.1feign的性能优化"></a>3.1feign的性能优化</h2><p>在feign底层的客户端实现：</p>
<p>1️⃣URLconnection：feign的默认实现，不支持连接池</p>
<p>2️⃣Apache HTTPclient：支持连接池</p>
<p>3️⃣OKHTTP：支持连接池</p>
<p>1.引入feign性能优化的依赖(order-service)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-Httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.配置yaml文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">httpclient:</span></span><br><span class="line">   <span class="attr">enabled:</span> <span class="literal">true</span>  <span class="comment">#支持HTTPClient性能优化开关</span></span><br><span class="line">   <span class="attr">max-connections:</span> <span class="number">200</span>   <span class="comment">#最大的连接数</span></span><br><span class="line">   <span class="attr">max-connections-per-route:</span> <span class="number">50</span>  <span class="comment">#单个路径的最大的连接数</span></span><br></pre></td></tr></table></figure>

<p>3.日志是一个消费feign性能特别高，日志级别最好是none也可以是basic</p>
<h2 id="3-2-feign的最佳实践"><a href="#3-2-feign的最佳实践" class="headerlink" title="3.2 feign的最佳实践"></a>3.2 feign的最佳实践</h2><p>将feignclient抽取为独立的模块，并且把接口有关的pojo、默认的feign配置都放到这个模块中，提供给所有消费者使用。</p>
<p><img src="D:\QQ截图20220309215133.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220309215133.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220309215133"></p>
<p>实现：</p>
<p>1.创建一个feign-API的模块，将User、配置文件、client文件写入</p>
<p>2.导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.order-service中默认扫描的是主类的所在的包，但是现在spring容器中已经扫描不到@FeignClient(“userservice”)注解有以下两种方式可以解决</p>
<p>第一种：直接扫描指定的类（类名：UserClient）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;cn.itcast.order.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients(clients = &#123;UserClient.class&#125;)</span> <span class="comment">//也可以指定包扫描</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二种：扫描@EnableFeignClient</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;cn.itcast.order.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients(basepackages = &quot;cn.itcast.feign.clients&quot;)</span> <span class="comment">//也可以指定包扫描</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.在order-service中导入feign-client的包即可</p>
<h2 id="3-3网关的作用介绍"><a href="#3-3网关的作用介绍" class="headerlink" title="3.3网关的作用介绍"></a>3.3网关的作用介绍</h2><p>2.网关的技术实现  gateway</p>
<h3 id="3-3-1-搭建网关"><a href="#3-3-1-搭建网关" class="headerlink" title="3.3.1  搭建网关"></a>3.3.1  搭建网关</h3><p>官网：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1403887?from=15425">https://cloud.tencent.com/developer/article/1403887?from=15425</a></p>
<p>1.1 创建一个新的module，引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--    引入网管gateway依赖    --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.2 配置文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span>			<span class="comment">####服务的名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span>			<span class="comment">####注册nacos</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span>   <span class="comment">#路由的标识，唯一</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userservice</span>   <span class="comment">#路由的目标地址	lb是负载均衡  后面的是服务器的名字</span></span><br><span class="line">          <span class="attr">predicates:</span>			<span class="comment">###数组的形式 路径断言</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> 	<span class="comment">###路由的规则 /user/** 判断是否是/user开头，只要符合该规则就向微服务发起请求</span></span><br></pre></td></tr></table></figure>

<p>1.3 具体网关与nacos和微服务的流程图</p>
<p><img src="D:\QQ截图20220309224832.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220309224832.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220309224832"></p>
<h3 id="2-1-路由的断言工厂"><a href="#2-1-路由的断言工厂" class="headerlink" title="2.1 路由的断言工厂"></a>2.1 路由的断言工厂</h3><p><img src="D:\QQ截图20220309225550.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220309225550.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220309225550"></p>
<p>官网：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#glossary">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#glossary</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span>			<span class="comment">####服务的名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span>			<span class="comment">####注册nacos</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span>   <span class="comment">#路由的标识，唯一</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userservice</span>   <span class="comment">#路由的目标地址	lb是负载均衡  后面的是服务器的名字</span></span><br><span class="line">          <span class="attr">predicates:</span>			<span class="comment">###数组的形式 路径断言</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> 	<span class="comment">###路由的规则 /user/** 判断是否是/user开头，只要符合该规则就向微服务发起请求</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">After=2017-01-20T17:42:47.789-07:00[America/Denver]</span>		<span class="comment">###设置只能在这时间之后才能访问</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Before=2037-01-20T17:42:47.789-07:00[America/Denver]</span>		<span class="comment">###设置只能在这时间之前才能访问</span></span><br><span class="line">            <span class="comment">###当不符合路由规则时，出现404的状态码</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2路由的过滤器配置"><a href="#2-2路由的过滤器配置" class="headerlink" title="2.2路由的过滤器配置"></a>2.2路由的过滤器配置</h3><p>1.路由器的运转</p>
<p><img src="D:\QQ截图20220309230817.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220309230817.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220309230817"></p>
<p>2.作用：可以对进入到网关的请求进行过滤并且对微服务返回的响应做出相应。（31种的过滤器）</p>
<p>官网：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories</a></p>
<p>3.配置一种简单的添加请求头的配置  局部配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">add_request_header_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://userservice</span></span><br><span class="line">        <span class="attr">filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,</span> <span class="string">blue</span></span><br></pre></td></tr></table></figure>

<p>验证  </p>
<p><img src="D:\QQ截图20220309232041.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220309232041.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220309232041"></p>
<p>全局（可以注释局部的配置）default-Filters</p>
<p><img src="D:\QQ截图20220309232349.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220309232349.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220309232349"></p>
<h3 id="2-3全局过滤器-globalFilter"><a href="#2-3全局过滤器-globalFilter" class="headerlink" title="2.3全局过滤器(globalFilter)"></a>2.3全局过滤器(globalFilter)</h3><p>全局过滤器也是将发过来的请求进行处理并对微服务的响应结果进行处理</p>
<p>在feign项目中创建GlobalFilter接口实现GlobalFIlter</p>
<p>globalFilter实现了自定义的业务实现</p>
<p>@order(-1)注解中里面值越小，过滤器的优先级就越高</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 网关的自定义的过滤器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalFilterAuthor</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="comment">//获取请求的参数</span></span><br><span class="line">        MultiValueMap&lt;String, String&gt; params = exchange.getRequest().getQueryParams();</span><br><span class="line">        <span class="comment">//获取参数的authorization参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">authorization</span> <span class="operator">=</span> params.getFirst(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="comment">//判断authorization的值是否是admin，如果是admin就放行，允许访问微服务的接口</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span>.equals(authorization)) &#123;</span><br><span class="line">            <span class="comment">//放行</span></span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//拦截时配置状态码</span></span><br><span class="line">        exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">        <span class="comment">//拦截</span></span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4过滤器链执行的顺序"><a href="#2-4过滤器链执行的顺序" class="headerlink" title="2.4过滤器链执行的顺序"></a>2.4过滤器链执行的顺序</h3><p><img src="D:\QQ截图20220310104726.jpg" class="lazyload placeholder" data-srcset="D:\QQ截图20220310104726.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220310104726"></p>
<h3 id="2-5跨域问题"><a href="#2-5跨域问题" class="headerlink" title="2.5跨域问题"></a>2.5跨域问题</h3><p>产生跨域的问题：浏览器禁止请求的发起者与服务端发生跨域ajax请求</p>
<p>解决方案：cros</p>
<p>在routes同一级下</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#            解决跨域问题</span></span><br><span class="line">      <span class="attr">globalcors:</span> <span class="comment">#全局的跨域处理</span></span><br><span class="line">        <span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">cors-configurations:</span></span><br><span class="line">          <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span></span><br><span class="line">            <span class="attr">allowedOrigins:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;http://localhost&quot;</span></span><br><span class="line">            <span class="attr">allowedMethods:</span> <span class="comment"># 允许的跨域ajax的请求方式</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;GET&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;POST&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;DELETE&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;PUT&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;OPTIONS&quot;</span></span><br><span class="line">            <span class="attr">allowedHeaders:</span> <span class="string">&quot;*&quot;</span>   <span class="comment">#允许在请求中携带头信息</span></span><br><span class="line">            <span class="attr">allowCredentials:</span> <span class="literal">true</span>  <span class="comment">#是否允许携带cookie</span></span><br><span class="line">            <span class="attr">maxAge:</span> <span class="number">360000</span> <span class="comment">#这次跨域的有效期</span></span><br></pre></td></tr></table></figure>



<h2 id="4-docker"><a href="#4-docker" class="headerlink" title="4.docker"></a>4.docker</h2><h3 id="1-docker的概述"><a href="#1-docker的概述" class="headerlink" title="1.docker的概述"></a>1.docker的概述</h3><p> 1️⃣docker是如何解决依赖的兼容性问题？</p>
<ul>
<li>将应用的libs（函数库）、deps（依赖）、配置与应用进行打包</li>
<li>将每一个打包好的应用放到一个集装箱中，避免互相出现干扰</li>
</ul>
<p>2️⃣docker是如何解决开发、测试、生产环境、操作系统有差异的问题？</p>
<p>在docker镜像中包含了完整的系统环境，包含了系统函数库，可以将打包好的应用直接运行在Linux内核中</p>
<h3 id="2-docker与虚拟机的差别"><a href="#2-docker与虚拟机的差别" class="headerlink" title="2.docker与虚拟机的差别"></a>2.docker与虚拟机的差别</h3><ul>
<li>docker是系统上的一个进程；虚拟机是操作系统上在安装了一个操作系统</li>
<li>docker体积小、启动速度快、性能好；虚拟机太大，启动速度慢，性能一般。</li>
</ul>
<h3 id="3-在Linux中安装docker"><a href="#3-在Linux中安装docker" class="headerlink" title="3.在Linux中安装docker"></a>3.在Linux中安装docker</h3><h5 id="1-版本要求"><a href="#1-版本要求" class="headerlink" title="1.版本要求"></a>1.版本要求</h5><p>​     Docker CE 支持 64 位版本 CentOS 7，并且要求内核版本不低于 3.10， CentOS 7 满足最低内核的要求，所以我们在CentOS 7安装Docker。</p>
<h5 id="2-卸载之前的docker"><a href="#2-卸载之前的docker" class="headerlink" title="2..卸载之前的docker"></a>2..卸载之前的docker</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine-selinux \</span><br><span class="line">                  docker-engine \</span><br><span class="line">                  docker-ce</span><br><span class="line"></span><br><span class="line">docker run -d -p 8082:8080 -p 50000:50000 -v /usr/docker/jenkins_data:/var/jenkins_home -v /usr/local/jdk1.8.0_411:/usr/local/jdk1.8.0_411 -v /home/apache-maven-3.8.3:/home/apache-maven-3.8.3 -v /opt/software/node:/opt/software/node -v /etc/localtime:/etc/localtime -v /usr/bin/docker:/usr/bin/docker -v /var/run/docker.sock:/var/run/docker.sock --user root --restart=always --name jenkins jenkins/jenkins:2.434</span><br><span class="line"></span><br><span class="line">http://172.16.0.47/broadcast-micro-service/xinghua-broadcast.git</span><br><span class="line"></span><br><span class="line">wget --no-check-certificate -c --header &quot;Cookie: oraclelicense=accept-securebackup-cookie&quot; \</span><br><span class="line">http://download.oracle.com/otn-pub/java/jdk/8u151-b12/jdk-8u151-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>

<h5 id="3-安装docker"><a href="#3-安装docker" class="headerlink" title="3.安装docker"></a>3.安装docker</h5><p>首先需要虚拟机联网，安装yum工具</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils \</span><br><span class="line">           device-mapper-persistent-data \</span><br><span class="line">           lvm2 --skip-broken</span><br></pre></td></tr></table></figure>

<p>然后更新本地镜像源：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">#</span> 设置docker镜像源</span><br><span class="line">yum-config-manager <span class="keyword">\</span></span><br><span class="line"><span class="keyword"></span>    --add-repo <span class="keyword">\</span></span><br><span class="line"><span class="keyword"></span>    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">    </span><br><span class="line">sed -i &#x27;s/download.docker.com/mirrors.aliyun.com<span class="keyword">\/</span>docker-ce/g&#x27; /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure>

<p>然后输入命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y docker-ce-20.10.7 docker-ce-cli-20.10.7 containerd.io-1.4.6</span><br></pre></td></tr></table></figure>

<h5 id="4-启动docker"><a href="#4-启动docker" class="headerlink" title="4.启动docker"></a>4.启动docker</h5><p>######启动docker之前一定先要关闭防火墙</p>
<p>或者输入命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁止开机启动防火墙</span></span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure>

<p>通过命令启动docker：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker  # 启动docker服务</span><br><span class="line"></span><br><span class="line">systemctl stop docker  # 停止docker服务</span><br><span class="line"></span><br><span class="line">systemctl restart docker  # 重启docker服务</span><br><span class="line"></span><br><span class="line">docker run -d -e MODE=standalone -e JVM_XMS=256m -e JVM_XMX=256m -e JVM_XMN=256m -p 8848:8848 -p 9848:9848 -p 9849:9849 --name nacos-server --restart=always nacos/nacos-server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -it \</span><br><span class="line">--name redis_6379 \</span><br><span class="line">--privileged \</span><br><span class="line">-p 6379:6379 \</span><br><span class="line">--ip 172.18.212.180 \</span><br><span class="line">-v /usr/local/software/redis/6379/conf/redis.conf:/usr/local/etc/redis/redis.conf \</span><br><span class="line">-v /usr/local/software/redis/6379/data/:/data \</span><br><span class="line">-v /usr/local/software/redis/6379/log/redis.log:/var/log/redis.log \</span><br><span class="line">-d redis \</span><br><span class="line">/usr/local/etc/redis/redis.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后普输入命令可查看docker的版本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -v</span><br></pre></td></tr></table></figure>

<h5 id="5-配置镜像加速"><a href="#5-配置镜像加速" class="headerlink" title="5.配置镜像加速"></a>5.配置镜像加速</h5><p>docker官方镜像仓库网速较差，我们需要设置国内镜像服务：</p>
<p>参考阿里云的镜像加速文档：<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://z099ukeh.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>



<h3 id="3-Centos安装DockerCompose"><a href="#3-Centos安装DockerCompose" class="headerlink" title="3.Centos安装DockerCompose"></a>3.Centos安装DockerCompose</h3><h5 id="1-下载"><a href="#1-下载" class="headerlink" title="1.下载"></a>1.下载</h5><p>在Linux中通过命令下载</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装</span></span><br><span class="line">curl -L https://github.com/docker/compose/releases/download/1.23.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<h5 id="2-修改文件的权限"><a href="#2-修改文件的权限" class="headerlink" title="2.修改文件的权限"></a>2.修改文件的权限</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改权限</span></span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<h5 id="3-base自动补全命令"><a href="#3-base自动补全命令" class="headerlink" title="3.base自动补全命令"></a>3.base自动补全命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">补全命令</span></span><br><span class="line">curl -L https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose</span><br></pre></td></tr></table></figure>

<p>如果这里出现错误，需要修改自己的hosts文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;199.232.68.133 raw.githubusercontent.com&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<h3 id="3-docker镜像仓库"><a href="#3-docker镜像仓库" class="headerlink" title="3.docker镜像仓库"></a>3.docker镜像仓库</h3><p>搭建镜像仓库可以基于Docker官方提供的DockerRegistry来实现。</p>
<p>官网地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/_/registry">https://hub.docker.com/_/registry</a></p>
<h5 id="1-简化版镜像仓库"><a href="#1-简化版镜像仓库" class="headerlink" title="1.简化版镜像仓库"></a>1.简化版镜像仓库</h5><p>Docker官方的Docker Registry是一个基础版本的Docker镜像仓库，具备仓库管理的完整功能，但是没有图形化界面。</p>
<p>搭建方式比较简单，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    --restart=always \</span><br><span class="line">    --name registry	\</span><br><span class="line">    -p 5000:5000 \</span><br><span class="line">    -v registry-data:/var/lib/registry \</span><br><span class="line">    registry</span><br></pre></td></tr></table></figure>

<p>命令中挂载了一个数据卷registry-data到容器内的&#x2F;var&#x2F;lib&#x2F;registry 目录，这是私有镜像库存放数据的目录。</p>
<p>访问<a target="_blank" rel="noopener" href="http://yourip:5000/v2/_catalog">http://YourIp:5000/v2/_catalog</a> 可以查看当前私有镜像服务中包含的镜像</p>
<h5 id="2-带有图形化界面版本"><a href="#2-带有图形化界面版本" class="headerlink" title="2.带有图形化界面版本"></a>2.带有图形化界面版本</h5><p>使用DockerCompose部署带有图象界面的DockerRegistry，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3.0&#x27;</span><br><span class="line">services:</span><br><span class="line">  registry:</span><br><span class="line">    image: registry</span><br><span class="line">    volumes:</span><br><span class="line">      - ./registry-data:/var/lib/registry</span><br><span class="line">  ui:</span><br><span class="line">    image: joxit/docker-registry-ui:static</span><br><span class="line">    ports:</span><br><span class="line">      - 8080:80</span><br><span class="line">    environment:</span><br><span class="line">      - REGISTRY_TITLE=传智教育私有仓库</span><br><span class="line">      - REGISTRY_URL=http://registry:5000</span><br><span class="line">    depends_on:</span><br><span class="line">      - registry</span><br></pre></td></tr></table></figure>

<h5 id="3-配置docker信任地址"><a href="#3-配置docker信任地址" class="headerlink" title="3.配置docker信任地址"></a>3.配置docker信任地址</h5><p>我们的私服采用的是http协议，默认不被Docker信任，所以需要做一个配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打开要修改的文件</span></span><br><span class="line">vi /etc/docker/daemon.json</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加内容：</span></span><br><span class="line">&quot;insecure-registries&quot;:[&quot;http://192.168.150.101:8080&quot;]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重加载</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启docker</span></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="4-docker的命令使用"><a href="#4-docker的命令使用" class="headerlink" title="4.docker的命令使用"></a>4.docker的命令使用</h3><p><img src="D:\图片\QQ截图20220315182941.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220315182941.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220315182941"></p>
<h3 id="5-拉取镜像"><a href="#5-拉取镜像" class="headerlink" title="5.拉取镜像"></a>5.拉取镜像</h3><p>官网：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images   ###查看镜像</span><br></pre></td></tr></table></figure>

<h3 id="5-将镜像保存到磁盘为压缩包"><a href="#5-将镜像保存到磁盘为压缩包" class="headerlink" title="5.将镜像保存到磁盘为压缩包"></a>5.将镜像保存到磁盘为压缩包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker save --help   ###可以查看save帮助文档</span><br><span class="line">docker save -o docker.tar nginx:latest</span><br></pre></td></tr></table></figure>

<h3 id="6-将硬盘上的压缩包变成镜像"><a href="#6-将硬盘上的压缩包变成镜像" class="headerlink" title="6.将硬盘上的压缩包变成镜像"></a>6.将硬盘上的压缩包变成镜像</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load --help			 ###load的帮助文档</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load -i docker.tar    ###docker.tar 是压缩包的名字</span><br></pre></td></tr></table></figure>

<h3 id="7-删除镜像"><a href="#7-删除镜像" class="headerlink" title="7.删除镜像"></a>7.删除镜像</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi nginx:latest    ####latest:代表的是nginx代表的是最新的版本</span><br></pre></td></tr></table></figure>

<h3 id="8-容器的操作"><a href="#8-容器的操作" class="headerlink" title="8.容器的操作"></a>8.容器的操作</h3><p><img src="D:\图片\QQ截图20220315204419.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220315204419.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220315204419"></p>
<p>1️⃣创建容器</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mn -p 80:80 -d nginx</span><br></pre></td></tr></table></figure>

<p>解析：docker run   &#x3D;&#x3D;&#x3D;&#x3D;》运行容器、name&#x3D;&#x3D;&#x3D;&#x3D;&gt;给容器起一个名字、-p:将宿主机端口与容器端口进行映射，冒号左边是宿主机的端口，冒号右边是容器运行的端口。</p>
<p>-d：后台运行容器</p>
<p>​			####在这里会产生一个创建容器的ID</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps    ###查看容器的状态</span><br></pre></td></tr></table></figure>

<p>查看日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs mn     ####mn是容器的名字</span><br></pre></td></tr></table></figure>

<p>时时监控日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f mn    ####mn是容器的名字</span><br></pre></td></tr></table></figure>

<p>查看虚拟机的IP地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure>

<p>查看部署的容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip:80    </span><br></pre></td></tr></table></figure>

<p>停止容器的后台运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop $(docker ps -a -q)</span><br><span class="line">docker stop mn</span><br></pre></td></tr></table></figure>

<p>删除静止的容器</p>
<p><img src="D:\图片\QQ截图20220419111612.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220419111612.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220419111612"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rm $(docker ps -a -q)</span><br><span class="line">docker rm -f mn     ####移除容器</span><br></pre></td></tr></table></figure>

<p>在Nginx容器中修改HTML文件</p>
<p>命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mn bash</span><br><span class="line">###### docker exec 进入容器</span><br><span class="line">###### -it 给当前进入的容器创建一个标准的输入、输出终端，允许我们与终端进行交互</span><br><span class="line">###### mn 容器的名字</span><br><span class="line">###### bash Linux命令</span><br></pre></td></tr></table></figure>

<p>根据上命令此时已经进入到了容器中</p>
<p>如何进入HTML文件呢？</p>
<p>首先在dockerHub中官方提供了静态的路径：&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/nginx/html   =====&gt;50x.html   and    index.html</span><br></pre></td></tr></table></figure>

<p>退出容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure>

<p>redis-cli</p>
<h3 id="9、数据卷"><a href="#9、数据卷" class="headerlink" title="9、数据卷"></a>9、数据卷</h3><p>容器与数据的耦合问题</p>
<p>1️⃣不便于修改</p>
<p>当我们要Nginx修改的HTML内容时，需要进入容器内部修改，很不方便。</p>
<p>2️⃣数据不可复用</p>
<p>在容器内的修改对外是不可见的。所有修改对新创建的容器是不可复用的。</p>
<p>3️⃣、升级维护困难</p>
<p>数据在容器内，如果要升级容器必然删除了旧容器，所有数据多要跟着删除了</p>
<p><img src="D:\图片\QQ截图20220316204501.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220316204501.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220316204501"></p>
<h5 id="1-数据卷的基本使用"><a href="#1-数据卷的基本使用" class="headerlink" title="1.数据卷的基本使用"></a>1.数据卷的基本使用</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker volume --help</span><br><span class="line">=====&gt;</span><br><span class="line">  create      Create a volume			####创建数据卷</span><br><span class="line">  inspect     Display detailed information on one or more volumes  ####找到数据卷在宿主机文件系统的位置</span><br><span class="line">  ls          List volumes		####列出所有的数据卷</span><br><span class="line">  prune       Remove all unused local volumes   ####删除不使用的数据卷</span><br><span class="line">  rm          Remove one or more volumes   ####删除一个或多个数据卷</span><br></pre></td></tr></table></figure>

<h5 id="2-数据卷的使用"><a href="#2-数据卷的使用" class="headerlink" title="2.数据卷的使用"></a>2.数据卷的使用</h5><p>将数据与容器分离，解耦合。方便操作容器内的数据，保证了数据的安全</p>
<h5 id="3-数据卷挂载到容器"><a href="#3-数据卷挂载到容器" class="headerlink" title="3.数据卷挂载到容器"></a>3.数据卷挂载到容器</h5><p><img src="D:\图片\QQ截图20220316210029.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220316210029.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220316210029"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">###这是基于数据卷挂载到容器内目录(挂载的第一种方式)默认的容器目录是===》var/lib/docker/volume/</span><br><span class="line">docker run --name nginx -v html:/usr/share/nginx/html -p 80:80 -d nginx  ####将数据卷挂载到容器的具体的一个位置</span><br></pre></td></tr></table></figure>

<p>数据卷将操作容器进入到修改的位置</p>
<p>修改的位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume inspect html   ####html为数据卷的名字</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">###宿主机文件系统直接挂载到容器内(与数据卷没有了关系)</span><br><span class="line">需要挂载的有两个地方：数据目录绑定和配置文件的绑定</span><br><span class="line">docker run --name mysql -e  MYSQL_ROOT_PASSWORD=root -p 3306:3306 -v /tmp/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /tmp/mysql/config/hmy.cnf:/etc/mysql/conf.d/hmy.cnf \</span><br><span class="line">-d mysql:8.0.12</span><br><span class="line"></span><br><span class="line">//改变数据库加密规则的修改</span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;root1&#x27; PASSWORD EXPIRE NEVER;</span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;root1&#x27;;</span><br><span class="line">alter user &#x27;root&#x27;@&#x27;localhost&#x27; identified by &#x27;root&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="D:\图片\QQ截图20220321100534.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220321100534.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220321100534"></p>
<p>​	</p>
<h3 id="10-自定义docker"><a href="#10-自定义docker" class="headerlink" title="10.自定义docker"></a>10.自定义docker</h3><h4 id="1-docker的结构"><a href="#1-docker的结构" class="headerlink" title="1.docker的结构"></a>1.docker的结构</h4><p>1.docker的组成部分：应用程序和依赖、环境、函数库、配置等</p>
<p>2.docker的结构：BaseImage：包含了依赖、环境、函数库、配置</p>
<p>​								入口：镜像启动命令</p>
<h4 id="2-构建docker镜像"><a href="#2-构建docker镜像" class="headerlink" title="2.构建docker镜像"></a>2.构建docker镜像</h4><p>&lt;1&gt;在虚拟机的&#x2F;tmp&#x2F;docker-demo传入文件E:\docker\资料docker-demo.jar 、Dockerfile、jdk8.tar.gz文件</p>
<p>修改Dockerfile文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 指定基础镜像</span><br><span class="line">FROM openjdk:8-jre</span><br><span class="line">将项目拷贝到/tmp/app.jar中</span><br><span class="line">COPY ./docker-demo.jar /tmp/app.jar</span><br><span class="line"># 暴露端口</span><br><span class="line">EXPOSE 8090</span><br><span class="line"># 入口，java项目的启动命令</span><br><span class="line">ENTRYPOINT java -jar /tmp/app.jar</span><br></pre></td></tr></table></figure>



<p>&lt;2&gt;利用docker镜像来运行Java项目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.创建docker的镜像</span><br><span class="line">docker build -t javaweb:1.0 .	</span><br><span class="line">2.查看所有的镜像</span><br><span class="line">docker images</span><br><span class="line"> ###javaweb      1.0       0f547e705471   2 minutes ago   722MB</span><br><span class="line"></span><br><span class="line">3.运行docker镜像</span><br><span class="line"> docker run --name javaweb -p 80:80 -d javaweb:1.0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-安装DockerCompose"><a href="#3-安装DockerCompose" class="headerlink" title="3.安装DockerCompose"></a>3.安装DockerCompose</h4><p>1️⃣文件的位置E:\docker\资料\docker-compose，将文件上传到虚拟主机的&#x2F;usr&#x2F;local&#x2F;bin中</p>
<p>2️⃣修改文件的权限，该文件没有执行权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod +x dockercompose的文件路径</span><br><span class="line">chmod +x /usr/local/bin/dockercompose</span><br><span class="line">或者进入到当前的文件下，执行该语句：chmod +x .</span><br></pre></td></tr></table></figure>

<p>3️⃣base的自动补全</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose</span><br></pre></td></tr></table></figure>

<p>如果出现错误，则需要修改hosts文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;199.232.5.130&quot; raw.githubusercontent.com&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<p>​	</p>
<h2 id="5-MQ"><a href="#5-MQ" class="headerlink" title="5.MQ"></a>5.MQ</h2><h4 id="1-同步通讯"><a href="#1-同步通讯" class="headerlink" title="1.同步通讯"></a>1.同步通讯</h4><p>特点：进行数据传输时，发送和接收双方要保持完全的同步，因此，要求接收和发送设备必须使用同一时钟。</p>
<p>优点：可以实现高速度、大容量的数据传送。</p>
<p>缺点：</p>
<p><img src="D:\图片\QQ截图20220321151401.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220321151401.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220321151401"></p>
<p>主要原因：(1)在同步通讯的过程只能1对1发起服务，所以耦合度比较强，发费的时间比较长。</p>
<p>​				   (2)在支付服务调用创库服务时，如果仓库服务挂了时，支付功能会一直在堵塞状态中，后面的服务一直不会被调用</p>
<p>​				（3）性能下降</p>
<p>​				（4）资源浪费</p>
<h4 id="2-异步通讯"><a href="#2-异步通讯" class="headerlink" title="2.异步通讯"></a>2.异步通讯</h4><p><img src="D:\图片\QQ截图20220321152848.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220321152848.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220321152848"></p>
<p>​		(1)耦合度降低，添加服务时无需在支付功能中添加</p>
<p>​		(2)性能大大提高，吞吐量提高</p>
<p><img src="D:\图片\QQ截图20220321153143.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220321153143.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220321153143"></p>
<p>​		(3)服务没有强依赖</p>
<p><img src="D:\图片\QQ截图20220321153326.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220321153326.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220321153326"></p>
<p>​	(4)流量削峰</p>
<h4 id="3-MQ常见的框架"><a href="#3-MQ常见的框架" class="headerlink" title="3.MQ常见的框架"></a>3.MQ常见的框架</h4><p>中文的名字是消息队列，字面的意思就是存放信息的队列。也就是事件驱动架构的broker。</p>
<p>各消息组件的差别：</p>
<p><img src="D:\图片\QQ截图20220321154807.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220321154807.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220321154807"></p>
<h4 id="4-RabbitMQ的几个概念"><a href="#4-RabbitMQ的几个概念" class="headerlink" title="4.RabbitMQ的几个概念"></a>4.RabbitMQ的几个概念</h4><p><img src="D:\图片\QQ截图20220326184010.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220326184010.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220326184010"></p>
<p><img src="D:\图片\QQ截图20220326184058.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220326184058.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220326184058"></p>
<h5 id="5-消息模型的介绍"><a href="#5-消息模型的介绍" class="headerlink" title="5.消息模型的介绍"></a>5.消息模型的介绍</h5><p>官网：<a target="_blank" rel="noopener" href="https://www.rabbitmq.com/getstarted.html">https://www.rabbitmq.com/getstarted.html</a></p>
<p>①helloWord</p>
<p><img src="D:\图片\QQ截图20220326184816.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220326184816.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220326184816"></p>
<p><img src="D:\图片\QQ截图20220326190224.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220326190224.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220326190224"></p>
<h4 id="RabbitMQ部署指南"><a href="#RabbitMQ部署指南" class="headerlink" title="RabbitMQ部署指南"></a>RabbitMQ部署指南</h4><h5 id="1-单机部署"><a href="#1-单机部署" class="headerlink" title="1.单机部署"></a>1.单机部署</h5><p>我们在Centos7虚拟机中使用Docker来安装。</p>
<h5 id="1-1-下载镜像"><a href="#1-1-下载镜像" class="headerlink" title="1.1.下载镜像"></a>1.1.下载镜像</h5><p>方式一：在线拉取</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull rabbitmq:3-management</span><br></pre></td></tr></table></figure>

<p>方式二：从本地加载</p>
<p>在课前资料已经提供了镜像包：</p>
<p><img src="https://pan.baidu.com/s/assets/image-20210423191210349.png" class="lazyload placeholder" data-srcset="https://pan.baidu.com/s/assets/image-20210423191210349.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20210423191210349"></p>
<p>上传到虚拟机中后，使用命令加载镜像即可：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load -i mq.tar</span><br></pre></td></tr></table></figure>

<h5 id="1-2-安装MQ"><a href="#1-2-安装MQ" class="headerlink" title="1.2.安装MQ"></a>1.2.安装MQ</h5><p>执行下面的命令来运行MQ容器：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">5672：消息通信的端口</span><br><span class="line">15672：控制台界面</span><br><span class="line"><span class="comment">#后台管理</span></span><br><span class="line"><span class="comment">#程序中运用到的的端口</span></span><br><span class="line">docker run  -e RABBITMQ_DEFAULT_USER=lizhien -e RABBITMQ_DEFAULT_PASS=lizhien  --name rabbitMQ-server  --hostname mq -p \15672:15672 -p 5672:5672   -d  rabbitmq:3-management</span><br></pre></td></tr></table></figure>

<h4 id="2-集群部署"><a href="#2-集群部署" class="headerlink" title="2.集群部署"></a>2.集群部署</h4><p>接下来，我们看看如何安装RabbitMQ的集群。</p>
<h5 id="2-1-集群分类"><a href="#2-1-集群分类" class="headerlink" title="2.1.集群分类"></a>2.1.集群分类</h5><p>在RabbitMQ的官方文档中，讲述了两种集群的配置方式：</p>
<ul>
<li>普通模式：普通模式集群不进行数据同步，每个MQ都有自己的队列、数据信息（其它元数据信息如交换机等会同步）。例如我们有2个MQ：mq1，和mq2，如果你的消息在mq1，而你连接到了mq2，那么mq2会去mq1拉取消息，然后返回给你。如果mq1宕机，消息就会丢失。</li>
<li>镜像模式：与普通模式不同，队列会在各个mq的镜像节点之间同步，因此你连接到任何一个镜像节点，均可获取到消息。而且如果一个节点宕机，并不会导致数据丢失。不过，这种方式增加了数据同步的带宽消耗。</li>
</ul>
<p>我们先来看普通模式集群。</p>
<h5 id="2-2-设置网络"><a href="#2-2-设置网络" class="headerlink" title="2.2.设置网络"></a>2.2.设置网络</h5><p>首先，我们需要让3台MQ互相知道对方的存在。</p>
<p>分别在3台机器中，设置 &#x2F;etc&#x2F;hosts文件，添加如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.150.101 mq1</span><br><span class="line">192.168.150.102 mq2</span><br><span class="line">192.168.150.103 mq3</span><br></pre></td></tr></table></figure>

<p>并在每台机器上测试，是否可以ping通对方：</p>
<h4 id="springAMQP"><a href="#springAMQP" class="headerlink" title="springAMQP"></a>springAMQP</h4><p>1.基本介绍：SpringAMQP是基于<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=RabbitMQ&spm=1001.2101.3001.7020">RabbitMQ</a>封装的一套模板，并且还利用SpringBoot对其实现了自动装配，使用起来非常方便。</p>
<p>SpringAmqp的官方地址：<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-amqp">Spring AMQP</a></p>
<p>2.实现第一个helloWord</p>
<p>&lt;1&gt;导入依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>&lt;2&gt;添加配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  rabbitmq:</span><br><span class="line">    host: 192.168.5.128 # rabbitMQ的ip地址</span><br><span class="line">    port: 5672 # 端口</span><br><span class="line">    username: itcast</span><br><span class="line">    password: 123321</span><br><span class="line">    virtual-host: /</span><br></pre></td></tr></table></figure>

<p>&lt;3&gt;测试(这是在队列中存入消息)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendMessage2SimpleQueue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.name1&quot;</span>;			<span class="comment">//初始化消息队列的名字</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, spring amqp!&quot;</span>;		<span class="comment">//定义信息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(queueName, message);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&lt;4&gt;消息的消费</p>
<p>&lt;1&gt;和&lt;2&gt;步骤一样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringRabbitListener</span> &#123;</span><br><span class="line">     <span class="meta">@RabbitListener(queues = &quot;simple.name1&quot;)</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenSimpleQueue</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;消费者接收到simple.queue的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="workQueue"><a href="#workQueue" class="headerlink" title="workQueue"></a>workQueue</h4><p>概念：在队列中绑定多个消费者</p>
<p>优点：提高消息的处理效率，避免队列堆积</p>
<p>&lt;1&gt;检验多个不同的消费者消费的消息的能力</p>
<p>（1）生产消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendMessage2WorkQueue</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, message__&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">50</span>; i++) &#123;</span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message + i);</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）定义两个消费者消费消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者1接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.err.println(<span class="string">&quot;消费者2........接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&lt;2&gt;校验的结果</p>
<p>两个消费者消费的信息是一样的，但是消费者2消费的消息比较慢</p>
<p>&lt;3&gt;如何快速的将消息消费掉</p>
<p>在消费者配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  rabbitmq:</span><br><span class="line">    listener:</span><br><span class="line">      simple:</span><br><span class="line">        prefetch: 1</span><br></pre></td></tr></table></figure>

<h4 id="springAMQP发布订阅"><a href="#springAMQP发布订阅" class="headerlink" title="springAMQP发布订阅"></a>springAMQP发布订阅</h4><p>&lt;1&gt;概念：exchange将接收到的消息路由到每一个绑定的队列中</p>
<p><img src="D:\图片\QQ截图20220422144029.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220422144029.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="QQ截图20220422144029"></p>
<p>&lt;1&gt;如何将交换机与queue进行绑定</p>
<p>交换机有以下的类型</p>
<p>（1）fanoutExchange：接收消息发送者的所有消息(不会将消息存储)路由到每一个队列中</p>
<p>在消费者定义config</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个交换机</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> FanoutExchange <span class="title function_">fanoutExchange</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(<span class="string">&quot;itcast.fanout&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个队列</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Queue <span class="title function_">fanoutQueue1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue1&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定队列到交换机</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Binding <span class="title function_">fanoutBinding1</span><span class="params">(Queue fanoutQueue1, FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> BindingBuilder</span><br><span class="line">            .bind(fanoutQueue1)</span><br><span class="line">            .to(fanoutExchange);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>消息的发送者向fanoutexchange类型的交换机发送信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendFanoutExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 交换机名称</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;itcast.fanout&quot;</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, every one!&quot;</span>;</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）directExchange：接收的消息路由到指定的队列中（路由模式）</p>
<p>消息发送者带有routingkey通过directExchange与队列的进行exchangekey进行配对给消费者使用</p>
<p>在消费者的config写入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">        value = @Queue(name = &quot;direct.queue1&quot;), //指定队列的名字</span></span><br><span class="line"><span class="meta">        exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),	//指定队列的名字和交换机的类型</span></span><br><span class="line"><span class="meta">        key = &#123;&quot;red&quot;, &quot;blue&quot;&#125; //exchangekey的key值</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者接收到direct.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在发送者写入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendDirectExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 交换机名称</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;itcast.direct&quot;</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, red!&quot;</span>;</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;red&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）topicRabbit</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">        value = @Queue(name = &quot;topic.queue1&quot;),</span></span><br><span class="line"><span class="meta">        exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">        key = &quot;china.#&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者接收到topic.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSendDirectExchange() &#123;</span><br><span class="line">    // 交换机名称</span><br><span class="line">    String exchangeName = &quot;itcast.topic&quot;;</span><br><span class="line">    // 消息</span><br><span class="line">    String message = &quot;hello, red!&quot;;</span><br><span class="line">    // 发送消息</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, &quot;china.aaa&quot;, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="springAMQP消息转换器"><a href="#springAMQP消息转换器" class="headerlink" title="springAMQP消息转换器"></a>springAMQP消息转换器</h4><p>1.Spring会把消息<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%BA%8F%E5%88%97%E5%8C%96&spm=1001.2101.3001.7020">序列化</a>为字节发送给MQ，接收消息的时候，还会把字节反序列化为Java对象。</p>
<p>默认情况下Spring采用的序列化方式是JDK序列化。众所周知，JDK序列化存在下列问题：</p>
<ul>
<li>数据体积过大</li>
<li>有安全漏洞</li>
<li>可读性差</li>
</ul>
<p>2.修改spring中默认的jdk序列化方式</p>
<p>在父工程中导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改序列化的方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageConverter <span class="title function_">messageConverter</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ampqAdmin"><a href="#ampqAdmin" class="headerlink" title="ampqAdmin"></a>ampqAdmin</h4><h5 id="1-配置"><a href="#1-配置" class="headerlink" title="1.配置"></a>1.配置</h5><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.rabbitmq.port</span>=<span class="string">5672</span></span><br><span class="line"><span class="attr">spring.rabbitmq.username</span>=<span class="string">itcast</span></span><br><span class="line"><span class="attr">spring.rabbitmq.password</span>=<span class="string">123321</span></span><br><span class="line"><span class="attr">spring.rabbitmq.host</span>=<span class="string">81.68.153.224</span></span><br><span class="line"><span class="attr">spring.rabbitmq.virtual-host</span>=<span class="string">/</span></span><br></pre></td></tr></table></figure>



<h5 id="2-创建交换机"><a href="#2-创建交换机" class="headerlink" title="2.创建交换机"></a>2.创建交换机</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AmqpAdmin amqpAdmin;</span><br><span class="line"></span><br><span class="line"><span class="type">Exchange</span> <span class="variable">directExchange</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(</span><br><span class="line">                <span class="string">&quot;java-create-direct&quot;</span>, <span class="literal">true</span>, <span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">        amqpAdmin.declareExchange(directExchange);</span><br></pre></td></tr></table></figure>



<h5 id="3-创建队列"><a href="#3-创建队列" class="headerlink" title="3.创建队列"></a>3.创建队列</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        创建队列</span></span><br><span class="line">       <span class="comment">/****</span></span><br><span class="line"><span class="comment">        * String name:队列名字</span></span><br><span class="line"><span class="comment">        * boolean durable:是否持久化</span></span><br><span class="line"><span class="comment">        * boolean exclusive:独占一个连接，其他的连接不能连接使用</span></span><br><span class="line"><span class="comment">        * boolean autoDelete：自动删除</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Nullable</span> Map&lt;String, Object&gt; arguments</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="type">Queue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;java-create-direct-queue&quot;</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">       <span class="type">String</span> <span class="variable">declareQueue</span> <span class="operator">=</span> amqpAdmin.declareQueue(queue);</span><br><span class="line">       <span class="keyword">if</span>(StringUtils.hasText(declareQueue))&#123;</span><br><span class="line">           log.info(<span class="string">&quot;使用java创建队列&#123;&#125;-----success&quot;</span>,<span class="string">&quot;java-create-direct-queue&quot;</span>);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>



<h5 id="4-绑定队列与交换机或者是交换机与交换机绑定"><a href="#4-绑定队列与交换机或者是交换机与交换机绑定" class="headerlink" title="4.绑定队列与交换机或者是交换机与交换机绑定"></a>4.绑定队列与交换机或者是交换机与交换机绑定</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****</span></span><br><span class="line"><span class="comment">       * String destination：指定队列的名字或者交换机的名字</span></span><br><span class="line"><span class="comment">       * Binding.DestinationType destinationType：绑定的类型</span></span><br><span class="line"><span class="comment">       * String exchange：绑定的交换机</span></span><br><span class="line"><span class="comment">       * String routingKey：路由规则key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@Nullable</span> Map&lt;String, Object&gt; arguments：参数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="type">Binding</span> <span class="variable">binding</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Binding</span>(<span class="string">&quot;java-create-direct-queue&quot;</span>, Binding.DestinationType.QUEUE, <span class="string">&quot;java-create-direct&quot;</span>, <span class="string">&quot;lizhien&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">      amqpAdmin.declareBinding(binding);</span><br><span class="line">      log.info(<span class="string">&quot;绑定成功&quot;</span>);</span><br></pre></td></tr></table></figure>



<h5 id="5-消息的发送"><a href="#5-消息的发送" class="headerlink" title="5.消息的发送"></a>5.消息的发送</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> *    String exchange：指定需要发送到的交换机，交换机将信息投递给队列</span><br><span class="line"> *    String routingKey：路由规则</span><br><span class="line"> *    Object object：传递的数据类型</span><br><span class="line"> *</span><br><span class="line">复杂类型的JSON转换</span><br><span class="line">JSONObject.parseObject(jsonString, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;SkuHasStockVo&gt;&gt;()&#123;&#125;);</span><br><span class="line"> */</span><br><span class="line"><span class="type">String</span> <span class="variable">convertAndSendMessage</span> <span class="operator">=</span> <span class="string">&quot;&#123;&#x27;name&#x27;:&#x27;李知恩&#x27;,&#x27;age&#x27;:&#x27;30&#x27;&#125;&quot;</span>;</span><br><span class="line"><span class="type">Object</span> <span class="variable">parse</span> <span class="operator">=</span> JSON.parse(convertAndSendMessage);</span><br><span class="line">rabbitTemplate.convertAndSend(<span class="string">&quot;java-create-direct&quot;</span>,<span class="string">&quot;lizhien&quot;</span>,parse);</span><br><span class="line">log.info(<span class="string">&quot;发送消息成功----&#123;&#125;&quot;</span>, convertAndSendMessage);</span><br></pre></td></tr></table></figure>



<h5 id="6-mq序列化"><a href="#6-mq序列化" class="headerlink" title="6.mq序列化"></a>6.mq序列化</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageConverter <span class="title function_">messageConverter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="7-消息的确认机制"><a href="#7-消息的确认机制" class="headerlink" title="7.消息的确认机制"></a>7.消息的确认机制</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@PostConstruct</span></span><br><span class="line"><span class="comment">//    创建对象时就会执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initRabbitTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">/****</span></span><br><span class="line"><span class="comment">         * correlationData:这个消息唯一的id</span></span><br><span class="line"><span class="comment">         * flag:消息是否已到达brock</span></span><br><span class="line"><span class="comment">         * cause:失败的原因</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        rabbitTemplate.setConfirmCallback((correlationData, flag, cause) -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;消息的唯一ID&quot;</span>+correlationData.getId()+<span class="string">&quot;消息已经达到brock中------&gt;&quot;</span> + flag);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        brock消息传递到queue出现错误调用的回调</span></span><br><span class="line">        rabbitTemplate.setReturnsCallback(<span class="keyword">new</span> <span class="title class_">RabbitTemplate</span>.ReturnsCallback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(ReturnedMessage returnedMessage)</span> &#123;</span><br><span class="line">                returnedMessage.getMessage().getBody();</span><br><span class="line">                returnedMessage.getReplyCode();<span class="comment">//恢复的状态码</span></span><br><span class="line">                returnedMessage.getReplyText();<span class="comment">//恢复的文本</span></span><br><span class="line">                returnedMessage.getRoutingKey();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h5 id="8消费消息"><a href="#8消费消息" class="headerlink" title="8消费消息"></a>8消费消息</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/****</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RabbitListener</span> 可以标注在类上面，需配合 <span class="doctag">@RabbitHandler</span> 注解一起使用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RabbitListener</span> 标注在类上面表示当有收到消息的时候，就交给 <span class="doctag">@RabbitHandler</span> 的方法处理，</span></span><br><span class="line"><span class="comment">     * 根据接受的参数类型进入具体的方法中。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mesg</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveMessage</span><span class="params">(Message msg, Object mesg, Channel channel)</span>&#123;</span><br><span class="line">        <span class="comment">/****</span></span><br><span class="line"><span class="comment">         * 接收消息</span></span><br><span class="line"><span class="comment">         * 前提：注解：<span class="doctag">@EnableRabbit</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"><span class="comment">//        获取数据字节</span></span><br><span class="line">        <span class="type">byte</span>[] body = msg.getBody();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">parse</span> <span class="operator">=</span> JSON.parse(body);</span><br><span class="line">        System.out.println(parse);</span><br><span class="line"></span><br><span class="line"><span class="comment">//     deliveryTag默认为自动递增的</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">deliveryTag</span> <span class="operator">=</span> msg.getMessageProperties().getDeliveryTag();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//            是否为批量消费</span></span><br><span class="line">            System.out.println(<span class="string">&quot;消费的消息------&gt;&quot;</span>+deliveryTag);</span><br><span class="line"></span><br><span class="line">            channel.basicAck(deliveryTag,<span class="literal">false</span>);</span><br><span class="line"><span class="comment">//            拒绝消费（deliveryTag，是否为批量码，发回服务器，重新入队列中）</span></span><br><span class="line"><span class="comment">//            channel.basicNack(deliveryTag, true, true);</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;网络出现波动导致消息无法消费&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;接收java-create-direct-queue队列的消息是-------&gt;&#123;&#125;&quot;</span>,msg);</span><br><span class="line">        log.info(<span class="string">&quot;自动接收指定类型的接收java-create-direct-queue队列的消息是-------&gt;&#123;&#125;&quot;</span>,mesg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>















<h2 id="6-elasticSeach"><a href="#6-elasticSeach" class="headerlink" title="6.elasticSeach"></a>6.elasticSeach</h2><h4 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h4><p>​	Elasticsearch 是一个分布式、高扩展、高实时的搜索与<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/6577123">数据分析</a>引擎。它能很方便的使大量数据具有搜索、分析和探索的能力。充分利用Elasticsearch的水平伸缩性，能使数据在生产环境变得更有价值。Elasticsearch 的实现原理主要分为以下几个步骤，首先用户将数据提交到Elasticsearch 数据库中，再通过分词控制器去将对应的语句分词，将其权重和分词结果一并存入数据，当用户搜索数据时候，再根据权重将结果排名，打分，再将返回结果呈现给用户。</p>
<p>​	Elasticsearch是与名为Logstash的数据收集和日志解析引擎以及名为Kibana的分析和可视化平台一起开发的。这三个产品被设计成一个集成解决方案，称为“Elastic Stack”（以前称为“ELK stack”）。</p>
<p>​	Elasticsearch可以用于搜索各种文档。它提供可扩展的搜索，具有接近实时的搜索，并支持多租户。Elasticsearch是分布式的，这意味着索引可以被分成分片，每个分片可以有0个或多个副本。每个节点托管一个或多个分片，并充当协调器将操作委托给正确的分片。再平衡和路由是自动完成的。相关数据通常存储在同一个索引中，该索引由一个或多个主分片和零个或多个复制分片组成。一旦创建了索引，就不能更改主分片的数量。</p>
<p>​	Elasticsearch使用Lucene，并试图通过JSON和Java API提供其所有特性。它支持facetting和percolating，如果新文档与注册查询匹配，这对于通知非常有用。另一个特性称为“网关”，处理索引的长期持久性；例如，在服务器崩溃的情况下，可以从网关恢复索引。Elasticsearch支持实时GET请求，适合作为NoSQL数据存储，但缺少<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F/7316617">分布式</a>事务。</p>
<p><img src="D:\图片\QQ截图20220426122246.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220426122246.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"></p>
<h4 id="2-正向索引"><a href="#2-正向索引" class="headerlink" title="2.正向索引"></a>2.正向索引</h4><p>正向索引 (forward index) 以文档的ID为关键字，表中记录文档中每个字的位置信息，查找时扫描表中每个文档中字的信息直到找出所有包含查询关键字的文档</p>
<p>这种组织方法在建立索引的时候结构比较简单，建立比较方便且易于维护：</p>
<p>​	若是有新的文档加入，直接为该文档建立一个新的索引块，挂接在原来索引文件的后面。</p>
<p>​	若是有文档删除，则直接找到该文档号文档对应的索引信息，将其直接删除</p>
<p>缺点：</p>
<p>​	检索效率太低，只能在一起简单的场景下使用</p>
<h4 id="3-倒排索引"><a href="#3-倒排索引" class="headerlink" title="3.倒排索引"></a>3.倒排索引</h4><p>​	倒排索引以字或词为关键字进行索引，表中关键字所对应的记录表项记录了出现这个字或词的所有文档。</p>
<p>一个表项就是一个字段,它记录该文档的ID和字符在该文档中出现的位置情况。</p>
<p><img src="D:\图片\QQ截图20220426145249.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220426145249.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"></p>
<p>什么叫文档和词条</p>
<p>每一条数据就是一个文档</p>
<p>对文档内容进行分词，得到的词语就是词条</p>
<h4 id="4-索引"><a href="#4-索引" class="headerlink" title="4.索引"></a>4.索引</h4><p>索引：相同类型的文档的集合</p>
<p>映射：索引中文档字段的约束信息</p>
<p><img src="D:\图片\QQ截图20220426150810.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220426150810.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"></p>
<p><img src="D:\图片\QQ截图20220426151354.jpg" class="lazyload placeholder" data-srcset="D:\图片\QQ截图20220426151354.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"></p>
<h4 id="5-安装elasticsearch"><a href="#5-安装elasticsearch" class="headerlink" title="5. 安装elasticsearch"></a>5. 安装elasticsearch</h4><h5 id="1-拉取镜像"><a href="#1-拉取镜像" class="headerlink" title="1.拉取镜像"></a>1.拉取镜像</h5><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull elasticsearch:7.12.1</span><br><span class="line"></span><br><span class="line">docker update es --restart=always</span><br></pre></td></tr></table></figure>

<h5 id="2-创建用户定义的网络"><a href="#2-创建用户定义的网络" class="headerlink" title="2.创建用户定义的网络"></a>2.创建用户定义的网络</h5><p>（用于连接到同一网络的其他服务（例如 Kibana））：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create es-net</span><br></pre></td></tr></table></figure>

<h5 id="3-运行es"><a href="#3-运行es" class="headerlink" title="3.运行es"></a>3.运行es</h5><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name es \</span><br><span class="line">    -e &quot;ES_JAVA_OPTS=-Xms256m -Xmx256m&quot; \</span><br><span class="line">    -e &quot;discovery.type=single-node&quot; \</span><br><span class="line">    -v es-data:/usr/share/elasticsearch/data \</span><br><span class="line">    -v es-plugins:/usr/share/elasticsearch/plugins \</span><br><span class="line">    --privileged \</span><br><span class="line">    --network es-net \</span><br><span class="line">    -p 9200:9200 \</span><br><span class="line">    -p 9300:9300 \</span><br><span class="line"> elasticsearch:7.12.1</span><br><span class="line"> </span><br><span class="line"> docker run -id --name=es_net &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot; elasticsearch:7.12.1</span><br></pre></td></tr></table></figure>

<h5 id="4-访问"><a href="#4-访问" class="headerlink" title="4.访问"></a>4.访问</h5><p><a target="_blank" rel="noopener" href="http://192.168.5.128:9200/">http://192.168.5.128:9200/</a></p>
<p><a target="_blank" rel="noopener" href="https://learnku.com/docs/elasticsearch73/7.3/index-some-documents/6450">https://learnku.com/docs/elasticsearch73/7.3/index-some-documents/6450</a></p>
<h4 id="6-部署kibana"><a href="#6-部署kibana" class="headerlink" title="6.部署kibana"></a>6.部署kibana</h4><h5 id="1-拉取镜像-1"><a href="#1-拉取镜像-1" class="headerlink" title="1.拉取镜像"></a>1.拉取镜像</h5><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull kibana:7.12.1</span><br></pre></td></tr></table></figure>

<h5 id="2-使用es的网络段"><a href="#2-使用es的网络段" class="headerlink" title="2.使用es的网络段"></a>2.使用es的网络段</h5><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">--name kibana \</span><br><span class="line"> -e &quot;ES_JAVA_OPTS=-Xms128m -Xmx128m&quot; \</span><br><span class="line">    -e &quot;discovery.type=single-node&quot; \</span><br><span class="line">-e ELASTICSEARCH_HOSTS=http://es:9200 \</span><br><span class="line">--network=es-net \</span><br><span class="line">-p 5601:5601  \</span><br><span class="line">kibana:7.12.1</span><br></pre></td></tr></table></figure>

<h5 id="3-访问"><a href="#3-访问" class="headerlink" title="3.访问"></a>3.访问</h5><p><a target="_blank" rel="noopener" href="http://192.168.5.128:5601/app/home#/">http://192.168.5.128:5601/app/home#/</a></p>
<h5 id="4-模拟发送请求"><a href="#4-模拟发送请求" class="headerlink" title="4.模拟发送请求"></a>4.模拟发送请求</h5><p>《1》打开Dev tools</p>
<p>GET &#x2F;   默认就是<a target="_blank" rel="noopener" href="http://192.168.5.128:9200/%E5%8F%91%E9%80%81%E4%BF%A1%E6%81%AF">http://192.168.5.128:9200/发送信息</a></p>
<h5 id="5-安装ik分词器"><a href="#5-安装ik分词器" class="headerlink" title="5.安装ik分词器"></a>5.安装ik分词器</h5><p>1️⃣在线安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器内部</span></span><br><span class="line">docker exec -it elasticsearch /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在线下载并安装</span></span><br><span class="line">./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.1/elasticsearch-analysis-ik-7.12.1.zip</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">退出</span></span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重启容器</span></span><br><span class="line">docker restart elasticsearch</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###安装的效率比较慢</span></span></span><br></pre></td></tr></table></figure>

<p>2️⃣离线安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume inspect es-plugins    ##找到虚拟主机目录的位置</span><br></pre></td></tr></table></figure>

<p>显示结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#说明kibana向es发送的请求</span></span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2022-05-06T10:06:34+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/es-plugins/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;es-plugins&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>说明plugins目录被挂载到了：<code>/var/lib/docker/volumes/es-plugins/_data </code>这个目录中。</p>
<p>ik安装的位置 D:\ik，然后将ik的文件上传于挂载的目录</p>
<p>3️⃣重启es即可</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart es</span><br></pre></td></tr></table></figure>

<p>4️⃣测试</p>
<p>IK分词器包含两种模式：</p>
<ul>
<li><p><code>ik_smart</code>：最少切分</p>
</li>
<li><p><code>ik_max_word</code>：最细切分</p>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;黑马程序员学习java太棒了&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>在&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;es-plugins&#x2F;_data&#x2F;ik&#x2F;config中的IKAnalyzer.cfg.xml进行修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">	&lt;comment&gt;IK Analyzer 扩展配置&lt;/comment&gt;</span><br><span class="line">	&lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span><br><span class="line">	&lt;entry key=&quot;ext_dict&quot;&gt;ext.dic&lt;/entry&gt;</span><br><span class="line">	 &lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span><br><span class="line">	&lt;entry key=&quot;ext_stopwords&quot;&gt;stopword.dic&lt;/entry&gt;</span><br><span class="line">	&lt;!--用户可以在这里配置远程扩展字典 --&gt;</span><br><span class="line">	&lt;!-- &lt;entry key=&quot;remote_ext_dict&quot;&gt;words_location&lt;/entry&gt; --&gt;</span><br><span class="line">	&lt;!--用户可以在这里配置远程扩展停止词字典--&gt;</span><br><span class="line">	&lt;!-- &lt;entry key=&quot;remote_ext_stopwords&quot;&gt;words_location&lt;/entry&gt; --&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>

<p>创建ext.dic和stopword.dic的文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat ext.dic</span><br><span class="line">六六六</span><br></pre></td></tr></table></figure>

<p>重启es即可</p>
<h5 id="cat"><a href="#cat" class="headerlink" title="_cat"></a>_cat</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/indices</span><br><span class="line">GET /customer/external/1</span><br></pre></td></tr></table></figure>



<h5 id="6-创建索引库"><a href="#6-创建索引库" class="headerlink" title="6.创建索引库"></a>6.创建索引库</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#创建索引库</span><br><span class="line">#keyword类型的数据不参与分词</span><br><span class="line">PUT /itheima</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123; ##字段的约束</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;info&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;index&quot;: true, ##支持搜索</span><br><span class="line">        &quot;analyzer&quot;: &quot;ik_smart&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;email&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">        &quot;index&quot;: false</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;name&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;object&quot;, </span><br><span class="line">        &quot;properties&quot;: &#123;</span><br><span class="line">          &quot;firstName&quot;: &#123;</span><br><span class="line">            &quot;type&quot;:&quot;keyword&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">           &quot;lastName&quot;: &#123;</span><br><span class="line">            &quot;type&quot;:&quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="7-索引库的操作"><a href="#7-索引库的操作" class="headerlink" title="7.索引库的操作"></a>7.索引库的操作</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET /itheima</span><br><span class="line"></span><br><span class="line">#添加索引库的字段</span><br><span class="line">PUT /itheima/_mapping</span><br><span class="line">&#123;</span><br><span class="line">  &quot;properties&quot;:&#123;</span><br><span class="line">    &quot;age&quot;:&#123;</span><br><span class="line">      &quot;type&quot;:&quot;long&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#删除索引库</span><br><span class="line">DELETE /itheima</span><br></pre></td></tr></table></figure>

<h5 id="8-文档的基本操作"><a href="#8-文档的基本操作" class="headerlink" title="8.文档的基本操作"></a>8.文档的基本操作</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># 文档的插入，查询文档会使索引库的版本增加</span><br><span class="line">POST /itheima/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;info&quot;:&quot;正在听黑马程序员java讲师&quot;,</span><br><span class="line">  &quot;email&quot;:&quot;3092319040@qq.com&quot;,</span><br><span class="line">  &quot;name&quot;:&#123;</span><br><span class="line">    &quot;firstName&quot;:&quot;张&quot;,</span><br><span class="line">    &quot;lastName&quot;:&quot;三&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#文档的删除,删除文档会使索引库的版本增加</span><br><span class="line">DELETE /itheima/_doc/1</span><br><span class="line"></span><br><span class="line">#查看文档是否插入成功</span><br><span class="line">GET  /itheima/_doc/1</span><br><span class="line"></span><br><span class="line"># 全量修改文档，在这里id不存在时会进行新增的操作</span><br><span class="line">PUT /itheima/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;info&quot;:&quot;正在听黑马程序员java讲师&quot;,</span><br><span class="line">  &quot;email&quot;:&quot;zhangsan@qq.com&quot;,</span><br><span class="line">  &quot;name&quot;:&#123;</span><br><span class="line">    &quot;firstName&quot;:&quot;张&quot;,</span><br><span class="line">    &quot;lastName&quot;:&quot;三&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#局部修改文档</span><br><span class="line">POST /itheima/_update/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;doc&quot;:&#123;</span><br><span class="line">    &quot;email&quot;:&quot;zhangsan1@qq.com&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="7-restclient操作索引库"><a href="#7-restclient操作索引库" class="headerlink" title="7.restclient操作索引库"></a>7.restclient操作索引库</h3><p>1.导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--elasticsearch 版本7.12.1，采用springboot的版本仲裁--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>2.初始化索引库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HotelIndexTest1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDeleteIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(client);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//初始化索引库,操作es</span></span><br><span class="line">        client = <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">                HttpHost.create(<span class="string">&quot;http://192.168.5.128:9200&quot;</span>)</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3.创建索引库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testCreateIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.准备Request      PUT /hotel hotel索引库的名称</span></span><br><span class="line">    <span class="type">CreateIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.准备请求参数，MAPPING_TEMPLATE为以定义的变量，创建索引库的语句</span></span><br><span class="line">    request.source(MAPPING_TEMPLATE, XContentType.JSON);</span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>4.浏览器上创建索引库</p>
<p>注意：es支持两种地理坐标数据类型</p>
<ul>
<li>geo_point:确定了经纬度，类似于地图上面的一个点</li>
<li>geo_shape:一个图形</li>
</ul>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">PUT /hotel</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">   &quot;properties&quot;: &#123;</span><br><span class="line">     &quot;id&quot;:&#123;</span><br><span class="line">       &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">     &#125;,</span><br><span class="line">     &quot;name&quot;:&#123;</span><br><span class="line">       &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">       &quot;analyzer&quot;: &quot;ik<span class="built_in">_</span>max<span class="built_in">_</span>word&quot;,</span><br><span class="line">       &quot;copy<span class="built_in">_</span>to&quot;: &quot;all&quot;</span><br><span class="line">     &#125;,</span><br><span class="line">     &quot;address&quot;:&#123;</span><br><span class="line">       &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">       &quot;index&quot;: &quot;false&quot;</span><br><span class="line">     &#125;,</span><br><span class="line">     &quot;price&quot;:&#123;</span><br><span class="line">       &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">     &#125;,</span><br><span class="line">     &quot;socre&quot;:&#123;</span><br><span class="line">       &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">     &#125;,</span><br><span class="line">     &quot;brand&quot;:&#123;</span><br><span class="line">       &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">       &quot;copy<span class="built_in">_</span>to&quot;: &quot;all&quot;</span><br><span class="line">     &#125;,</span><br><span class="line">     &quot;city&quot;:&#123;</span><br><span class="line">       &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">       &quot;copy<span class="built_in">_</span>to&quot;: &quot;all&quot;</span><br><span class="line">     &#125;,</span><br><span class="line">     &quot;startName&quot;:&#123;</span><br><span class="line">       &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">       &quot;copy<span class="built_in">_</span>to&quot;: &quot;all&quot;</span><br><span class="line">     &#125;,</span><br><span class="line">     &quot;business&quot;:&#123;</span><br><span class="line">       &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">       &quot;copy<span class="built_in">_</span>to&quot;: &quot;all&quot;</span><br><span class="line">     &#125;,</span><br><span class="line">     &quot;location&quot;:&#123;</span><br><span class="line">       &quot;type&quot;: &quot;geo<span class="built_in">_</span>point&quot;</span><br><span class="line">     &#125;,</span><br><span class="line">     &quot;pic&quot;:&#123;</span><br><span class="line">       &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">       &quot;index&quot;: false</span><br><span class="line">     &#125;,</span><br><span class="line">     &quot;all&quot;:&#123;</span><br><span class="line">       &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">       &quot;analyzer&quot;: &quot;ik<span class="built_in">_</span>max<span class="built_in">_</span>word&quot;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>5.其他操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断索引库是否存在</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">exitsIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">   <span class="type">GetIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>) ;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> client.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(exists ? <span class="string">&quot;该索引库存在&quot;</span> : <span class="string">&quot;索引库不存在&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除索引库</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">    <span class="type">DeleteIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>) ;</span><br><span class="line">    <span class="type">AcknowledgedResponse</span> <span class="variable">delete</span> <span class="operator">=</span> client.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>6.文档的增删改查</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HotelDocumentTest1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IHotelService hotelService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//向索引库中添加文档</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testAddDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//根据ID查询数据库</span></span><br><span class="line">        <span class="type">Hotel</span> <span class="variable">hotel</span> <span class="operator">=</span> hotelService.getById(<span class="number">61083L</span>);</span><br><span class="line">        <span class="comment">//将数据库的字段与properties字段相同</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotelDoc</span>(hotel) ;</span><br><span class="line">        <span class="comment">//指定索引库和文档的id（此文档的id的数据库里的ID，这里的ID是唯一的，可以随便指定）</span></span><br><span class="line">        <span class="type">IndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;hotel&quot;</span>).id(hotel.getId().toString()) ;</span><br><span class="line">        <span class="comment">//json的序列化</span></span><br><span class="line">        request.source(JSON.toJSONString(hotelDoc),XContentType.JSON) ;</span><br><span class="line">        client.index(request,RequestOptions.DEFAULT) ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//查询索引库</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        <span class="type">GetRequest</span> <span class="variable">getRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetRequest</span>(<span class="string">&quot;hotel&quot;</span>).id(<span class="string">&quot;61083&quot;</span>) ;</span><br><span class="line">        <span class="type">GetResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.get(getRequest, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">//从索引库中查询的数据，数据格式为json(因为在查询文档时用的数据类型是json的格式)</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> response.getSourceAsString();</span><br><span class="line">        <span class="comment">//将json数据转为HotelDoc类型的数据</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">        System.out.println(hotelDoc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//修改文档</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testUpdateDocument</span> <span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        <span class="type">UpdateRequest</span> <span class="variable">updateRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(<span class="string">&quot;hotel&quot;</span>,<span class="string">&quot;61083&quot;</span>) ;</span><br><span class="line">        updateRequest.doc(</span><br><span class="line">                    <span class="string">&quot;price&quot;</span>,<span class="string">&quot;3333&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;starName&quot;</span>,<span class="string">&quot;四砖&quot;</span></span><br><span class="line">        );</span><br><span class="line">        <span class="type">UpdateResponse</span> <span class="variable">update</span> <span class="operator">=</span> client.update(updateRequest, RequestOptions.DEFAULT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDeleteDocumentById</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.准备Request      // DELETE /hotel/_doc/&#123;id&#125;</span></span><br><span class="line">        <span class="type">DeleteRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(<span class="string">&quot;hotel&quot;</span>, <span class="string">&quot;61083&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.发送请求</span></span><br><span class="line">        client.delete(request, RequestOptions.DEFAULT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        client = <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">                HttpHost.create(<span class="string">&quot;http://192.168.5.128:9200&quot;</span>)</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>7.批量插入文档</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 批量插入文档</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">void</span> <span class="title function_">testBulkRequest</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">     <span class="comment">//查询数据中所有的数据</span></span><br><span class="line">     List&lt;Hotel&gt; hotels = hotelService.list();</span><br><span class="line">     <span class="type">BulkRequest</span> <span class="variable">bulkRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>() ;</span><br><span class="line">     <span class="keyword">for</span> (Hotel hotel : hotels) &#123;</span><br><span class="line">         <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotelDoc</span>(hotel) ;</span><br><span class="line">         bulkRequest.add(</span><br><span class="line">             <span class="comment">//指定要插入的索引库</span></span><br><span class="line">                 <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;hotel&quot;</span>)</span><br><span class="line">                         .id(hotelDoc.getId().toString())</span><br><span class="line">                         .source(JSON.toJSONString(hotelDoc),XContentType.JSON)) ;</span><br><span class="line">     &#125;</span><br><span class="line">     client.bulk(bulkRequest,RequestOptions.DEFAULT) ;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>#查询文档所有的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /hotel/_search</span><br></pre></td></tr></table></figure>



<p>8.match_all查询</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>9.match查询</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">all 为索引库的字段,包含了&quot;name&quot;,&quot;brand&quot;,&quot;business&quot;等字段</span><br><span class="line"></span><br><span class="line">GET /hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;all&quot;: &quot;如家酒店&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>10 muti_match</p>
<p>查询多个字段 (参与查询的字段越多，查询的效率就越慢)</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fields:[&quot;字段&quot;....]</span><br><span class="line"></span><br><span class="line">GET /hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;如家酒店&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;name&quot;,&quot;brand&quot;,&quot;business&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>11、term 、range查询</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">term精确查询</span></span><br><span class="line">GET /hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;city&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;上海&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">range范围查询</span></span><br><span class="line">GET /hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;gte&quot;: 1000,</span><br><span class="line">        &quot;lte&quot;: 2000</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>12、地理查询</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">地理查询distance</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以location为一个中心点，distance为半径画一个圆，找到附近的点</span></span><br><span class="line">GET /hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;geo_distance&quot;:&#123;</span><br><span class="line">      &quot;distance&quot;:&quot;15km&quot;,</span><br><span class="line">      &quot;location&quot;:&quot;31.21,121.5&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-复合查询"><a href="#4-复合查询" class="headerlink" title="4.复合查询"></a>4.复合查询</h3><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">function</span> score复合查询</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">&quot;boost_mode&quot;</span>: <span class="string">&quot;multiply&quot;</span>的函数式为<span class="keyword">function</span> * _score</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">&quot;boost_mode&quot;</span>: <span class="string">&quot;sum&quot;</span>函数式是<span class="keyword">function</span> + _score</span></span><br><span class="line">GET /hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;function_score&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match&quot;: &#123;</span><br><span class="line">          &quot;all&quot;: &quot;外滩&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;functions&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;filter&quot;: &#123;</span><br><span class="line">            &quot;term&quot;: &#123;</span><br><span class="line">              &quot;brand&quot;: &quot;如家&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;weight&quot;: 10</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;boost_mode&quot;: &quot;sum&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bool复合查询</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">must:必须匹配的条件，可以理解为“与”</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">should:选择性匹配的条件，可以理解为“或”</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">must_not:必须不匹配的条件，不参与打分</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">filter:必须匹配的条件，不参与打分</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;name&quot;: &quot;如家&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;range&quot;: &#123;</span><br><span class="line">            &quot;price&quot;: &#123;</span><br><span class="line">              &quot;gt&quot;: 400</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;filter&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;geo_distance&quot;: &#123;</span><br><span class="line">            &quot;distance&quot;: &quot;10km&quot;,</span><br><span class="line">            &quot;location&quot;: &#123;</span><br><span class="line">              &quot;lat&quot;: 31.21,</span><br><span class="line">              &quot;lon&quot;: 121.5</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>sort查询</p>
<p>desc 降序  asc升序</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">GET /hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;score&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;asc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  , &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;_geo_distance&quot;: &#123;</span><br><span class="line">        &quot;location&quot;: &#123;</span><br><span class="line">          &quot;lat&quot;: 31,</span><br><span class="line">          &quot;lon&quot;: 121</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;order&quot;: &quot;asc&quot;,</span><br><span class="line">        &quot;unit&quot;: &quot;km&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>分页</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET /hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 10</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>高亮</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET /hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;all&quot;: &quot;如家酒店&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &#123;</span><br><span class="line">        &quot;require_field_match&quot;: &quot;false&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-聚合"><a href="#5-聚合" class="headerlink" title="5.聚合"></a>5.聚合</h3><h2 id="7-swagger"><a href="#7-swagger" class="headerlink" title="7.swagger"></a>7.swagger</h2><h3 id="1-作用"><a href="#1-作用" class="headerlink" title="1.作用"></a>1.作用</h3><p>​		根据在代码中使用自定义的注解来生成接口文档，这个在前后端分离的项目中很重要。这样做的好处是 在开发接口时可以通过swagger 将接口文档定义好，同时也方便以后的维护。<br>​	在没有swagger之前，我们可以使用word，excel等功能来书写接口定义文档，但又有一个弊端，即： 在接口发送改变时需要及时的同步接口文档，否则实际的接口与接口文档不相符，则接口文件就失去了作用，甚至会起到反作用。</p>
<h3 id="2-优点"><a href="#2-优点" class="headerlink" title="2.优点"></a>2.优点</h3><ul>
<li>号称时最流行的 API 框架</li>
<li>接口文档在线生成，避免同步的麻烦</li>
<li>可以支持在线对接口执行测试</li>
<li>支持多语言</li>
</ul>
<h3 id="3-依赖"><a href="#3-依赖" class="headerlink" title="3.依赖"></a>3.依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span> io.springfox <span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span> 2.9.2 <span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span> io.springfox <span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span> 2.9.2 <span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-swagger配置类"><a href="#4-swagger配置类" class="headerlink" title="4.swagger配置类"></a>4.swagger配置类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zking.mini_program.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">createRestApi</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2).apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">            	.apis(RequestHandlerSelectors.withClassAnnotation(RestController.class))</span><br><span class="line">            	<span class="comment">//RequestHandlerSelectors：配置要扫描接口的方式</span></span><br><span class="line">                <span class="comment">//basePackage：指定要扫描的包</span></span><br><span class="line">                <span class="comment">//any() ：扫描全部</span></span><br><span class="line">                <span class="comment">//none()：都不扫描</span></span><br><span class="line">            	.apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.luyidog.swaggerdemo.controller&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.ant(<span class="string">&quot;/swaggerdemo/**&quot;</span>)) <span class="comment">//过滤什么路径</span></span><br><span class="line">                .build();<span class="comment">//扫描</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;SwaggerDemo API DOC&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;SwaggerDemo API DOC&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>) .termsOfServiceUrl(<span class="string">&quot;https://www.baidu.com&quot;</span>) .build(); </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h2 id="8-多线程异步编排"><a href="#8-多线程异步编排" class="headerlink" title="8.多线程异步编排"></a>8.多线程异步编排</h2><h4 id="1-多线程创建的几种方式"><a href="#1-多线程创建的几种方式" class="headerlink" title="1.多线程创建的几种方式"></a>1.多线程创建的几种方式</h4><p>第一种：继承Thread类</p>
<p>​    ①定义一个类、继承Thread类；</p>
<p>​    ②在这个类里面重写run()方法；</p>
<p>​    ③创建这个类的对象；</p>
<p>​    ④启动线程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/创建MyThread继承Thread类</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//重写run方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;线程启动了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//创建MyThread对象</span></span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">mt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        mt.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>第二种：实现Runnable接口</p>
<pre><code>    ①定义一个类MyRunnable实现Runnable接口；

    ②在MyRunnable类中重写run()方法；

    ③创建MyRunnable类的对象；

    ④创建Thread类对象，把MyRunnable对象作为参数传递给该对象；

    ⑤启动线程
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建MyRunnable类  实现Runnable接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//重写run方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;线程启动了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//创建MyRunnable对象</span></span><br><span class="line">        <span class="type">MyRunnable</span> <span class="variable">mr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//创建Thread对象  将MyRunnable对象传递进去</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(mr);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>第三种：使用Callable和Future实现</p>
<pre><code>    ①定义一个MyCallable类，实现Callable接口；

    ②在MyCallable类中重写call()方法（此方法有返回值）；

    ③创建MyCallable对象；

    ④创建Future的实现类对象FutureTask，把MyCallable对象作为构造方法的参数；

    ⑤创建Thread类的对象，把FutureTask作为构造方法的参数；

    ⑥启动线程
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//定义一个MyCallable类，实现Callable接口</span><br><span class="line">public class MyCallable implements Callable&lt;String&gt; &#123;</span><br><span class="line"> </span><br><span class="line">    //重写call()方法</span><br><span class="line">    @Override</span><br><span class="line">    public String call() throws Exception &#123;</span><br><span class="line"> </span><br><span class="line">        System.out.println(&quot;线程开启了22&quot;);</span><br><span class="line"> </span><br><span class="line">        return &quot;结果&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"> </span><br><span class="line">        //创建MyCallable对象</span><br><span class="line">        MyCallable myCallable = new MyCallable();</span><br><span class="line"> </span><br><span class="line">        //创建Future的实现类对象FutureTask，把MyCallable对象作为构造方法的参数</span><br><span class="line">        FutureTask&lt;String&gt; futureTask = new FutureTask&lt;&gt;(myCallable);</span><br><span class="line"> </span><br><span class="line">        //创建Thread类的对象，把FutureTask作为构造方法的参数</span><br><span class="line">        Thread thread =new Thread(futureTask);</span><br><span class="line"> </span><br><span class="line">        //启动线程</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-线程池"><a href="#2-线程池" class="headerlink" title="2. 线程池"></a>2. 线程池</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize,</span></span><br><span class="line"><span class="params">                          <span class="type">int</span> maximumPoolSize,</span></span><br><span class="line"><span class="params">                          <span class="type">long</span> keepAliveTime,</span></span><br><span class="line"><span class="params">                          TimeUnit unit,</span></span><br><span class="line"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span><br><span class="line"><span class="params">                          ThreadFactory threadFactory,</span></span><br><span class="line"><span class="params">                          RejectedExecutionHandler handler)</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line">corePoolSize：核心线程数。</span><br><span class="line">maximumPoolSize：最大线程数。</span><br><span class="line">keepAliveTime：空闲线程存活时间。</span><br><span class="line">TimeUnit：时间单位。</span><br><span class="line">BlockingQueue：线程池任务队列。</span><br><span class="line">ThreadFactory：创建线程的工厂。</span><br><span class="line">RejectedExecutionHandler：拒绝策略。</span><br></pre></td></tr></table></figure>



<h2 id="3-异步编排"><a href="#3-异步编排" class="headerlink" title="3.异步编排"></a>3.异步编排</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">Executor</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"><span class="comment">//        lamda表达式中没有返回值</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; completableFuture = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName());</span><br><span class="line">        &#125;, executors);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        lamda表达式中有返回值</span></span><br><span class="line">        CompletableFuture&lt;Integer&gt; integerCompletableFuture = CompletableFuture.supplyAsync(() -&gt; <span class="number">1</span>, executors);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">result</span> <span class="operator">=</span> integerCompletableFuture.get();</span><br><span class="line">        System.out.println(<span class="string">&quot;获取的返回值是：&quot;</span>+result);</span><br><span class="line">        CompletableFuture&lt;Integer&gt; completableFuture = CompletableFuture.supplyAsync(() -&gt; <span class="number">1</span>,</span><br><span class="line">                executors).whenCompleteAsync((res, exec) -&gt; &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;得到的结果是&quot;</span>+res);</span><br><span class="line">        &#125;).exceptionally(throwable-&gt;&#123;</span><br><span class="line"><span class="comment">//        感知异常</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        whenCompleteAsync：单线程完成之后执行的函数</span></span><br><span class="line"><span class="comment">//        方法执行之后做处理handle</span></span><br><span class="line">        CompletableFuture&lt;Integer&gt; completableFuture = CompletableFuture.supplyAsync(() -&gt; <span class="number">1</span>,</span><br><span class="line">                executors).whenCompleteAsync((res, exec) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;得到的结果是&quot;</span>+res);</span><br><span class="line">        &#125;).handle((res,exe)-&gt;&#123;</span><br><span class="line">            <span class="keyword">return</span> res*<span class="number">2</span>;</span><br><span class="line">        &#125;) ;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法执行之后处理得到的结果是：&quot;</span>+completableFuture.get());</span><br><span class="line"></span><br><span class="line"><span class="comment">//        线程的串行话</span></span><br><span class="line"><span class="comment">//        thenRunAsync：不能接收上一个线程的返回值</span></span><br><span class="line">        CompletableFuture.supplyAsync(() -&gt; <span class="number">1</span>, executors).thenRunAsync(()-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;第二个线程开始执行了&quot;</span>);</span><br><span class="line">        &#125;,executors);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        thenAcceptAsync：能够接收上一个线程的返回值，但是第二个线程没有返回值</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; voidCompletableFuture = CompletableFuture.supplyAsync(() -&gt; <span class="number">1</span>, executors).thenAcceptAsync((res) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;第二线程接收的第一个线程的返回值是&quot;</span> + res);</span><br><span class="line">        &#125;, executors);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        thenApplyAsync：能够接收上一个线程的返回值，第二个线程有返回值</span></span><br><span class="line">        CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; <span class="number">1</span>, executors).thenApplyAsync((res) -&gt; res, executors);</span><br><span class="line">        CompletableFuture&lt;Integer&gt; future1 = CompletableFuture.supplyAsync(() -&gt; <span class="number">1</span>, executors).thenApplyAsync((res) -&gt; res, executors);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        两个一起执行完成</span></span><br><span class="line"><span class="comment">//       runAfterBothAsync：两个线程一起执行，但是不能接收上几个线程的返回值，自己也不会有返回值</span></span><br><span class="line">        voidCompletableFuture.runAfterBothAsync(future, ()-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;任务三开始执行&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        thenAcceptBothAsync：能够接收上线程的返回值，但是自身线程没有返回值</span></span><br><span class="line">        voidCompletableFuture.thenAcceptBothAsync(future, (r1,r2)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;接收第一个线程的返回值是：&quot;</span>+r1);</span><br><span class="line">            System.out.println(<span class="string">&quot;接收第二个线程的返回值是：&quot;</span>+r2);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        thenCombineAsync：能够接收上线程的返回值并且自身线程有返回值</span></span><br><span class="line">        voidCompletableFuture.thenCombineAsync(future,(r1,r2)-&gt;<span class="string">&quot;接收的第一个线程的返回值是&quot;</span>+r1+<span class="string">&quot;接收第二个线程的返回值是：&quot;</span>+r2).get();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//   两个线程执行完一个</span></span><br><span class="line"><span class="comment">//        runAfterEitherAsync：两个线程执行一个但是不能接收上线程的返回值，自身也没有返回值</span></span><br><span class="line">        voidCompletableFuture.runAfterEitherAsync(future, ()-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;第三个线程开始执行&quot;</span>);</span><br><span class="line">        &#125;,executors);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        acceptEitherAsync:接收最先执行的线程的参数，但是自身没有返回值</span></span><br><span class="line"><span class="comment">//        注意：这里两个线程的返回值需要是一样的</span></span><br><span class="line">        future1.acceptEitherAsync(future,(r1)-&gt;&#123;&#125;,executors);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        applyToEitherAsync:能够接收最先执行的线程的返回值参数并且自身也能有返回值</span></span><br><span class="line">        future.applyToEitherAsync(future1, (r1)-&gt;r1,executors);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        全部执行后才能执行主程序</span></span><br><span class="line">        CompletableFuture.allOf(voidCompletableFuture,future);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        执行一个线程就可以执行后续的主程序</span></span><br><span class="line"><span class="comment">//        CompletableFuture.anyOf(voidCompletableFuture,future);</span></span><br></pre></td></tr></table></figure>



<h3 id="workQueue-1"><a href="#workQueue-1" class="headerlink" title="workQueue"></a>workQueue</h3><p>BlockingQueue:任意时刻只有一个线程可以进行take或者put操作，并且BlockingQueue提供了超时return null的机制，在许多生产场景里都可以看到这个工具的身影.</p>
<h4 id="常见的4中阻塞队列"><a href="#常见的4中阻塞队列" class="headerlink" title="常见的4中阻塞队列"></a>常见的4中阻塞队列</h4><p>1、ArrayBlockingQueue 由数组支持的有界队列</p>
<p>2、LinkedBlockingQueue 由链接节点支持的可选有界队列</p>
<p>3、PriorityBlockingQueue 由优先级堆支持的无界优先级队列</p>
<p>4、DelayQueue 由优先级堆支持的、基于时间的调度队列</p>
<h1 id="netty"><a href="#netty" class="headerlink" title="netty"></a>netty</h1><h1 id="sentinel"><a href="#sentinel" class="headerlink" title="sentinel"></a>sentinel</h1><h2 id="微服务的雪崩问题"><a href="#微服务的雪崩问题" class="headerlink" title="微服务的雪崩问题"></a>微服务的雪崩问题</h2><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230126113743726.png" class="lazyload placeholder" data-srcset="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230126113743726.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20230126113743726"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230126114053550.png" class="lazyload placeholder" data-srcset="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230126114053550.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20230126114053550"></p>
<h2 id="限流"><a href="#限流" class="headerlink" title="限流"></a>限流</h2><h3 id="1-流控模式"><a href="#1-流控模式" class="headerlink" title="1.流控模式"></a>1.流控模式</h3><p>流控模式有哪些?<br>·直接:对当前资源限流<br>·关联:高优先级资源触发阈值，对低优先级资源限流。注解sentinelR</p>
<p>·链路:阈值统计时，只统计从指定资源进入当前资源的请求<br>，是对请求来源的限流<br>命</p>
<p>热点限流 注解sentienl controller</p>
<h2 id="线程隔离"><a href="#线程隔离" class="headerlink" title="线程隔离"></a>线程隔离</h2><h2 id="熔断与降级"><a href="#熔断与降级" class="headerlink" title="熔断与降级"></a>熔断与降级</h2><p>慢请求、抛异常</p>
<h3 id="本地应用接入本地控制台"><a href="#本地应用接入本地控制台" class="headerlink" title="本地应用接入本地控制台"></a>本地应用接入本地控制台</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dcsp.sentinel.dashbroad.server=121.36.72.245:9000 -Dproject.name=RetailerGatewayApplication</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--sentinel核心依赖--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--本地应用接入本地控制台的依赖--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-transport-simple-http<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>







<h1 id="七-配置git"><a href="#七-配置git" class="headerlink" title="七 配置git"></a>七 配置git</h1><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">2、配置 git，进入 git bash</span><br><span class="line"># 配置用户名</span><br><span class="line">git config --global user.name &quot;ck&quot; //（名字）</span><br><span class="line"># 配置邮箱</span><br><span class="line">git config --global user.email &quot;3092319040@qq.com&quot; //(注册账号时用的邮箱)</span><br><span class="line">3、配置 ssh 免密登录</span><br><span class="line">https://gitee.com/help/articles/4181#article-header0</span><br><span class="line">进入 git bash；使用：ssh-keygen -t rsa -C &quot;3092319040@qq.com&quot;命令。 连续三次回车。</span><br><span class="line">一般用户目录下会有</span><br><span class="line">或者 cat ~/.ssh/id_rsa.pub</span><br><span class="line">登录进入 gitee，在设置里面找到 SSH KEY 将.pub 文件的内容粘贴进去</span><br><span class="line">使用 ssh -T git@gitee.com 测试是否成功即可</span><br></pre></td></tr></table></figure>

<p>创建项目时Project from Version Control</p>
<p>123456qwas  密码 <a target="_blank" rel="noopener" href="http://gitlab.dev.xbov.cn/broadcast-micro-service/xinghua-broadcast.git">http://gitlab.dev.xbov.cn/broadcast-micro-service/xinghua-broadcast.git</a>	</p>
<ol>
<li><p>进入Git Bash Here，查看仓库所有分支git branch -a</p>
</li>
<li><p>使用命令 git checkout master，表示切换到master分支，并git pull拉取最新代码</p>
</li>
<li><p>由于的所在的分支为master， 使用命令git checkout -b br_master，br_master表示基于当前分支master创建的分支</p>
</li>
<li><p>将新创建的分支推送到远程仓库，命令为git push origin br_master</p>
</li>
<li><p>将br_master本地分支和远程br_master分支进行关联, 命令为git branch –set-upstream-to&#x3D;origin&#x2F;br_master,如果不进行这个操作的话，git pull将会失败。</p>
</li>
</ol>
<h1 id="poi"><a href="#poi" class="headerlink" title="poi"></a>poi</h1><p>操作Excel目前比较流行的就是 <strong>Apache POI</strong>和阿里巴巴的 <strong>easyExcel</strong></p>
<p>Apache POI官网 ：<a target="_blank" rel="noopener" href="https://poi.apache.org/">https://poi.apache.org/</a></p>
<p>基本功能<br>	结构：<br>	HSSF–提供读写MicrosoftExcel格式档案的功能。 xls<br>	XSSF–提供读写MicrosoftExcel OOXML格式档案的功能。 xlsx<br>	SXSSF<br>	HWPF–提供读写MicrosoftExcel Word格式档案的功能。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入依赖--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--xls(03)--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--xlsx(07)--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--日期格式化工具--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>需要注意：2003版本和2007版本存在兼容性问题！03最多只有65535行！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">03</span>版本 HSSF      </span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个工作簿03</span></span><br><span class="line">        Workbook workbook=<span class="keyword">new</span> <span class="title class_">HSSFWorkbook</span>();</span><br><span class="line">        <span class="comment">//创建一个工作表</span></span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workbook.createSheet(<span class="string">&quot;金飞鹏&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建第一行</span></span><br><span class="line">        <span class="type">Row</span> <span class="variable">row1</span> <span class="operator">=</span> sheet.createRow(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//创建第11单元格</span></span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cell11</span> <span class="operator">=</span> row1.createCell(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//写入数据</span></span><br><span class="line">        cell11.setCellValue(<span class="number">666</span>);</span><br><span class="line">        <span class="comment">//创建第12单元格</span></span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cell12</span> <span class="operator">=</span> row1.createCell(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//写入数据</span></span><br><span class="line">        cell12.setCellValue(<span class="number">999</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建第二行</span></span><br><span class="line">        Row row2=sheet.createRow(<span class="number">1</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">time</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTime</span>().toString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="comment">//创建第21单元格</span></span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cell21</span> <span class="operator">=</span> row2.createCell(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//写入数据</span></span><br><span class="line">        cell21.setCellValue(time);</span><br><span class="line">        <span class="comment">//创建第22单元格</span></span><br><span class="line">        <span class="type">Cell</span> <span class="variable">cell22</span> <span class="operator">=</span> row2.createCell(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//写入数据</span></span><br><span class="line">        cell22.setCellValue(time);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个工作表 03版本使用xls结尾！</span></span><br><span class="line">        FileOutputStream  fileOutputStream=<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(path+<span class="string">&quot;金飞鹏03.xls&quot;</span>);</span><br><span class="line">        workbook.write(fileOutputStream);</span><br><span class="line">        <span class="comment">//关闭流</span></span><br><span class="line">        fileOutputStream.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;excel表生成完毕&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个工作簿07</span></span><br><span class="line">      Workbook workbook=<span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>();</span><br><span class="line">      <span class="comment">//创建一个工作表</span></span><br><span class="line">      <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workbook.createSheet(<span class="string">&quot;金飞鹏&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//创建第一行</span></span><br><span class="line">      <span class="type">Row</span> <span class="variable">row1</span> <span class="operator">=</span> sheet.createRow(<span class="number">0</span>);</span><br><span class="line">      <span class="comment">//创建第11单元格</span></span><br><span class="line">      <span class="type">Cell</span> <span class="variable">cell11</span> <span class="operator">=</span> row1.createCell(<span class="number">0</span>);</span><br><span class="line">      <span class="comment">//写入数据</span></span><br><span class="line">      cell11.setCellValue(<span class="number">666</span>);</span><br><span class="line">      <span class="comment">//创建第12单元格</span></span><br><span class="line">      <span class="type">Cell</span> <span class="variable">cell12</span> <span class="operator">=</span> row1.createCell(<span class="number">1</span>);</span><br><span class="line">      <span class="comment">//写入数据</span></span><br><span class="line">      cell12.setCellValue(<span class="number">999</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//创建第二行</span></span><br><span class="line">      Row row2=sheet.createRow(<span class="number">1</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">time</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTime</span>().toString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">      <span class="comment">//创建第21单元格</span></span><br><span class="line">      <span class="type">Cell</span> <span class="variable">cell21</span> <span class="operator">=</span> row2.createCell(<span class="number">0</span>);</span><br><span class="line">      <span class="comment">//写入数据</span></span><br><span class="line">      cell21.setCellValue(time);</span><br><span class="line">      <span class="comment">//创建第22单元格</span></span><br><span class="line">      <span class="type">Cell</span> <span class="variable">cell22</span> <span class="operator">=</span> row2.createCell(<span class="number">1</span>);</span><br><span class="line">      <span class="comment">//写入数据</span></span><br><span class="line">      cell22.setCellValue(time);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//创建一个工作表 07版本使用xlsx结尾！</span></span><br><span class="line">      FileOutputStream  fileOutputStream=<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(path+<span class="string">&quot;金飞鹏07.xlsx&quot;</span>);</span><br><span class="line">      workbook.write(fileOutputStream);</span><br><span class="line">      <span class="comment">//关闭流</span></span><br><span class="line">      fileOutputStream.close();</span><br><span class="line">      System.out.println(<span class="string">&quot;excel表生成完毕&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>读</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">03版本</span><br><span class="line">public void ExcelReadtest() throws Exception &#123;</span><br><span class="line">        FileInputStream fileInputStream=new FileInputStream(path+&quot;jin-poi金飞鹏03.xls&quot;);</span><br><span class="line">        //获取工作簿</span><br><span class="line">        Workbook workbook=new HSSFWorkbook(fileInputStream);</span><br><span class="line">        //获取第一张表</span><br><span class="line">        Sheet sheetAt = workbook.getSheetAt(0);</span><br><span class="line">        //获取第一行</span><br><span class="line">        Row row = sheetAt.getRow(0);</span><br><span class="line">        //读取第一行的第一个单元格</span><br><span class="line">        Cell cell = row.getCell(6);</span><br><span class="line">        //读取数据</span><br><span class="line">        System.out.println(cell.getNumericCellValue());</span><br><span class="line">        //关闭流</span><br><span class="line">        fileInputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">07版本</span><br><span class="line">public void ExcelReadtest() throws Exception &#123;</span><br><span class="line">       FileInputStream fileInputStream=new FileInputStream(path+&quot;jin-poi金飞鹏07.xlsx&quot;);</span><br><span class="line">       //获取工作簿</span><br><span class="line">       Workbook workbook=new XSSFWorkbook(fileInputStream);</span><br><span class="line">       //获取第一张表</span><br><span class="line">       Sheet sheetAt = workbook.getSheetAt(0);</span><br><span class="line">       //获取第一行</span><br><span class="line">       Row row = sheetAt.getRow(0);</span><br><span class="line">       //读取第一行的第一个单元格</span><br><span class="line">       Cell cell = row.getCell(6);</span><br><span class="line">       //读取数据</span><br><span class="line">       System.out.println(cell.getNumericCellValue());</span><br><span class="line">       //关闭流</span><br><span class="line">       fileInputStream.close();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>读取不同的数据类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">public void ExcelReadNoTypetest() throws Exception &#123;</span><br><span class="line">    FileInputStream fileInputStream=new FileInputStream(path+&quot;会员消费商品明细表.xls&quot;);</span><br><span class="line">    //创建一个工作簿。使用excel能操作的这边他都可以操作！</span><br><span class="line">    Workbook workbook=new HSSFWorkbook(fileInputStream);</span><br><span class="line">    //读取第一个表</span><br><span class="line">    Sheet sheetAt = workbook.getSheetAt(0);</span><br><span class="line">    //获取标题内容</span><br><span class="line">    Row rowTitle = sheetAt.getRow(0);</span><br><span class="line">    if (rowTitle!=null)&#123;</span><br><span class="line">        //一定要掌握</span><br><span class="line">        //获取一行里面有多少列</span><br><span class="line">        int cells = rowTitle.getPhysicalNumberOfCells();</span><br><span class="line">        for (int cellNum = 0; cellNum &lt; cells ; cellNum++) &#123;</span><br><span class="line">            //获取他的每一列</span><br><span class="line">            Cell cell = rowTitle.getCell(cellNum);</span><br><span class="line">            //根据列获取每一个单元格的数据</span><br><span class="line">            String cellValue = cell.getStringCellValue();</span><br><span class="line">            System.out.print(cellValue+&quot; | &quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //获取表中的内容</span><br><span class="line">    //获取总共有多少行数据</span><br><span class="line">    int rows = sheetAt.getPhysicalNumberOfRows();</span><br><span class="line">    for (int rowNum = 1; rowNum &lt;rows ; rowNum++) &#123;</span><br><span class="line">        //获取从第一行开始以后的数据</span><br><span class="line">        Row row = sheetAt.getRow(rowNum);</span><br><span class="line">        if (row!=null)&#123;</span><br><span class="line">            //获取每一行总共有多少列</span><br><span class="line">            int cells = row.getPhysicalNumberOfCells();</span><br><span class="line"></span><br><span class="line">            for (int cellNum = 0; cellNum &lt; cells ; cellNum++) &#123;</span><br><span class="line">                System.out.print(&quot;【&quot;+(rowNum+1)+&quot;-&quot;+(cellNum+1)+&quot;】&quot;);</span><br><span class="line"></span><br><span class="line">                //获取每一行里的每一个单元格</span><br><span class="line">                Cell cell = row.getCell(cellNum);</span><br><span class="line"></span><br><span class="line">                if (cell!=null)&#123;</span><br><span class="line">                    //获取每一个单元格的类型</span><br><span class="line">                    int cellType = cell.getCellType();</span><br><span class="line">                    String cellValue=&quot;&quot;;</span><br><span class="line">                    switch (cellType)&#123;</span><br><span class="line">                        case Cell.CELL_TYPE_STRING: //字符串</span><br><span class="line">                            System.out.print(&quot;[String]&quot;);</span><br><span class="line">                            cellValue = cell.getStringCellValue();</span><br><span class="line">                            break;</span><br><span class="line">                        case Cell.CELL_TYPE_BOOLEAN: //布尔</span><br><span class="line">                            System.out.print(&quot;[boolean]&quot;);</span><br><span class="line">                            cellValue = String.valueOf(cell.getBooleanCellValue());</span><br><span class="line">                            break;</span><br><span class="line">                        case Cell.CELL_TYPE_BLANK: //空</span><br><span class="line">                            System.out.print(&quot;[空]&quot;);</span><br><span class="line">                            break;</span><br><span class="line">                        case Cell.CELL_TYPE_NUMERIC: //数字（日期、普通数字）</span><br><span class="line">                            if (DateUtil.isCellDateFormatted(cell))&#123;</span><br><span class="line">                                System.out.print(&quot;[日期]&quot;);</span><br><span class="line">                                Date date = cell.getDateCellValue();</span><br><span class="line">                                cellValue = new DateTime(date).toString(&quot;yyyy-MM-dd&quot;);</span><br><span class="line">                            &#125;else &#123;</span><br><span class="line">                                //不是日期格式，防止数字过长。</span><br><span class="line">                                System.out.print(&quot;[转换为字符串]&quot;);</span><br><span class="line">                                cell.setCellType(Cell.CELL_TYPE_STRING);</span><br><span class="line">                                cellValue=cell.toString();</span><br><span class="line">                            &#125;</span><br><span class="line">                            break;</span><br><span class="line">                        case Cell.CELL_TYPE_ERROR://</span><br><span class="line">                            System.out.print(&quot;数据类型错误&quot;);</span><br><span class="line">                            break;</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.println(cellValue);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(value = &quot;地域违法数据导出Excel表格-大牌&quot;, notes = &quot;地域违法数据导出-大牌&quot;, httpMethod = &quot;POST&quot;)</span><br><span class="line">  @RequestMapping(value = &quot;regionalIllegalExport&quot;, method = &#123;RequestMethod.POST&#125;)</span><br><span class="line">  public ResponseEntity regionalIllegalExport(@ApiIgnore @Identity UserBasicPo userBasicPo, @RequestBody BiIllegalQueryForm form) &#123;</span><br><span class="line">      ResponseEntity responseEntity = biMonitorMaterialAd(userBasicPo, form);</span><br><span class="line">      List&lt;BiMonitorMaterialAdPo&gt; biMonitorMaterialAdPos = (List&lt;BiMonitorMaterialAdPo&gt;) responseEntity.getData();</span><br><span class="line">      if (CollectionUtils.isNotEmpty(biMonitorMaterialAdPos)) &#123;</span><br><span class="line">          throw new XHException(&quot;没有违法数据&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      InputStream in = null;</span><br><span class="line">      try &#123;</span><br><span class="line">          getClass().getResourceAsStream(&quot;/excel/excel_ad_area.xlsx&quot;);</span><br><span class="line">          //创建工作簿</span><br><span class="line">          XSSFWorkbook workbook = new XSSFWorkbook();</span><br><span class="line">          //创建工作表</span><br><span class="line">          Sheet sheet = workbook.getSheetAt(0);</span><br><span class="line">          //设置公式自动读取</span><br><span class="line">          sheet.setForceFormulaRecalculation(true);</span><br><span class="line">          //设置表格样式</span><br><span class="line">          XSSFCellStyle style = workbook.createCellStyle();</span><br><span class="line">          style.setBorderTop(BorderStyle.THIN);</span><br><span class="line">          style.setBorderRight(BorderStyle.THIN);</span><br><span class="line">          style.setBorderBottom(BorderStyle.THIN);</span><br><span class="line">          style.setAlignment(HorizontalAlignment.CENTER);</span><br><span class="line">          style.setBorderLeft(BorderStyle.TH);</span><br><span class="line">          //第三行</span><br><span class="line">          int rowNum = 2;</span><br><span class="line">          //排名</span><br><span class="line">          int topNum = 1;</span><br><span class="line">          for (BiMonitorMaterialAdPo biMonitorMaterialAdPo : biMonitorMaterialAdPos) &#123;</span><br><span class="line">              Row row = sheet.createRow(rowNum);</span><br><span class="line">              //1行1列：排名</span><br><span class="line">              Cell cell = row.createCell(0);</span><br><span class="line">              cell.setCellValue(topNum);</span><br><span class="line">              //1行2列：地域</span><br><span class="line">              Cell cell1 = row.createCell(1);</span><br><span class="line">              String area = &quot;&quot;;</span><br><span class="line">              if(StringUtils.isNotEmpty(biMonitorMaterialAdPo.getDistrict()))&#123;</span><br><span class="line">                  area.concat(biMonitorMaterialAdPo.getDistrict());</span><br><span class="line">              &#125;</span><br><span class="line">              if(StringUtils.isNotEmpty(biMonitorMaterialAdPo.getCity()))&#123;</span><br><span class="line">                  area.concat(biMonitorMaterialAdPo.getCity());</span><br><span class="line">              &#125;</span><br><span class="line">              cell1.setCellValue(area);</span><br><span class="line">              //1行3列：总条数</span><br><span class="line">              Cell cell2 = row.createCell(2);</span><br><span class="line">              cell2.setCellValue(biMonitorMaterialAdPo.getTotalCount());</span><br><span class="line">              //1行4列：广告违法数量</span><br><span class="line">              Cell cell3 = row.createCell(3);</span><br><span class="line">              cell3.setCellValue(biMonitorMaterialAdPo.getIllegalCount());</span><br><span class="line">              //1行5列：条数违法比例</span><br><span class="line">              Cell cell4 = row.createCell(4);</span><br><span class="line">              if(biMonitorMaterialAdPo.getTotalCount()&lt;=0 || biMonitorMaterialAdPo.getIllegalCount()&lt;=0)&#123;</span><br><span class="line">                  cell4.setCellValue(&quot;0%&quot;);</span><br><span class="line">              &#125;else&#123;</span><br><span class="line">                  DecimalFormat decimalFormat = new DecimalFormat(&quot;#.00&quot;);</span><br><span class="line">                  Long illegalParalel = biMonitorMaterialAdPo.getIllegalCount() / biMonitorMaterialAdPo.getTotalCount();</span><br><span class="line">                  cell4.setCellValue(decimalFormat.format(illegalParalel));</span><br><span class="line">              &#125;</span><br><span class="line">              //1行6列：总条次</span><br><span class="line">              Cell cell5 = row.createCell(5);</span><br><span class="line">              cell5.setCellValue(0);</span><br><span class="line">              //1行7列：违法条次</span><br><span class="line">              Cell cell6 = row.createCell(6);</span><br><span class="line">              cell6.setCellValue(0);</span><br><span class="line">              //1行8列：条次违法率</span><br><span class="line">              Cell cell7 = row.createCell(7);</span><br><span class="line">              cell7.setCellValue(&quot;0%&quot;);</span><br><span class="line">              //1行9列：总时长</span><br><span class="line">              Cell cell8 = row.createCell(8);</span><br><span class="line">              cell8.setCellValue(0);</span><br><span class="line">              //1行10列：违法时长</span><br><span class="line">              Cell cell9 = row.createCell(9);</span><br><span class="line">              cell9.setCellValue(0);</span><br><span class="line">              //1行11列：时长违法率</span><br><span class="line">              Cell cell10 = row.createCell(10);</span><br><span class="line">              cell10.setCellValue(&quot;0%&quot;);</span><br><span class="line">              //1行12列：违法线索处理率</span><br><span class="line">              Cell cell11 = row.createCell(11);</span><br><span class="line">              cell1.setCellValue(biMonitorMaterialAdPo.getReviewCount());</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; finally&#123;</span><br><span class="line">          try &#123;</span><br><span class="line">              if (null != in) &#123;</span><br><span class="line">                  in.close();</span><br><span class="line">              &#125;</span><br><span class="line">          &#125; catch (IOException eClose) &#123;</span><br><span class="line">              logger.error(&quot;导出异常，原因：&#123;&#125;&quot;, eClose.getMessage(), eClose);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      return null;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<p>easyExcel 官网地址：<a target="_blank" rel="noopener" href="https://github.com/alibaba/easyexcel">https://github.com/alibaba/easyexcel</a></p>
<p>官方文档：<a target="_blank" rel="noopener" href="https://www.yuque.com/easyexcel/doc/easyexcel">https://www.yuque.com/easyexcel/doc/easyexcel</a>	</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 读取要导出到的模板</span></span><br><span class="line">            in = <span class="built_in">this</span>.getClass().getResourceAsStream(<span class="string">&quot;/excel/excel_area.xlsx&quot;</span>);</span><br><span class="line">            <span class="comment">// 创建工作蒲</span></span><br><span class="line">            <span class="type">XSSFWorkbook</span> <span class="variable">workbook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>(in);</span><br><span class="line">            <span class="comment">// 创建表</span></span><br><span class="line">            <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> workbook.getSheetAt(<span class="number">0</span>);</span><br><span class="line">            <span class="comment">// 设置公式自动读取</span></span><br><span class="line">            sheet.setForceFormulaRecalculation(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">XSSFCellStyle</span> <span class="variable">style</span> <span class="operator">=</span> workbook.createCellStyle();</span><br><span class="line">            style.setBorderTop(BorderStyle.THIN);</span><br><span class="line">            style.setBorderRight(BorderStyle.THIN);</span><br><span class="line">            style.setBorderBottom(BorderStyle.THIN);</span><br><span class="line">            style.setAlignment(HorizontalAlignment.CENTER);</span><br><span class="line">            style.setBorderLeft(BorderStyle.THIN);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 从第3行开始</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">rowNum</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">            <span class="comment">// 地区排行下标</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">topNum</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (BiAreaVO vo : voList) &#123;</span><br><span class="line">                <span class="type">Row</span> <span class="variable">row</span> <span class="operator">=</span> sheet.createRow(rowNum);</span><br><span class="line"></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell0</span> <span class="operator">=</span> row.createCell(<span class="number">0</span>);</span><br><span class="line">                cell0.setCellValue(topNum);</span><br><span class="line"></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell1</span> <span class="operator">=</span> row.createCell(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.isNotBlank(vo.getDistrict())) &#123;</span><br><span class="line">                    cell1.setCellValue(vo.getDistrict());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    cell1.setCellValue(vo.getCity());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell2</span> <span class="operator">=</span> row.createCell(<span class="number">2</span>);</span><br><span class="line">                cell2.setCellValue(vo.getTotalCount());</span><br><span class="line"></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell3</span> <span class="operator">=</span> row.createCell(<span class="number">3</span>);</span><br><span class="line">                cell3.setCellValue(vo.getIllegalCount());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 条数违法率</span></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell4</span> <span class="operator">=</span> row.createCell(<span class="number">4</span>);</span><br><span class="line">                <span class="keyword">if</span> (vo.getTotalCount() &lt;= <span class="number">0</span> || vo.getIllegalCount() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    cell4.setCellValue(<span class="string">&quot;0%&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">BigDecimal</span> <span class="variable">tcPercentage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(vo.getIllegalCount())</span><br><span class="line">                            .divide(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(vo.getTotalCount()), <span class="number">5</span>, BigDecimal.ROUND_HALF_UP)</span><br><span class="line">                            .multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>));</span><br><span class="line">                    cell4.setCellValue(tcPercentage.setScale(<span class="number">2</span>, BigDecimal.ROUND_HALF_UP).toString() + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell5</span> <span class="operator">=</span> row.createCell(<span class="number">5</span>);</span><br><span class="line">                cell5.setCellValue(vo.getTotalPlayCount());</span><br><span class="line"></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell6</span> <span class="operator">=</span> row.createCell(<span class="number">6</span>);</span><br><span class="line">                cell6.setCellValue(vo.getIllegalPlayCount());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 时长占比</span></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell7</span> <span class="operator">=</span> row.createCell(<span class="number">7</span>);</span><br><span class="line">                <span class="keyword">if</span> (vo.getTotalPlayCount() &lt;= <span class="number">0</span> || vo.getIllegalPlayCount() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    cell7.setCellValue(<span class="number">0</span> + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">BigDecimal</span> <span class="variable">scPercentage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(vo.getIllegalPlayCount())</span><br><span class="line">                            .divide(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(vo.getTotalPlayCount()), <span class="number">5</span>, BigDecimal.ROUND_HALF_UP)</span><br><span class="line">                            .multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>));</span><br><span class="line">                    cell7.setCellValue(scPercentage.setScale(<span class="number">2</span>, BigDecimal.ROUND_HALF_UP).toString() + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell8</span> <span class="operator">=</span> row.createCell(<span class="number">8</span>);</span><br><span class="line">                cell8.setCellValue(vo.getTotalSecond());</span><br><span class="line"></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell9</span> <span class="operator">=</span> row.createCell(<span class="number">9</span>);</span><br><span class="line">                cell9.setCellValue(vo.getIllegalSecond());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 时长占比</span></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell10</span> <span class="operator">=</span> row.createCell(<span class="number">10</span>);</span><br><span class="line">                <span class="keyword">if</span> (vo.getTotalSecond() &lt;= <span class="number">0</span> || vo.getIllegalSecond() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    cell10.setCellValue(<span class="number">0</span> + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">BigDecimal</span> <span class="variable">scPercentage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(vo.getIllegalSecond())</span><br><span class="line">                            .divide(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(vo.getTotalSecond()), <span class="number">5</span>, BigDecimal.ROUND_HALF_UP)</span><br><span class="line">                            .multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>));</span><br><span class="line">                    cell10.setCellValue(scPercentage.setScale(<span class="number">2</span>, BigDecimal.ROUND_HALF_UP).toString() + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 违法线索处理率</span></span><br><span class="line">                <span class="type">Cell</span> <span class="variable">cell11</span> <span class="operator">=</span> row.createCell(<span class="number">11</span>);</span><br><span class="line">                <span class="keyword">if</span> (vo.getHandleReviewCount() &lt;= <span class="number">0</span> || vo.getReviewCount() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    cell11.setCellValue(<span class="number">0</span> + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">BigDecimal</span> <span class="variable">illegalRate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(vo.getHandleReviewCount())</span><br><span class="line">                            .divide(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(vo.getReviewCount()), <span class="number">5</span>, BigDecimal.ROUND_HALF_UP)</span><br><span class="line">                            .multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>));</span><br><span class="line">                    <span class="keyword">if</span> (illegalRate.compareTo(BigDecimal.valueOf(<span class="number">100</span>)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        illegalRate = BigDecimal.valueOf(<span class="number">100</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    cell11.setCellValue(illegalRate.setScale(<span class="number">2</span>, BigDecimal.ROUND_HALF_UP).toString() + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                rowNum++;</span><br><span class="line">                topNum++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> exportExcel(workbook);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;导出异常，原因：&#123;&#125;&quot;</span>, e.getMessage(), e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">XHException</span>(<span class="string">&quot;导出失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> != in) &#123;</span><br><span class="line">                    in.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException eClose) &#123;</span><br><span class="line">                logger.error(<span class="string">&quot;导出异常，原因：&#123;&#125;&quot;</span>, eClose.getMessage(), eClose);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>



<h1 id="读取word文档"><a href="#读取word文档" class="headerlink" title="读取word文档"></a>读取word文档</h1><h2 id="1、依赖"><a href="#1、依赖" class="headerlink" title="1、依赖"></a>1、依赖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- poi --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;poi&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.2.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.2.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;poi-scratchpad&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.2.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;ooxml-schemas&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>



<h2 id="2-代码演义"><a href="#2-代码演义" class="headerlink" title="2.代码演义"></a>2.代码演义</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">WordUtil</span> <span class="variable">wordUtil</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WordUtil</span>();</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 解析docx</span></span><br><span class="line">            <span class="type">XWPFDocument</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XWPFDocument</span>(WordUtil.class.getResourceAsStream(<span class="string">&quot;/word/led_contract.docx&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 解析并替换文本</span></span><br><span class="line">            Map&lt;String, Object&gt; testMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            testMap.put(<span class="string">&quot;file_name_str&quot;</span>, <span class="string">&quot;文件名1.jpg；文件名1.jpg；文件名1.jpg；文件名1.jpg；文件名1.jpg；文件名1.jpg；文件名1.jpg；文件名1.jpg；文件名1.jpg；文件名1.jpg；&quot;</span>);</span><br><span class="line">            testMap.put(<span class="string">&quot;media_count&quot;</span>, <span class="number">3</span>);</span><br><span class="line">            wordUtil.changeText(document, testMap);</span><br><span class="line">	</span><br><span class="line">            <span class="comment">// 解析并插入表格</span></span><br><span class="line">            List&lt;String[]&gt; testList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            testList.add(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;6&quot;</span>, <span class="string">&quot;7&quot;</span>, <span class="string">&quot;8&quot;</span>, <span class="string">&quot;9&quot;</span>, <span class="string">&quot;10&quot;</span>, <span class="string">&quot;11&quot;</span>&#125;);</span><br><span class="line">            testList.add(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;11&quot;</span>, <span class="string">&quot;12&quot;</span>, <span class="string">&quot;13&quot;</span>, <span class="string">&quot;14&quot;</span>, <span class="string">&quot;15&quot;</span>, <span class="string">&quot;16&quot;</span>, <span class="string">&quot;17&quot;</span>, <span class="string">&quot;18&quot;</span>, <span class="string">&quot;19&quot;</span>, <span class="string">&quot;110&quot;</span>, <span class="string">&quot;111&quot;</span>&#125;);</span><br><span class="line">            testList.add(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;11&quot;</span>, <span class="string">&quot;12&quot;</span>, <span class="string">&quot;13&quot;</span>, <span class="string">&quot;14&quot;</span>, <span class="string">&quot;15&quot;</span>, <span class="string">&quot;16&quot;</span>, <span class="string">&quot;17&quot;</span>, <span class="string">&quot;18&quot;</span>, <span class="string">&quot;19&quot;</span>, <span class="string">&quot;110&quot;</span>, <span class="string">&quot;111&quot;</span>&#125;);</span><br><span class="line">            testList.add(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;11&quot;</span>, <span class="string">&quot;12&quot;</span>, <span class="string">&quot;13&quot;</span>, <span class="string">&quot;14&quot;</span>, <span class="string">&quot;15&quot;</span>, <span class="string">&quot;16&quot;</span>, <span class="string">&quot;17&quot;</span>, <span class="string">&quot;18&quot;</span>, <span class="string">&quot;19&quot;</span>, <span class="string">&quot;110&quot;</span>, <span class="string">&quot;111&quot;</span>&#125;);</span><br><span class="line">            testList.add(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;11&quot;</span>, <span class="string">&quot;12&quot;</span>, <span class="string">&quot;13&quot;</span>, <span class="string">&quot;14&quot;</span>, <span class="string">&quot;15&quot;</span>, <span class="string">&quot;16&quot;</span>, <span class="string">&quot;17&quot;</span>, <span class="string">&quot;18&quot;</span>, <span class="string">&quot;19&quot;</span>, <span class="string">&quot;110&quot;</span>, <span class="string">&quot;111&quot;</span>&#125;);</span><br><span class="line">            testList.add(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;11&quot;</span>, <span class="string">&quot;12&quot;</span>, <span class="string">&quot;13&quot;</span>, <span class="string">&quot;14&quot;</span>, <span class="string">&quot;15&quot;</span>, <span class="string">&quot;16&quot;</span>, <span class="string">&quot;17&quot;</span>, <span class="string">&quot;18&quot;</span>, <span class="string">&quot;19&quot;</span>, <span class="string">&quot;110&quot;</span>, <span class="string">&quot;111&quot;</span>&#125;);</span><br><span class="line">            wordUtil.insertTable(document, testList);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 生成新的word</span></span><br><span class="line">            stream = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\out.docx&quot;</span>));</span><br><span class="line">            document.write(stream);</span><br><span class="line">            stream.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> != stream) &#123;</span><br><span class="line">                    stream.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 替换段落文本</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> document docx解析对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> textMap  需要替换的信息集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeText</span><span class="params">(XWPFDocument document, Map&lt;String, Object&gt; textMap)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取段落集合</span></span><br><span class="line">        List&lt;XWPFParagraph&gt; paragraphs = document.getParagraphs();</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtil.isNotEmpty(paragraphs)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (XWPFParagraph paragraph : paragraphs) &#123;</span><br><span class="line">                <span class="comment">//判断此段落时候需要进行替换</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> paragraph.getText();</span><br><span class="line">                <span class="keyword">if</span> (checkText(text)) &#123;</span><br><span class="line">                    List&lt;XWPFRun&gt; runs = paragraph.getRuns();</span><br><span class="line">                    <span class="keyword">for</span> (XWPFRun run : runs) &#123;</span><br><span class="line">                        <span class="comment">// 替换模板原来位置</span></span><br><span class="line">                        run.setText(changeValue(run.toString(), textMap), <span class="number">0</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入表格对象方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> document  docx解析对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableList 需要插入的表格信息集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertTable</span><span class="params">(XWPFDocument document, List&lt;String[]&gt; tableList)</span> &#123;</span><br><span class="line">        <span class="comment">// 表格对象集合</span></span><br><span class="line">        List&lt;XWPFTable&gt; tables = document.getTables();</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtil.isNotEmpty(tables)) &#123;</span><br><span class="line">            <span class="comment">// 获取第一个表格</span></span><br><span class="line">            <span class="type">XWPFTable</span> <span class="variable">table</span> <span class="operator">=</span> tables.get(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">for</span> (String[] str : tableList) &#123;</span><br><span class="line">                <span class="type">XWPFTableRow</span> <span class="variable">newRow</span> <span class="operator">=</span> table.createRow();</span><br><span class="line">                List&lt;XWPFTableCell&gt; cells = newRow.getTableCells();</span><br><span class="line">                <span class="comment">// 渲染每一列</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">                    <span class="type">XWPFTableCell</span> <span class="variable">cell</span> <span class="operator">=</span> cells.get(i);</span><br><span class="line">                    cell.setText(str[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 替换文本</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value   word文本</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> textMap 替换数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 替换的文本</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">changeValue</span><span class="params">(String value, Map&lt;String, Object&gt; textMap)</span> &#123;</span><br><span class="line">        Set&lt;Map.Entry&lt;String, Object&gt;&gt; textSets = textMap.entrySet();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; textSet : textSets) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value.indexOf(<span class="string">&quot;$&#123;&quot;</span>.concat(textSet.getKey()).concat(<span class="string">&quot;&#125;&quot;</span>)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> String.valueOf(textSet.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (checkText(value)) &#123;</span><br><span class="line">            value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断文本中时候包含$</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text 文本</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true：包含：false：不包含</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkText</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> text.indexOf(<span class="string">&quot;$&quot;</span>) != -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;signatories&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;tenantType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PERSONAL&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;sponsor&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;receiver&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;contactType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MOBILE&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;contact&quot;</span><span class="punctuation">:</span> <span class="string">&quot;19958814235&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;serialNo&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;tenantName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;陈科&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;delaySet&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3077267595204760210&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DRAFT&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;creator&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenApi&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;subject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;V2合同&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;expireTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-04-24 23:22:47&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;tenantName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;湖南星华信息科技有限公司&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3077267594298790544&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;sn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;60779889-41b7-4f7b-8d7b-df81cd27146c&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;广告交易合同&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3065544662254157969&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;ordinal&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DRAFT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">//        String authTime = String.valueOf(new DateTime().getTime());</span><br><span class="line">//</span><br><span class="line">//        ContractDraftRequestDTO contractDraftRequestDTO = new ContractDraftRequestDTO();</span><br><span class="line">//        contractDraftRequestDTO.setSn(UUID.randomUUID().toString());</span><br><span class="line">//        contractDraftRequestDTO.setSubject(&quot;V2合同&quot;);</span><br><span class="line">//        contractDraftRequestDTO.setSend(false);</span><br><span class="line">//        List&lt;ContractDraftListDTO&gt; contractDraftListDTOS = new ArrayList&lt;&gt;();</span><br><span class="line">//</span><br><span class="line">//        ContractDraftListDTO contractDraftListDTO = new ContractDraftListDTO();</span><br><span class="line">//        Integer authenticationType = 1;</span><br><span class="line">//        if (GlobalConstants.Contract.AuthType.PERSON.equals(authenticationType)) &#123;</span><br><span class="line">//            contractDraftListDTO.setTenantType(&quot;PERSONAL&quot;);</span><br><span class="line">//            contractDraftListDTO.setTenantName(&quot;陈科&quot;);</span><br><span class="line">//</span><br><span class="line">//        &#125; else if (GlobalConstants.Contract.AuthType.COMPANY.equals(authenticationType)) &#123;</span><br><span class="line">//            // 公司签署合同</span><br><span class="line">//            contractDraftListDTO.setTenantType(&quot;COMPANY&quot;);</span><br><span class="line">//            contractDraftListDTO.setTenantName(&quot;lizhien&quot;);</span><br><span class="line">//        &#125;</span><br><span class="line">//</span><br><span class="line">//        ContractDraftReceiverDTO contractDraftReceiverDTO = new ContractDraftReceiverDTO();</span><br><span class="line">//        contractDraftReceiverDTO.setName(&quot;陈科&quot;);</span><br><span class="line">//        contractDraftReceiverDTO.setContact(&quot;19958814235&quot;);</span><br><span class="line">//        contractDraftReceiverDTO.setContactType(&quot;MOBILE&quot;);</span><br><span class="line">//        contractDraftListDTO.setReceiver(contractDraftReceiverDTO);</span><br><span class="line">//</span><br><span class="line">//        contractDraftListDTOS.add(contractDraftListDTO);</span><br><span class="line">//        contractDraftRequestDTO.setSignatories(contractDraftListDTOS);</span><br><span class="line">//</span><br><span class="line">//        // 签署动作（签署流程）</span><br><span class="line">//        List&lt;ContractDraftActionsDTO&gt; contractDraftActionsDTOS = new ArrayList&lt;&gt;();</span><br><span class="line">//        ContractDraftActionsDTO contractDraftRequest = new ContractDraftActionsDTO();</span><br><span class="line">//        contractDraftRequest.setType(&quot;PERSONAL&quot;);</span><br><span class="line">//        contractDraftActionsDTOS.add(contractDraftRequest);</span><br><span class="line">//        contractDraftListDTO.setActions(contractDraftActionsDTOS);</span><br><span class="line">//        //发起请求</span><br><span class="line">//        CloseableHttpClient httpClient = HttpClients.createDefault();</span><br><span class="line">//        HttpPost httpPost = httpPostParams(authTime, JSONUtil.toJsonStr(contractDraftRequestDTO));</span><br><span class="line">//        try &#123;</span><br><span class="line">//            CloseableHttpResponse response = httpClient.execute(httpPost);</span><br><span class="line">//            HttpEntity entity = response.getEntity();</span><br><span class="line">//            if (ObjectUtils.isEmpty(entity)) &#123;</span><br><span class="line">//                log.error(&quot;发送创建合同草稿请求出现错误&quot;);</span><br><span class="line">//                throw new BusinessException(&quot;发送创建合同草稿请求出现错误&quot;);</span><br><span class="line">//            &#125;</span><br><span class="line">//            String result = EntityUtils.toString(entity);</span><br><span class="line">//            ContractDraftResponse contractDraftResponse = JSONUtil.toBean(result, ContractDraftResponse.class);</span><br><span class="line">//            System.out.println(JSONUtil.toJsonStr(&quot;aaaaaaaaaaaa========&gt;&quot;+contractDraftResponse));</span><br><span class="line">//        &#125; catch (IOException e) &#123;</span><br><span class="line">//            e.printStackTrace();</span><br><span class="line">//        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//        Date date = new Date();</span><br><span class="line">//        String authTime = String.valueOf(date.getTime());</span><br><span class="line">//        String contractId = &quot;3065544662254157969&quot;;</span><br><span class="line">//        String tenantName = &quot;湖南星华信息科技有限公司&quot;;</span><br><span class="line">//        DocumentContractSend documentContractSend = new DocumentContractSend();</span><br><span class="line">//        documentContractSend.setContractId(contractId);</span><br><span class="line">//        documentContractSend.setTenantName(tenantName);</span><br><span class="line">//        CloseableHttpClient httpClient = HttpClients.createDefault();</span><br><span class="line">//        HttpPost httpPost = httpPostParams(authTime, &quot;/v2/contract/send&quot;, JSONUtil.toJsonStr(documentContractSend));</span><br><span class="line">//        try &#123;</span><br><span class="line">//            CloseableHttpResponse execute = httpClient.execute(httpPost);</span><br><span class="line">//            HttpEntity entity = execute.getEntity();</span><br><span class="line">//            if (ObjectUtils.isEmpty(entity)) &#123;</span><br><span class="line">//                throw new BusinessException(&quot;发起合同请求失败&quot;);</span><br><span class="line">//            &#125;</span><br><span class="line">//            Map&lt;String, Object&gt; resultMap = JSON.parseObject(JSON.toJSONString(entity), Map.class);</span><br><span class="line">//            System.out.println(resultMap);</span><br><span class="line">//        &#125; catch (IOException e) &#123;</span><br><span class="line">//            e.printStackTrace();</span><br><span class="line">//        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String authTime = String.valueOf(new DateTime().getTime());</span><br><span class="line">        String s = httpGetParams(authTime);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static HttpPost httpPostParams(String authTime, String params) &#123;</span><br><span class="line">        HttpPost httpPost = new HttpPost(&quot;https://openapi.qiyuesuo.cn/v2/contract/draft&quot;);</span><br><span class="line">        // 即AppToken 和 AppSecret 和 时间戳 和 nonce 拼接的字符串的MD5值</span><br><span class="line">        String nonce = UUID.randomUUID().toString();</span><br><span class="line">        String signature = MD5Util.encode(&quot;QV9NZjDmUr&quot; + &quot;QsB4Um8zg8W08iAtoGPip67O1d2XOm&quot; + authTime + nonce, &quot;UTF-8&quot;);</span><br><span class="line">        httpPost.addHeader(&quot;x-qys-open-signature&quot;, signature);</span><br><span class="line">        httpPost.addHeader(&quot;x-qys-open-accesstoken&quot;, &quot;QV9NZjDmUr&quot;);</span><br><span class="line">        httpPost.addHeader(&quot;x-qys-open-nonce&quot;, nonce);</span><br><span class="line">        httpPost.addHeader(&quot;x-qys-open-timestamp&quot;, authTime);</span><br><span class="line">        httpPost.addHeader(&quot;content-type&quot;, &quot;application/json;charset=UTF-8&quot;);</span><br><span class="line">        HttpEntity httpEntity = new StringEntity(params, ContentType.APPLICATION_JSON);</span><br><span class="line">        httpPost.setEntity(httpEntity);</span><br><span class="line">        return httpPost;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private static HttpPost httpPostParams(String authTime, String url, String params) &#123;</span><br><span class="line">        HttpPost httpPost = new HttpPost(&quot;https://openapi.qiyuesuo.cn&quot;.concat(url));</span><br><span class="line">        // 即AppToken 和 AppSecret 和 时间戳 和 nonce 拼接的字符串的MD5值</span><br><span class="line">        String nonce = UUID.randomUUID().toString();</span><br><span class="line">        String signature = MD5Util.encode(&quot;QV9NZjDmUr&quot; + &quot;QsB4Um8zg8W08iAtoGPip67O1d2XOm&quot; + authTime + nonce, &quot;UTF-8&quot;);</span><br><span class="line">        httpPost.addHeader(&quot;x-qys-open-signature&quot;, signature);</span><br><span class="line">        httpPost.addHeader(&quot;x-qys-open-accesstoken&quot;, &quot;QV9NZjDmUr&quot;);</span><br><span class="line">        httpPost.addHeader(&quot;x-qys-open-nonce&quot;, nonce);</span><br><span class="line">        httpPost.addHeader(&quot;x-qys-open-timestamp&quot;, authTime);</span><br><span class="line">        httpPost.addHeader(&quot;content-type&quot;, &quot;application/json;charset=UTF-8&quot;);</span><br><span class="line">        HttpEntity httpEntity = new StringEntity(params, ContentType.APPLICATION_JSON);</span><br><span class="line">        httpPost.setEntity(httpEntity);</span><br><span class="line">        return httpPost;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static String httpGetParams(String authTime) &#123;</span><br><span class="line">        String requestUrl = &quot;https://openapi.qiyuesuo.cn/v2/contract/shorturl?contractId=3065544662254157969&amp;tenantName=湖南星华信息科技有限公司&quot;;</span><br><span class="line">        String nonce = UUIDUtil.getUUID();</span><br><span class="line">        String signature = MD5Util.encode(&quot;QV9NZjDmUr&quot; + &quot;QsB4Um8zg8W08iAtoGPip67O1d2XOm&quot; + authTime + nonce, &quot;UTF-8&quot;);</span><br><span class="line">        // 设置头信息</span><br><span class="line">        String authResult = HttpRequest.get(requestUrl)</span><br><span class="line">                .header(&quot;x-qys-open-signature&quot;, signature)</span><br><span class="line">                .header(&quot;x-qys-open-accesstoken&quot;, &quot;QV9NZjDmUr&quot;)</span><br><span class="line">                .header(&quot;x-qys-open-timestamp&quot;, String.valueOf(authTime))</span><br><span class="line">                .header(&quot;x-qys-open-nonce&quot;, nonce).execute().body();</span><br><span class="line">        return authResult;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h1 id="apach-、hutool、restemplate发送请求"><a href="#apach-、hutool、restemplate发送请求" class="headerlink" title="apach 、hutool、restemplate发送请求"></a>apach 、hutool、restemplate发送请求</h1><h3 id="1、使用hutool发起get请求"><a href="#1、使用hutool发起get请求" class="headerlink" title="1、使用hutool发起get请求"></a>1、使用hutool发起get请求</h3><h4 id="1-1-带有请求头"><a href="#1-1-带有请求头" class="headerlink" title="1.1 带有请求头"></a>1.1 带有请求头</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">requestUrl</span> <span class="operator">=</span> authUrl.concat(url);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(params)) &#123;</span><br><span class="line">            requestUrl = requestUrl.concat(<span class="string">&quot;?&quot;</span>).concat(params);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">nonce</span> <span class="operator">=</span> UUIDUtil.getUUID();</span><br><span class="line">        <span class="type">String</span> <span class="variable">time</span> <span class="operator">=</span> String.valueOf(System.currentTimeMillis());</span><br><span class="line">        <span class="type">String</span> <span class="variable">signature</span> <span class="operator">=</span> MD5Util.encode(appToken.concat(appSecret).concat(time).concat(nonce), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置头信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">authResult</span> <span class="operator">=</span> HttpRequest.get(requestUrl)</span><br><span class="line">                .header(<span class="string">&quot;x-qys-open-signature&quot;</span>, signature)</span><br><span class="line">                .header(<span class="string">&quot;x-qys-open-accesstoken&quot;</span>, appToken)</span><br><span class="line">                .header(<span class="string">&quot;x-qys-open-timestamp&quot;</span>, time)</span><br><span class="line">                .header(<span class="string">&quot;x-qys-open-nonce&quot;</span>, nonce).execute().body();</span><br></pre></td></tr></table></figure>

<h2 id="2-apach-请求"><a href="#2-apach-请求" class="headerlink" title="2.apach 请求"></a>2.apach 请求</h2><h3 id="1、post请求"><a href="#1、post请求" class="headerlink" title="1、post请求"></a>1、post请求</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">      <span class="type">String</span> <span class="variable">paramStr</span> <span class="operator">=</span> JSONUtil.toJsonStr(request);</span><br><span class="line"><span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(authUrl.concat(url));</span><br><span class="line">      <span class="comment">// 即AppToken 和 AppSecret 和 时间戳 和 nonce 拼接的字符串的MD5值</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">nonce</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">      <span class="type">String</span> <span class="variable">time</span> <span class="operator">=</span> String.valueOf(System.currentTimeMillis());</span><br><span class="line">      <span class="type">String</span> <span class="variable">signature</span> <span class="operator">=</span> MD5Util.encode(appToken.concat(appSecret).concat(time).concat(nonce), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">      httpPost.addHeader(<span class="string">&quot;x-qys-open-signature&quot;</span>, signature);</span><br><span class="line">      httpPost.addHeader(<span class="string">&quot;x-qys-open-accesstoken&quot;</span>, appToken);</span><br><span class="line">      httpPost.addHeader(<span class="string">&quot;x-qys-open-nonce&quot;</span>, nonce);</span><br><span class="line">      httpPost.addHeader(<span class="string">&quot;x-qys-open-timestamp&quot;</span>, time);</span><br><span class="line">      httpPost.addHeader(<span class="string">&quot;content-type&quot;</span>, <span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">      <span class="type">HttpEntity</span> <span class="variable">httpEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringEntity</span>(params, ContentType.APPLICATION_JSON);</span><br><span class="line">      httpPost.setEntity(httpEntity);</span><br><span class="line">       log.info(<span class="string">&quot;发送创建合同草稿请求，地址：/v2/contract/draft，请求参数：&#123;&#125;&quot;</span>, paramStr);</span><br><span class="line">          <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpPost);</span><br><span class="line">          <span class="type">HttpEntity</span> <span class="variable">entity</span> <span class="operator">=</span> response.getEntity();</span><br><span class="line">          <span class="keyword">if</span> (ObjectUtils.isEmpty(entity)) &#123;</span><br><span class="line">              log.error(<span class="string">&quot;发送创建合同草稿请求出现错误，请求参数：&#123;&#125;&quot;</span>, paramStr);</span><br><span class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;发送创建合同草稿请求失败&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> EntityUtils.toString(entity);</span><br><span class="line">          log.info(<span class="string">&quot;发送创建合同草稿请求完毕，响应：&#123;&#125;&quot;</span>, result);</span><br><span class="line">          ContractApiResponse&lt;ContractDraft&gt; contractApiResponse = toQysResponse(result, ContractDraft.class);</span><br><span class="line">          <span class="keyword">if</span> (contractApiResponse.getCode() == <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> contractApiResponse.getResult();</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              log.error(<span class="string">&quot;发送创建合同草稿请求，错误码：&#123;&#125;，错误信息:&#123;&#125;&quot;</span>, contractApiResponse.getCode(), contractApiResponse.getMessage());</span><br><span class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;发送创建合同草稿请求失败&quot;</span>);</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure>

<h3 id="get-请求"><a href="#get-请求" class="headerlink" title="get 请求"></a>get 请求</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * httpGet 方法的抽取</span><br><span class="line">     *</span><br><span class="line">     * @param url    请求地址</span><br><span class="line">     * @param params 获取实名认证的结果的参数</span><br><span class="line">     * @return 请求结果</span><br><span class="line">     */</span><br><span class="line">    private String httpGetParams(String url, String params) &#123;</span><br><span class="line">        String requestUrl = apiUrl.concat(url);</span><br><span class="line">        if (StringUtils.isNotBlank(params)) &#123;</span><br><span class="line">            requestUrl = requestUrl.concat(&quot;?&quot;).concat(params);</span><br><span class="line">        &#125;</span><br><span class="line">        String nonce = UUIDUtil.getUUID();</span><br><span class="line">        String time = String.valueOf(System.currentTimeMillis());</span><br><span class="line">        String signature = MD5Util.encode(appToken.concat(appSecret).concat(time).concat(nonce), &quot;UTF-8&quot;);</span><br><span class="line">        // 设置头信息</span><br><span class="line">        String authResult = HttpRequest.get(requestUrl)</span><br><span class="line">                .header(&quot;x-qys-open-signature&quot;, signature)</span><br><span class="line">                .header(&quot;x-qys-open-accesstoken&quot;, appToken)</span><br><span class="line">                .header(&quot;x-qys-open-timestamp&quot;, time)</span><br><span class="line">                .header(&quot;x-qys-open-nonce&quot;, nonce).execute().body();</span><br><span class="line">        return authResult;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 获取合同签署页面（短连接）</span><br><span class="line">     *</span><br><span class="line">     * @param contractId 合同编号</span><br><span class="line">     */</span><br><span class="line">    public ContractGetPageUrlResult getPageUrl(String contractId) &#123;</span><br><span class="line">        Assert.notBlank(contractId);</span><br><span class="line">        try &#123;</span><br><span class="line">            log.info(&quot;获取合同签署页面，地址：/v2/contract/shorturl，请求参数：&#123;&#125;&quot;, contractId);</span><br><span class="line">            String result = httpGetParams(&quot;/v2/contract/shorturl&quot;, &quot;contractId=&quot;.concat(contractId));</span><br><span class="line">            log.info(&quot;获取合同签署页面，响应：&#123;&#125;&quot;, result);</span><br><span class="line">            ContractApiResponse&lt;ContractGetPageUrlResult&gt; apiResponse = toQysResponse(result, ContractGetPageUrlResult.class);</span><br><span class="line">            if (apiResponse.getCode() == 0) &#123;</span><br><span class="line">                return apiResponse.getResult();</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                log.error(&quot;获取合同签署页面失败，错误码：&#123;&#125;，错误信息:&#123;&#125;&quot;, apiResponse.getCode(), apiResponse.getMessage());</span><br><span class="line">                throw new BusinessException(&quot;获取合同签署页面请求失败&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;获取合同签署页面失败，原因：&#123;&#125;&quot;, e.getMessage(), e);</span><br><span class="line">            throw new BusinessException(&quot;获取合同签署页面请求失败&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h1 id="minio"><a href="#minio" class="headerlink" title="minio"></a>minio</h1><h2 id="1、拉取镜像"><a href="#1、拉取镜像" class="headerlink" title="1、拉取镜像"></a>1、拉取镜像</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull minio/minio</span><br></pre></td></tr></table></figure>

<h2 id="2、创建容器"><a href="#2、创建容器" class="headerlink" title="2、创建容器"></a>2、创建容器</h2><h4 id="2-1-单机版部署"><a href="#2-1-单机版部署" class="headerlink" title="2.1 单机版部署"></a>2.1 单机版部署</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name minio   -p 9000:9000  -p 50000:50000 -d  --name minio    -v ~/minio/data:/data    -e &quot;MINIO_ROOT_USER=admin&quot;    -e &quot;MINIO_ROOT_PASSWORD=admin123&quot;    minio/minio server --console-address &quot;:50000&quot; /data</span><br></pre></td></tr></table></figure>

<h3 id="2-2-采用纠删码模式"><a href="#2-2-采用纠删码模式" class="headerlink" title="2.2 采用纠删码模式"></a>2.2 采用纠删码模式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9000:9000 -p 50000:50000 --name minio \</span><br><span class="line">-v /mnt/data1/:/data1 \</span><br><span class="line">-v /mnt/data2/:/data2 \</span><br><span class="line">-v /mnt/data3/:/data3 \</span><br><span class="line">-v /mnt/data4/:/data4 \</span><br><span class="line">-v /mnt/data5/:/data5 \</span><br><span class="line">-v /mnt/data6/:/data6 \</span><br><span class="line">-v /mnt/data7/:/data7 \</span><br><span class="line">-v /mnt/data8/:/data8 \</span><br><span class="line">minio/minio server /data&#123;1...8&#125; --console-address &quot;:50000&quot;</span><br></pre></td></tr></table></figure>



<p>sdk 官网：<a target="_blank" rel="noopener" href="https://docs.min.io/docs/java-client-api-reference.html">https://docs.min.io/docs/java-client-api-reference.html</a></p>
<h1 id="k8s"><a href="#k8s" class="headerlink" title="k8s"></a>k8s</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 设置主机名</span><br><span class="line">hostnamectl set-hostname k8s-node1</span><br><span class="line">hostnamectl set-hostname k8s-master</span><br><span class="line"></span><br><span class="line"># 关闭 selinux</span><br><span class="line">sed -i &#x27;s/enforcing/disabled/&#x27; /etc/selinux/config # 永久</span><br><span class="line">setenforce 0 # 临时</span><br><span class="line"></span><br><span class="line"># 关闭 swap</span><br><span class="line">sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab</span><br><span class="line"></span><br><span class="line"># 将桥接的 IPv4 流量传递到 iptables 的链</span><br><span class="line">cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">EOF</span><br><span class="line">sysctl --system # 生效</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 添加阿里云 YUM 软件源</span><br><span class="line">cat &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt; EOF</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#安装 kubeadm， kubelet 和 kubectl</span><br><span class="line">yum install -y kubelet-1.18.0 kubeadm-1.18.0 kubectl-1.18.0</span><br><span class="line"></span><br><span class="line"># 启动kubelet</span><br><span class="line">systemctl enable --now kubelet</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240615114927172.png" class="lazyload placeholder" data-srcset="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240615114927172.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20240615114927172"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 下载镜像在三台机器上运行</span><br><span class="line"></span><br><span class="line"># 配置镜像，生成 images.sh</span><br><span class="line">sudo tee ./images.sh &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">#!/bin/bash</span><br><span class="line">images=(</span><br><span class="line">kube-apiserver:v1.20.9</span><br><span class="line">kube-proxy:v1.20.9</span><br><span class="line">kube-controller-manager:v1.20.9</span><br><span class="line">kube-scheduler:v1.20.9</span><br><span class="line">coredns:1.7.0</span><br><span class="line">etcd:3.4.13-0</span><br><span class="line">pause:3.2</span><br><span class="line">)</span><br><span class="line">for imageName in $&#123;images[@]&#125; ; do</span><br><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/$imageName</span><br><span class="line">done</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 拉取镜像</span><br><span class="line">chmod +x ./images.sh &amp;&amp; ./images.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 所有机器添加 master 域名映射，以下 IP 为 master 的 IP；</span><br><span class="line"># 访问 cluster-endpoint 即 访问 10.206.0.4</span><br><span class="line">echo &quot;10.206.0.4  cluster-endpoint&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240615140812613.png" class="lazyload placeholder" data-srcset="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240615140812613.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20240615140812613"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">安装 kubelet、kebeadm、kubectl；注意版本 （1.20.9）</span><br><span class="line"># 配置 k8s 的 yum 源地址</span><br><span class="line">cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">   http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 安装 kubelet、kubeadm、kubectl </span><br><span class="line">yum install -y kubelet-1.20.9 kubeadm-1.20.9 kubectl-1.20.9 --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line"># 启动kubelet</span><br><span class="line">systemctl enable --now kubelet</span><br><span class="line"></span><br><span class="line"># 查看 kubelet 状态：一会停止 一会运行。 这个状态是对的，kubelet 等待 kubeadm 发号指令。</span><br><span class="line">systemctl status kubelet</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 主节点初始化 （只在 master 服务器执行， 其他 node 不用）</span><br><span class="line"># --apiserver-advertise-address: master 的 IP</span><br><span class="line"># --control-plane-endpoint: master 的域名</span><br><span class="line"># --service-cidr 和 --pod-network-cidr 是网络范围， 建议不要改。要改的话 2 个cidr 和 vps（172.31.x.x） 的，3 个网络互相不能重叠；还要修改 calico.yaml的 IP（下图有写）。</span><br><span class="line">kubeadm init \</span><br><span class="line">--apiserver-advertise-address=10.206.0.4 \</span><br><span class="line">--control-plane-endpoint=cluster-endpoint \</span><br><span class="line">--image-repository registry.cn-hangzhou.aliyuncs.com/google_containers \</span><br><span class="line">--kubernetes-version v1.20.9 \</span><br><span class="line">--service-cidr=10.96.0.0/16 \</span><br><span class="line">--pod-network-cidr=192.168.0.0/16</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubeadm init \</span><br><span class="line">--apiserver-advertise-address=10.206.0.4 \</span><br><span class="line">--control-plane-endpoint=cluster-endpoint \</span><br><span class="line">--image-repository registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images \</span><br><span class="line">--kubernetes-version v1.20.9 \</span><br><span class="line">--service-cidr=10.96.0.0/16 \</span><br><span class="line">--pod-network-cidr=192.168.0.0/16</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240615154441920.png" class="lazyload placeholder" data-srcset="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240615154441920.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20240615154441920"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[control-plane] Using manifest folder &quot;/etc/kubernetes/manifests&quot;</span><br><span class="line">[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;</span><br><span class="line">[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;</span><br><span class="line">[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;</span><br><span class="line">[etcd] Creating static Pod manifest for local etcd in &quot;/etc/kubernetes/manifests&quot;</span><br><span class="line">[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;/etc/kubernetes/manifests&quot;. This can take up to 4m0s</span><br><span class="line">[apiclient] All control plane components are healthy after 13.501831 seconds</span><br><span class="line">[upload-config] Storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace</span><br><span class="line">[kubelet] Creating a ConfigMap &quot;kubelet-config-1.20&quot; in namespace kube-system with the configuration for the kubelets in the cluster</span><br><span class="line">[upload-certs] Skipping phase. Please see --upload-certs</span><br><span class="line">[mark-control-plane] Marking the node k8s-master as control-plane by adding the labels &quot;node-role.kubernetes.io/master=&#x27;&#x27;&quot; and &quot;node-role.kubernetes.io/control-plane=&#x27;&#x27; (deprecated)&quot;</span><br><span class="line">[mark-control-plane] Marking the node k8s-master as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]</span><br><span class="line">[bootstrap-token] Using token: 090eie.eoi83ubs3bm57ehz</span><br><span class="line">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster</span><br><span class="line">[bootstrap-token] Creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace</span><br><span class="line">[kubelet-finalize] Updating &quot;/etc/kubernetes/kubelet.conf&quot; to point to a rotatable kubelet client certificate and key</span><br><span class="line">[addons] Applied essential addon: CoreDNS</span><br><span class="line">[addons] Applied essential addon: kube-proxy</span><br><span class="line"></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  mkdir -p $HOME/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"></span><br><span class="line">Alternatively, if you are the root user, you can run:</span><br><span class="line"></span><br><span class="line">  export KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">You can now join any number of control-plane nodes by copying certificate authorities</span><br><span class="line">and service account keys on each node and then running the following as root:</span><br><span class="line"></span><br><span class="line">  kubeadm join cluster-endpoint:6443 --token 090eie.eoi83ubs3bm57ehz \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:218429dec9eb867ad6d08032632e55bb623daac2433bd33140dcb4fce2517f8f \</span><br><span class="line">    --control-plane </span><br><span class="line"></span><br><span class="line">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm join cluster-endpoint:6443 --token 090eie.eoi83ubs3bm57ehz \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:218429dec9eb867ad6d08032632e55bb623daac2433bd33140dcb4fce2517f8f</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试是否成功</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line">live/live/buyLiveZyTime</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240615155354547.png" class="lazyload placeholder" data-srcset="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240615155354547.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20240615155354547"></p>

      </div>
      <div class="post-tags-categories">
        
      </div>
      
        <div class="copyright">
  <ul class="post-copyright">
    <li class="post-copyright-author">
    <strong>author:  </strong>John Doe</a>
    </li>
    <li class="post-copyright-link">
    <strong>link:  </strong>
    <a href="/2025/05/08/study/框架整合/" target="_blank" title="框架整合">https://chenjin111.github.io/2025/05/08/study/框架整合/</a>
    </li>
    <li class="post-copyright-license">
      <strong>Copyright notice:   </strong>
      All articles on this website, unless otherwise stated, adopt <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
      reprint policy. If reproduced, please indicate source!
    </li>
  </ul>
<div>
      
    </article>
    <!-- 上一篇文章和下一篇文章 -->
    
      <!-- 文章详情页的上一页和下一页 -->
<div class="post-nav">



  
  <div class="post-nav-prev post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="https://pic3.zhimg.com/80/v2-7cfc909ebe8d83683909846edd6b5232_1440w.webp" class="lazyload placeholder" data-srcset="https://pic3.zhimg.com/80/v2-7cfc909ebe8d83683909846edd6b5232_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
    </div>
    <a href="/2025/05/08/study/%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="post-nav-link">
      <div class="title">
        <i class="fas fa-angle-left"></i> Prev:
        <div class="title-text">服务器文档</div>
      </div>
      
      <!-- <div class="content">
        一、公共组件安装1.安装docker123yum install -y yum-utils \           de
      </div> -->
    </a>
  </div>



  
  <div class="post-nav-next post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="https://pica.zhimg.com/80/v2-573ac3e25de03fad9c32add5a05e5cfc_1440w.webp" class="lazyload placeholder" data-srcset="https://pica.zhimg.com/80/v2-573ac3e25de03fad9c32add5a05e5cfc_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" src="" alt="">
    </div>
    <a href="/2025/05/08/study/%E8%8A%8B%E9%81%93/" class="post-nav-link">
      <div class="title">
        Next: <i class="fas fa-angle-right"></i>
        <div class="title-text">芋道破解文件</div>
      </div>
      <!-- <div class="content">
        
https://www.iocoder.cn/XXL-JOB/install/?qun访问这个时把这个js文件屏蔽掉

      </div> -->
    </a>
  </div>

</div>

    
    

    <!-- 打赏 -->
    
      <div id="appDonate" class="post-donate">
  <div id="donate_board" class="donate_bar center" ref="donate">
    <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏" @click="showDialogDrawer()"></a>
  </div>
  <transition name="fade">
    <div 
      class="donate-box-mask"
      v-cloak 
      v-show="visible"
      @click="cancelDialogDrawer()"
    >
    </div>
  </transition>
  <transition name="bounce">
    <div class="donate-box" v-cloak v-show="visible">
      <div class="donate-box_close">
        <i class="fas fa-times" aria-hidden="true" @click="cancelDialogDrawer" pointer></i>
      </div>
      <div class="donate-box_title">
        <h4>
          你的赏识是我前进的动力
        </h4>
      </div>
      <div class="donate-box_tab">
        <div class="Alipay" pointer :class="{'active': tabActive === 'Alipay'}" @click="changeTabActive('Alipay')">
          支付宝
        </div>
        <div class="WeChatpay" pointer :class="{'active': tabActive === 'WeChatpay'}" @click="changeTabActive('WeChatpay')">
          微信
        </div>
      </div>
      <div class="donate-box_img">
        <div class="AlipayImg" v-show="tabActive === 'Alipay'">
          <img src="https://pica.zhimg.com/80/v2-61f99f8dcf899f54cad2a1aa28b21e44_1440w.webp" class="lazyload placeholder" data-srcset="https://pica.zhimg.com/80/v2-61f99f8dcf899f54cad2a1aa28b21e44_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="支付宝打赏" />
        </div> 
        <div class="WeChatpayImg" v-show="tabActive === 'WeChatpay'">
          <img src="https://pic2.zhimg.com/80/v2-29e78b52051ce542adf6d786d61fbd19_1440w.webp" class="lazyload placeholder" data-srcset="https://pic2.zhimg.com/80/v2-29e78b52051ce542adf6d786d61fbd19_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="微信打赏" />
        </div>
      </div>
    </div>
  </transition>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDonate',
    data: {
      visible: false,
      tabActive: 'Alipay',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        // function getScroll() {
        //   return {
        //     left: window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0,
        //     top: window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0
        //   };
        // }
        this.top = $(document).scrollTop() // or getScroll().top
        // console.log('aa', $('.main-content'));
        body.style.cssText = 'overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
      changeTabActive(name) {
        this.tabActive = name;
      }
    },
    created() {}
  })
</script>
    

    <!-- 分享 -->
    
      <!-- https://github.com/overtrue/share.js -->
<!-- 文章详情页的分享 -->
<div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>

<script defer src="/js/shareJs/social-share.min.js"></script>
</script>

<style>
  .social-share {
    margin: 20px 0;
  }
</style>


    
    
    <!-- 评论 -->
    <!-- 评论 -->

  <div id="myComment">
    
      <div id="gitment-container"></div>

    
  </div>


<!-- 还需要在后面这个地址里设置script, comment script in themes\hexo-theme-bamboo\layout\_partial\scripts\index.ejs -->


  </div>

  <!-- 目录 -->
  <aside id='l_side'>
  
    
      <section class="widget side_blogger">
  <div class='content'>
    
      
        <a class='avatar flat-box rectangle' href='/about/'>
          <img src='https://pic2.zhimg.com/80/v2-42b72d5ebee4b8d8aa70d9687effe87b_1440w.webp'/>
        </a>
      
    
    
      <div class='text'>
        
          <h2>尘瑾</h2>
        
        
          <p>加油少年！！！！</p>

        
        
          <p><span id="jinrishici-sentence">学习之路</span></p>
          <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
        
      </div>
    
    
      <div class="social-wrapper">
        
          
            <a href="/atom.xml"
              class="social fas fa-rss flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
              
            </a>
          
        
          
            <a href="mailto:me@xxx.com"
              class="social fas fa-envelope flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
              
            </a>
          
        
          
            <a href="https://github.com/yuang01/hexo-theme-bamboo"
              class="social fab fa-github flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
              
            </a>
          
        
          
            <a href="tencent://AddContact/?fromId=50&amp;fromSubId=1&amp;subcmd=all&amp;uin=你的qq号码"
              class="social fab fa-qq flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
              
            </a>
          
        
      </div>
    
  </div>
</section>

    
  
  
  

  <div class="layout_sticky">    
    
      
<section class="widget side_toc">
  
  <header>
    
      <i style="color: " class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name' style="color: ">本文目录</span>
    
  </header>


  <div class='content'>
    <div class="toc-main">
      <div class="toc-content">
        <!-- <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1%E9%85%8D%E7%BD%AEpom%E6%96%87%E4%BB%B6"><span class="toc-text">1.1配置pom文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2%E7%BC%96%E5%86%99mybatis%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">1.2编写mybatis的配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3%E4%BB%8Exml%E4%B8%AD%E6%9E%84%E5%BB%BAsqlsessionFactory"><span class="toc-text">1.3从xml中构建sqlsessionFactory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-UserMapper"><span class="toc-text">1.4 UserMapper</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E5%8F%82%E6%95%B0%E8%BF%87%E5%A4%9A%E9%97%AE%E9%A2%98"><span class="toc-text">1.5 参数过多问题</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E5%9C%A8%E6%8E%A5%E5%8F%A3%E4%BC%A0%E5%85%A5%E7%9A%84%E5%8F%82%E6%95%B0%E8%BF%87%E5%A4%9A%E6%97%B6%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%94%A8Map%E6%9D%A5%E5%B0%81%E8%A3%85%E6%95%B0%E6%8D%AE"><span class="toc-text">如果在接口传入的参数过多时，可以用Map来封装数据</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90"><span class="toc-text">1.6配置解析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%881%EF%BC%89Environments%EF%BC%9AMyBatis-%E5%8F%AF%E4%BB%A5%E9%85%8D%E7%BD%AE%E6%88%90%E9%80%82%E5%BA%94%E5%A4%9A%E7%A7%8D%E7%8E%AF%E5%A2%83%EF%BC%8C%E4%B8%8D%E8%BF%87%E8%A6%81%E8%AE%B0%E4%BD%8F%EF%BC%9A%E5%B0%BD%E7%AE%A1%E5%8F%AF%E4%BB%A5%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AA%E7%8E%AF%E5%A2%83%EF%BC%8C%E4%BD%86%E6%AF%8F%E4%B8%AA-SqlSessionFactory-%E5%AE%9E%E4%BE%8B%E5%8F%AA%E8%83%BD%E9%80%89%E6%8B%A9%E4%B8%80%E7%A7%8D%E7%8E%AF%E5%A2%83%E3%80%82"><span class="toc-text">（1）Environments：MyBatis 可以配置成适应多种环境，不过要记住：尽管可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%882%EF%BC%89transactionManager%EF%BC%9A%E5%9C%A8-MyBatis-%E4%B8%AD%E6%9C%89%E4%B8%A4%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8%EF%BC%88jdbc-MANAGED"><span class="toc-text">（2）transactionManager：在 MyBatis 中有两种类型的事务管理器（jdbc,MANAGED)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%883%EF%BC%89DataSource%E6%95%B0%E6%8D%AE%E6%BA%90%EF%BC%9Adruid%E3%80%81dbcp%E3%80%81c3p0"><span class="toc-text">（3）DataSource数据源：druid、dbcp、c3p0</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-properties%EF%BC%88%E5%B1%9E%E6%80%A7%EF%BC%89%EF%BC%9A"><span class="toc-text">(4) properties（属性）：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D%EF%BC%88typeAliases%EF%BC%89"><span class="toc-text">(5)类型别名（typeAliases）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%98%A0%E5%B0%84%E5%99%A8"><span class="toc-text">(6) 映射器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7%E8%A7%A3%E5%86%B3%E5%B1%9E%E6%80%A7%E5%90%8D%E5%92%8C%E5%AD%97%E6%AE%B5%E5%90%8D%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">1.7解决属性名和字段名不一样的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-8%E6%97%A5%E5%BF%97"><span class="toc-text">1.8日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-9%E8%A1%A5%E5%85%85"><span class="toc-text">1.9补充</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8A%A8%E6%80%81sql"><span class="toc-text">1.动态sql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.嵌套查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E4%B8%80%E5%AF%B9%E4%B8%80%E9%A1%B9%E7%9B%AE"><span class="toc-text">2.2  一对一项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%E4%B8%80%E5%AF%B9%E5%A4%9A%E7%9A%84%E9%A1%B9%E7%9B%AE"><span class="toc-text">2.3一对多的项目</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81spring"><span class="toc-text">二、spring</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-IOC%E7%90%86%E8%AE%BA%E6%8E%A8%E8%AE%BA"><span class="toc-text">1.1  IOC理论推论&lt;控制反转&gt;</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-text">1.2依赖注入</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5"><span class="toc-text">(1) 	构造器注入</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-set%E6%96%B9%E6%B3%95%E7%9A%84%E6%B3%A8%E5%85%A5"><span class="toc-text">(2)set方法的注入</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-p%E6%A0%87%E7%AD%BE%E7%9A%84%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%9A%84%E4%BD%BF%E7%94%A8%EF%BC%88set%E6%B3%A8%E5%85%A5%EF%BC%89"><span class="toc-text">(3)p标签的命名空间的使用（set注入）</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-c%E6%A0%87%E7%AD%BE%E7%9A%84%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4-%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-text">(4)c标签的命名空间(构造器)</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-text">1.3bean的作用域</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E5%8D%95%E5%88%97%E6%A8%A1%E5%BC%8F"><span class="toc-text">(1) 单列模式</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">(2)原型模式</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4Bean%E7%9A%84%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="toc-text">1.4Bean的自动装配</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81ssm%E6%95%B4%E5%90%88"><span class="toc-text">三、ssm整合</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81shiro%EF%BC%88Apache%EF%BC%89"><span class="toc-text">四、shiro（Apache）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94-springboot"><span class="toc-text">五.springboot</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-springboot%E7%9A%84%E7%89%B9%E7%82%B9%EF%BC%9A"><span class="toc-text">1.springboot的特点：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-configuration%E6%B3%A8%E8%A7%A3"><span class="toc-text">2.@configuration注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-import%E6%B3%A8%E8%A7%A3"><span class="toc-text">3.@import注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-conditional%E6%B3%A8%E8%A7%A3"><span class="toc-text">4.conditional注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-configurationproperties%E6%B3%A8%E8%A7%A3"><span class="toc-text">5.configurationproperties注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-springboot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-text">6.springboot自动配置原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-lombok"><span class="toc-text">7.lombok</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-dev-tools"><span class="toc-text">8.dev-tools</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-spring-initializr"><span class="toc-text">9.spring-initializr</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-springboot%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-text">10.springboot的核心功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-yaml%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-text">1.yaml的用法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%94%E7%A4%BA"><span class="toc-text">演示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%E3%80%81web%E5%BC%80%E5%8F%91"><span class="toc-text">11、web开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E8%AE%BF%E9%97%AE"><span class="toc-text">1.静态资源的访问</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-welcome%E4%B8%8Efavicon%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-text">2.welcome与favicon的功能</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%AC%A2%E8%BF%8E%E9%A1%B5%E6%94%AF%E6%8C%81"><span class="toc-text">1.欢迎页支持</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-favicon%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">2.favicon的使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%9D%99%E6%80%81%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-text">3.静态配置原理</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-text">3.请求参数的处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%B8%B8%E7%94%A8%E7%9A%84%E6%B3%A8%E8%A7%A3"><span class="toc-text">4.常用的注解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-text">12文件上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#springboot%E9%BB%98%E8%AE%A4%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6"><span class="toc-text">springboot默认处理机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-Redis"><span class="toc-text">13.Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Nosql"><span class="toc-text">1.Nosql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Redis%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85"><span class="toc-text">2.Redis的下载安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81Redis%E7%9A%84%E5%85%A5%E9%97%A8"><span class="toc-text">3、Redis的入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Redis%E6%95%B0%E6%8D%AE%E5%82%A8%E5%AD%98%E7%B1%BB%E5%9E%8B%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-text">4.Redis数据储存类型的介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-String%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">1.String数据类型的操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-String%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8B%93%E5%B1%95%E6%93%8D%E4%BD%9C"><span class="toc-text">2.String类型数据的拓展操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-String%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">3.String类型的应用场景</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-hash%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="toc-text">4.hash类型的数据操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-list%E7%B1%BB%E5%9E%8B"><span class="toc-text">5.list类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-list%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8B%93%E5%B1%95%E6%93%8D%E4%BD%9C"><span class="toc-text">6.list数据的拓展操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-list%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">7.list的注意事项</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-set%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AD%98%E5%82%A8%EF%BC%88%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8%EF%BC%89"><span class="toc-text">8.set数据的存储（双向链表）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-redis%E7%9A%84Hash%E9%83%A8%E5%88%86"><span class="toc-text">9.redis的Hash部分</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-zset%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88"><span class="toc-text">10.zset有序集合</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%B6%88%E6%81%AF%E7%9A%84%E8%AE%A2%E9%98%85%E4%B8%8E%E5%8F%91%E5%B8%83"><span class="toc-text">5.消息的订阅与发布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%96%B0%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">6.新数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-jedis"><span class="toc-text">7.jedis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-jedis%E7%9A%84%E8%BF%9E%E6%8E%A5redis"><span class="toc-text">1.jedis的连接redis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-jedis%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="toc-text">2.jedis的代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%A8%A1%E6%8B%9F%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9A%84%E5%8F%91%E9%80%81"><span class="toc-text">3.模拟手机验证码的发送</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E4%BA%8B%E5%8A%A1%E5%92%8C%E9%94%81%E7%9A%84%E6%9C%BA%E5%88%B6"><span class="toc-text">5.事务和锁的机制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%A6%82%E5%BF%B5%EF%BC%9A%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%8B%E5%8A%A1%EF%BC%9F"><span class="toc-text">1.概念：什么是事务？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81"><span class="toc-text">6.乐观锁和悲观锁</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E6%A6%82%E5%BF%B5"><span class="toc-text">1.概念</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-text">案例：乐观锁</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%A8%A1%E6%8B%9F%E7%A7%92%E6%9D%80"><span class="toc-text">6.模拟秒杀</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-redis%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E6%93%8D%E4%BD%9C"><span class="toc-text">7.redis的持久化操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-text">1.持久化的概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">2.持久化的方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-RDB%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">3.RDB是什么</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-RDB%E8%BF%9B%E8%A1%8C%E5%A4%87%E4%BB%BD"><span class="toc-text">4.RDB进行备份</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#5-redis%E7%9A%84%E9%85%8D%E7%BD%AE-Redis%E6%95%B0%E6%8D%AE%E9%9A%94%E6%97%B6%E6%8B%B7%E8%B4%9D%E5%88%B0dump-rdb"><span class="toc-text">5.redis的配置 Redis数据隔时拷贝到dump.rdb</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-AOF%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">5.AOF的持久化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">8.主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">1.为什么需要主从复制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%BB%E5%A4%9A%E4%BB%8E"><span class="toc-text">2.搭建一主多从</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E8%96%AA%E7%81%AB%E7%9B%B8%E4%BC%A0"><span class="toc-text">3.薪火相传</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%8F%8D%E5%AE%A2%E4%B8%BA%E4%B8%BB"><span class="toc-text">4.反客为主</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E8%AE%BE%E7%BD%AE%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F"><span class="toc-text">5.设置哨兵模式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E5%BB%B6%E8%BF%9F%E5%A4%8D%E5%88%B6"><span class="toc-text">1.延迟复制</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-redis%E7%9A%84%E9%9B%86%E7%BE%A4"><span class="toc-text">9.redis的集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-redis%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F"><span class="toc-text">10.redis缓存穿透</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-redis%E5%87%BB%E7%A9%BF"><span class="toc-text">15.redis击穿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16%E3%80%81redis%E9%9B%AA%E5%B4%A9"><span class="toc-text">16、redis雪崩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17-redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="toc-text">17.redis分布式锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18%E3%80%81redis%E7%9A%84%E4%BA%8B%E5%8A%A1"><span class="toc-text">18、redis的事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis%E5%93%A8%E5%85%B5-sentinel"><span class="toc-text">redis哨兵(sentinel)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">1、是什么</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E8%83%BD%E5%B9%B2%E5%98%9B%EF%BC%9F"><span class="toc-text">2.能干嘛？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-springboot%E9%9B%86%E6%88%90Redis%E4%BD%BF%E7%94%A8"><span class="toc-text">14.springboot集成Redis使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E5%8E%9F%E7%94%9F%E6%B3%A8%E8%A7%A3%E7%9A%84%E6%B3%A8%E5%85%A5"><span class="toc-text">14.原生注解的注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8E%9F%E7%94%9F%E7%9A%84servlet%E3%80%81Listener%E3%80%81filter%E7%9A%84%E6%B3%A8%E5%85%A5"><span class="toc-text">1.原生的servlet、Listener、filter的注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-spring%E6%B3%A8%E5%85%A5%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">2.spring注入的方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15%E3%80%81druid%E6%95%B0%E6%8D%AE%E6%BA%90%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">15、druid数据源的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-springboot%E6%95%B4%E5%90%88%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8A%80%E6%9C%AF%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">1.springboot整合第三方技术的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%B4%E5%90%88"><span class="toc-text">2.自定义整合</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%BC%95%E5%85%A5%E5%AF%B9%E5%BA%94%E7%9A%84%E5%9C%BA%E6%99%AF%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">3.引入对应的场景的方式</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E7%BC%93%E5%AD%98"><span class="toc-text">15.缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%BE%9D%E8%B5%96%E5%AF%BC%E5%85%A5"><span class="toc-text">1.依赖导入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%90%86%E8%AE%BA"><span class="toc-text">2.理论</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%87%A0%E4%B8%AA%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5-%E7%BC%93%E5%AD%98%E6%B3%A8%E8%A7%A3%EF%BC%9A"><span class="toc-text">3.几个重要概念&amp;缓存注解：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E7%BC%93%E5%AD%98%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">4.缓存的使用</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-actuator%E7%9B%91%E6%8E%A7"><span class="toc-text">16.actuator监控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-spring%E5%AE%89%E5%85%A8%E6%A1%86%E6%9E%B6"><span class="toc-text">17.spring安全框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-dubbo"><span class="toc-text">18.dubbo</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1dubbo%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-text">2.1dubbo的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2dubbo%E9%85%8D%E7%BD%AE"><span class="toc-text">2.2dubbo配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3dubbo%E7%9B%91%E6%8E%A7"><span class="toc-text">2.3dubbo监控</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD-springcloud"><span class="toc-text">六.springcloud</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1%E6%90%AD%E5%BB%BAeureka%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">1.1搭建eureka服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2eureka%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C"><span class="toc-text">1.2eureka的服务注册</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="toc-text">1.3微服务的远程调用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4eureka%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0"><span class="toc-text">1.4eureka的服务发现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5eureka%E7%9A%84%E9%9A%8F%E6%9C%BA%E8%AE%BF%E9%97%AE%E5%AE%9E%E4%BE%8B"><span class="toc-text">1.5eureka的随机访问实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6Ribbon%E7%9A%84%E9%A5%A5%E9%A5%BF%E5%8A%A0%E8%BD%BD"><span class="toc-text">1.6Ribbon的饥饿加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-nacos%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-text">2 nacos注册中心</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1nacos%E7%9A%84%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">2.1nacos的快速入门</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2nacos%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%88%86%E7%BA%A7%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B"><span class="toc-text">2.2nacos的服务分级存储模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-nacos-namespace%E7%8E%AF%E5%A2%83%E9%9A%94%E7%A6%BB"><span class="toc-text">2.4  nacos  namespace环境隔离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5nacos%E4%B8%8Eeureka%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-text">2.5nacos与eureka的对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-nacos%E7%9A%84%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86"><span class="toc-text">2.6 nacos的配置管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-nacos%E7%9A%84%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E8%AF%BB%E5%8F%96"><span class="toc-text">2.7 nacos的服务配置读取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8nacos%E9%85%8D%E7%BD%AE%E7%83%AD%E6%9B%B4%E6%96%B0"><span class="toc-text">2.8nacos配置热更新</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-7nacos%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB"><span class="toc-text">2.7nacos多环境配置共享</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-8-nacos%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA"><span class="toc-text">2.8 nacos的服务搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-9-feign%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="toc-text">2.9 feign的远程调用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-0-feign%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE"><span class="toc-text">3.0 feign的自定义配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%EF%BC%88level%EF%BC%89"><span class="toc-text">1.日志配置（level）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%93%8D%E5%BA%94%E7%BB%93%E6%9E%9C%E7%9A%84%E8%A7%A3%E6%9E%90%E5%99%A8%EF%BC%88decoder%EF%BC%89"><span class="toc-text">2.响应结果的解析器（decoder）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E7%9A%84%E7%BC%96%E7%A0%81%EF%BC%88Encoder%EF%BC%89"><span class="toc-text">3.请求参数的编码（Encoder）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%94%AF%E6%8C%81%E6%B3%A8%E8%A7%A3%E7%9A%84%E6%A0%BC%E5%BC%8F%EF%BC%88%E5%A5%91%E7%BA%A6%E9%85%8D%E7%BD%AE-contract%EF%BC%89"><span class="toc-text">4.支持注解的格式（契约配置 contract）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%A4%B1%E8%B4%A5%E9%87%8D%E8%AF%95%E6%9C%BA%E5%88%B6-Retryer"><span class="toc-text">5.失败重试机制(Retryer)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E9%85%8D%E7%BD%AEfeign%E7%9A%84%E6%97%A5%E5%BF%97"><span class="toc-text">6.配置feign的日志</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1feign%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-text">3.1feign的性能优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-feign%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-text">3.2 feign的最佳实践</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3%E7%BD%91%E5%85%B3%E7%9A%84%E4%BD%9C%E7%94%A8%E4%BB%8B%E7%BB%8D"><span class="toc-text">3.3网关的作用介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E6%90%AD%E5%BB%BA%E7%BD%91%E5%85%B3"><span class="toc-text">3.3.1  搭建网关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E8%B7%AF%E7%94%B1%E7%9A%84%E6%96%AD%E8%A8%80%E5%B7%A5%E5%8E%82"><span class="toc-text">2.1 路由的断言工厂</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E8%B7%AF%E7%94%B1%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">2.2路由的过滤器配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3%E5%85%A8%E5%B1%80%E8%BF%87%E6%BB%A4%E5%99%A8-globalFilter"><span class="toc-text">2.3全局过滤器(globalFilter)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE%E6%89%A7%E8%A1%8C%E7%9A%84%E9%A1%BA%E5%BA%8F"><span class="toc-text">2.4过滤器链执行的顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-text">2.5跨域问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-docker"><span class="toc-text">4.docker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-docker%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="toc-text">1.docker的概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-docker%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E5%B7%AE%E5%88%AB"><span class="toc-text">2.docker与虚拟机的差别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%9C%A8Linux%E4%B8%AD%E5%AE%89%E8%A3%85docker"><span class="toc-text">3.在Linux中安装docker</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%89%88%E6%9C%AC%E8%A6%81%E6%B1%82"><span class="toc-text">1.版本要求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%8D%B8%E8%BD%BD%E4%B9%8B%E5%89%8D%E7%9A%84docker"><span class="toc-text">2..卸载之前的docker</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%85docker"><span class="toc-text">3.安装docker</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%90%AF%E5%8A%A8docker"><span class="toc-text">4.启动docker</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E9%85%8D%E7%BD%AE%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-text">5.配置镜像加速</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Centos%E5%AE%89%E8%A3%85DockerCompose"><span class="toc-text">3.Centos安装DockerCompose</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%B8%8B%E8%BD%BD"><span class="toc-text">1.下载</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-text">2.修改文件的权限</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-base%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">3.base自动补全命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-docker%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"><span class="toc-text">3.docker镜像仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%AE%80%E5%8C%96%E7%89%88%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"><span class="toc-text">1.简化版镜像仓库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%B8%A6%E6%9C%89%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E7%89%88%E6%9C%AC"><span class="toc-text">2.带有图形化界面版本</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%85%8D%E7%BD%AEdocker%E4%BF%A1%E4%BB%BB%E5%9C%B0%E5%9D%80"><span class="toc-text">3.配置docker信任地址</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-docker%E7%9A%84%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8"><span class="toc-text">4.docker的命令使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="toc-text">5.拉取镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%B0%86%E9%95%9C%E5%83%8F%E4%BF%9D%E5%AD%98%E5%88%B0%E7%A3%81%E7%9B%98%E4%B8%BA%E5%8E%8B%E7%BC%A9%E5%8C%85"><span class="toc-text">5.将镜像保存到磁盘为压缩包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%B0%86%E7%A1%AC%E7%9B%98%E4%B8%8A%E7%9A%84%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%8F%98%E6%88%90%E9%95%9C%E5%83%8F"><span class="toc-text">6.将硬盘上的压缩包变成镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F"><span class="toc-text">7.删除镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E5%AE%B9%E5%99%A8%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">8.容器的操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-text">9、数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%8D%B7%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">1.数据卷的基本使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%95%B0%E6%8D%AE%E5%8D%B7%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">2.数据卷的使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%95%B0%E6%8D%AE%E5%8D%B7%E6%8C%82%E8%BD%BD%E5%88%B0%E5%AE%B9%E5%99%A8"><span class="toc-text">3.数据卷挂载到容器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E8%87%AA%E5%AE%9A%E4%B9%89docker"><span class="toc-text">10.自定义docker</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-docker%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-text">1.docker的结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%9E%84%E5%BB%BAdocker%E9%95%9C%E5%83%8F"><span class="toc-text">2.构建docker镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%85DockerCompose"><span class="toc-text">3.安装DockerCompose</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-MQ"><span class="toc-text">5.MQ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%90%8C%E6%AD%A5%E9%80%9A%E8%AE%AF"><span class="toc-text">1.同步通讯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%BC%82%E6%AD%A5%E9%80%9A%E8%AE%AF"><span class="toc-text">2.异步通讯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-MQ%E5%B8%B8%E8%A7%81%E7%9A%84%E6%A1%86%E6%9E%B6"><span class="toc-text">3.MQ常见的框架</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-RabbitMQ%E7%9A%84%E5%87%A0%E4%B8%AA%E6%A6%82%E5%BF%B5"><span class="toc-text">4.RabbitMQ的几个概念</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%B6%88%E6%81%AF%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-text">5.消息模型的介绍</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97"><span class="toc-text">RabbitMQ部署指南</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2"><span class="toc-text">1.单机部署</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F"><span class="toc-text">1.1.下载镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-%E5%AE%89%E8%A3%85MQ"><span class="toc-text">1.2.安装MQ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2"><span class="toc-text">2.集群部署</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E9%9B%86%E7%BE%A4%E5%88%86%E7%B1%BB"><span class="toc-text">2.1.集群分类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E8%AE%BE%E7%BD%AE%E7%BD%91%E7%BB%9C"><span class="toc-text">2.2.设置网络</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#springAMQP"><span class="toc-text">springAMQP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#workQueue"><span class="toc-text">workQueue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#springAMQP%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85"><span class="toc-text">springAMQP发布订阅</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#springAMQP%E6%B6%88%E6%81%AF%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-text">springAMQP消息转换器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ampqAdmin"><span class="toc-text">ampqAdmin</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E9%85%8D%E7%BD%AE"><span class="toc-text">1.配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="toc-text">2.创建交换机</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA%E9%98%9F%E5%88%97"><span class="toc-text">3.创建队列</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E7%BB%91%E5%AE%9A%E9%98%9F%E5%88%97%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%88%96%E8%80%85%E6%98%AF%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%BB%91%E5%AE%9A"><span class="toc-text">4.绑定队列与交换机或者是交换机与交换机绑定</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%B6%88%E6%81%AF%E7%9A%84%E5%8F%91%E9%80%81"><span class="toc-text">5.消息的发送</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-mq%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">6.mq序列化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-%E6%B6%88%E6%81%AF%E7%9A%84%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6"><span class="toc-text">7.消息的确认机制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF"><span class="toc-text">8消费消息</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-elasticSeach"><span class="toc-text">6.elasticSeach</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%AE%80%E4%BB%8B"><span class="toc-text">1.简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%AD%A3%E5%90%91%E7%B4%A2%E5%BC%95"><span class="toc-text">2.正向索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-text">3.倒排索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E7%B4%A2%E5%BC%95"><span class="toc-text">4.索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%AE%89%E8%A3%85elasticsearch"><span class="toc-text">5. 安装elasticsearch</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="toc-text">1.拉取镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89%E7%9A%84%E7%BD%91%E7%BB%9C"><span class="toc-text">2.创建用户定义的网络</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E8%BF%90%E8%A1%8Ces"><span class="toc-text">3.运行es</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E8%AE%BF%E9%97%AE"><span class="toc-text">4.访问</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E9%83%A8%E7%BD%B2kibana"><span class="toc-text">6.部署kibana</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F-1"><span class="toc-text">1.拉取镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8es%E7%9A%84%E7%BD%91%E7%BB%9C%E6%AE%B5"><span class="toc-text">2.使用es的网络段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E8%AE%BF%E9%97%AE"><span class="toc-text">3.访问</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%A8%A1%E6%8B%9F%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><span class="toc-text">4.模拟发送请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E5%AE%89%E8%A3%85ik%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text">5.安装ik分词器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#cat"><span class="toc-text">_cat</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-text">6.创建索引库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-%E7%B4%A2%E5%BC%95%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">7.索引库的操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-%E6%96%87%E6%A1%A3%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-text">8.文档的基本操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-restclient%E6%93%8D%E4%BD%9C%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-text">7.restclient操作索引库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%A4%8D%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-text">4.复合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%81%9A%E5%90%88"><span class="toc-text">5.聚合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-swagger"><span class="toc-text">7.swagger</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BD%9C%E7%94%A8"><span class="toc-text">1.作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BC%98%E7%82%B9"><span class="toc-text">2.优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BE%9D%E8%B5%96"><span class="toc-text">3.依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-swagger%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-text">4.swagger配置类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%82%E6%AD%A5%E7%BC%96%E6%8E%92"><span class="toc-text">8.多线程异步编排</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%88%9B%E5%BB%BA%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-text">1.多线程创建的几种方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="toc-text">2. 线程池</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%BC%82%E6%AD%A5%E7%BC%96%E6%8E%92"><span class="toc-text">3.异步编排</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#workQueue-1"><span class="toc-text">workQueue</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%844%E4%B8%AD%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97"><span class="toc-text">常见的4中阻塞队列</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#netty"><span class="toc-text">netty</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sentinel"><span class="toc-text">sentinel</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%9B%AA%E5%B4%A9%E9%97%AE%E9%A2%98"><span class="toc-text">微服务的雪崩问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E6%B5%81"><span class="toc-text">限流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%B5%81%E6%8E%A7%E6%A8%A1%E5%BC%8F"><span class="toc-text">1.流控模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E9%9A%94%E7%A6%BB"><span class="toc-text">线程隔离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%86%94%E6%96%AD%E4%B8%8E%E9%99%8D%E7%BA%A7"><span class="toc-text">熔断与降级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%BA%94%E7%94%A8%E6%8E%A5%E5%85%A5%E6%9C%AC%E5%9C%B0%E6%8E%A7%E5%88%B6%E5%8F%B0"><span class="toc-text">本地应用接入本地控制台</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83-%E9%85%8D%E7%BD%AEgit"><span class="toc-text">七 配置git</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#poi"><span class="toc-text">poi</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96word%E6%96%87%E6%A1%A3"><span class="toc-text">读取word文档</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E4%BE%9D%E8%B5%96"><span class="toc-text">1、依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BB%A3%E7%A0%81%E6%BC%94%E4%B9%89"><span class="toc-text">2.代码演义</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#apach-%E3%80%81hutool%E3%80%81restemplate%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><span class="toc-text">apach 、hutool、restemplate发送请求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BD%BF%E7%94%A8hutool%E5%8F%91%E8%B5%B7get%E8%AF%B7%E6%B1%82"><span class="toc-text">1、使用hutool发起get请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%B8%A6%E6%9C%89%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="toc-text">1.1 带有请求头</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-apach-%E8%AF%B7%E6%B1%82"><span class="toc-text">2.apach 请求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81post%E8%AF%B7%E6%B1%82"><span class="toc-text">1、post请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get-%E8%AF%B7%E6%B1%82"><span class="toc-text">get 请求</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#minio"><span class="toc-text">minio</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="toc-text">1、拉取镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8"><span class="toc-text">2、创建容器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%8D%95%E6%9C%BA%E7%89%88%E9%83%A8%E7%BD%B2"><span class="toc-text">2.1 单机版部署</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E9%87%87%E7%94%A8%E7%BA%A0%E5%88%A0%E7%A0%81%E6%A8%A1%E5%BC%8F"><span class="toc-text">2.2 采用纠删码模式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#k8s"><span class="toc-text">k8s</span></a> -->
        <div class="toc"></div>
      </div>
    </div>
  </div>
</section>
<!-- 手机端目录按钮 -->
<div id="toc-mobile-btn">
  <i class="fas fa-list-ul" aria-hidden="true"></i>
</div>

      
  <section class="widget side_recent_post">
    
  <header>
    
      <a style="color: " href='/tags/'><i class="fas fa-book fa-fw" aria-hidden="true"></i><span class='name'>最新文章</span></a>
    
  </header>


    <div class='content'>
      
      <!-- hash算法 -->
      
      <div class="aside-list">
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2025/05/08/hexo/%E5%88%9B%E5%BB%BA%E5%8D%9A%E5%AE%A2/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="https://pic2.zhimg.com/80/v2-e22aaad20d20634f506f57fff0fcbc17_1440w.webp" class="lazyload placeholder" data-srcset="https://pic2.zhimg.com/80/v2-e22aaad20d20634f506f57fff0fcbc17_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">05-08</span>
                
              </div>
              <a class="post-title" href="/2025/05/08/hexo/%E5%88%9B%E5%BB%BA%E5%8D%9A%E5%AE%A2/">创建博客</a>
            </div>
          </div>
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2025/05/08/study/es/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="https://pic2.zhimg.com/80/v2-e22aaad20d20634f506f57fff0fcbc17_1440w.webp" class="lazyload placeholder" data-srcset="https://pic2.zhimg.com/80/v2-e22aaad20d20634f506f57fff0fcbc17_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">05-08</span>
                
              </div>
              <a class="post-title" href="/2025/05/08/study/es/">ES学习</a>
            </div>
          </div>
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2025/05/08/study/linux/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="https://pic2.zhimg.com/80/v2-e22aaad20d20634f506f57fff0fcbc17_1440w.webp" class="lazyload placeholder" data-srcset="https://pic2.zhimg.com/80/v2-e22aaad20d20634f506f57fff0fcbc17_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">05-08</span>
                
              </div>
              <a class="post-title" href="/2025/05/08/study/linux/">Linux指令</a>
            </div>
          </div>
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2025/05/08/study/%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="https://pic3.zhimg.com/80/v2-7cfc909ebe8d83683909846edd6b5232_1440w.webp" class="lazyload placeholder" data-srcset="https://pic3.zhimg.com/80/v2-7cfc909ebe8d83683909846edd6b5232_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">05-08</span>
                
              </div>
              <a class="post-title" href="/2025/05/08/study/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器文档</a>
            </div>
          </div>
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2025/05/08/study/%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="https://picx.zhimg.com/80/v2-85c31120acff76826ab53ea8934ef4bb_1440w.webp" class="lazyload placeholder" data-srcset="https://picx.zhimg.com/80/v2-85c31120acff76826ab53ea8934ef4bb_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">05-08</span>
                
              </div>
              <a class="post-title" href="/2025/05/08/study/%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88/">框架整合</a>
            </div>
          </div>
        
      </div>
    </div>
  </section>

    
  </div>
</aside>

  <!-- 图片放大 Wrap images with fancybox support -->
  <script defer src="/js/wrapImage.js"></script>
</div>

<!-- 文章详情页背景图 -->
<div id="appBgSwiper" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -2;"
	:style="{'background-color': bgColor ? bgColor : 'transparent'}">
	<transition-group tag="ul" :name="names">
		<li v-for='(image,index) in img' :key='index' v-show="index === mark" class="bg-swiper-box">
			<img :src="image" class="bg-swiper-img no-lazy">
		</li>
	</transition-group>
</div>
<script>
	var vm = new Vue({
		el: '#appBgSwiper',
		data: {
			names: '' || 'fade' || 'fade', // translate-fade fade
			mark: 0,
			img: [],
			bgColor: '',
			time: null
		},
		methods: {   //添加方法
			change(i, m) {
				if (i > m) {
					// this.names = 'fade';
				} else if (i < m) {
					// this.names = 'fade';
				} else {
					return;
				}
				this.mark = i;
			},
			prev() {
				// this.names = 'fade';
				this.mark--;
				if (this.mark === -1) {
					this.mark = 3;
					return
				}
			},
			next() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			autoPlay() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			play() {
				let bgImgDelay = '' || '180000'
				let delay = parseInt(bgImgDelay) || 180000;
				this.time = setInterval(this.autoPlay, delay);
			},
			enter() {
				clearInterval(this.time);
			},
			leave() {
				this.play();
			}
		},
		created() {
			this.play()
		},
		beforeDestroy() {
			clearInterval(this.time);
		},
		mounted() {
			let prop = '' || '';
			let isImg = prop.includes('.bmp') || prop.includes('.jpg') || prop.includes('.png') || prop.includes('.tif') || prop.includes('.gif') || prop.includes('.pcx') || prop.includes('.tga') || prop.includes('.exif') || prop.includes('.fpx') || prop.includes('.psd') || prop.includes('.cdr') || prop.includes('.pcd') || prop.includes('.dxf') || prop.includes('.ufo') || prop.includes('.eps') || prop.includes('.ai') || prop.includes('.raw') || prop.includes('.WMF') || prop.includes('.webp') || prop.includes('.jpeg') || prop.includes('http://') || prop.includes('https://')
			if (isImg) {
				let img = prop.split(',');
				let configRoot = '/'
				let arrImg = [];
				img.forEach(el => {
					var Expression = /http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
					var objExp = new RegExp(Expression);

					if (objExp.test(el)) {
						// http or https
						arrImg.push(el);
					} else {
						// 非http or https开头
						// 本地文件
						let firstStr = el.charAt(0);
						if (firstStr == '/') {
							el = el.substr(1); // 删除第一个字符 '/',因为 configRoot最后一个字符为 /
						}
						el = configRoot + el;
						arrImg.push(el);
					}
				})
				this.img = arrImg;
			} else {
				this.bgColor = prop;
			}
		}
	})
</script>

<style>
	.bg-swiper-box {
		position: absolute;
		display: block;
		width: 100%;
		height: 100%;
	}

	.bg-swiper-img {
		object-fit: cover;
		width: 100%;
		height: 100%;
	}
</style>




  <script>
  function loadMermaid() {
    if (document.getElementsByClassName('mermaid').length) {
      if (window.mermaidJsLoad) mermaid.init()
      else {
        loadScript('https://unpkg.com/mermaid/dist/mermaid.min.js').then(() => {
          window.mermaidJsLoad = true
          mermaid.initialize({
            theme: 'default',
          })
          if ('true') {
            mermaid.init();
          }
        })
      }
    }
  };
  document.addEventListener("DOMContentLoaded", function () {
    loadMermaid();
  })

  document.addEventListener('pjax:complete', function () {
    loadMermaid();
  })
  
</script>


      </main>
    </div>

    <!-- 页脚 -->
    
  
  
    <!-- 底部鱼儿跳动效果，依赖于jquery-->
<div id="j-fish-skip" style=" position: relative;height: 153px;width: auto;"></div>
<script defer>
  var RENDERER = {
    POINT_INTERVAL: 5,
    FISH_COUNT: 3,
    MAX_INTERVAL_COUNT: 50,
    INIT_HEIGHT_RATE: .5,
    THRESHOLD: 50,
    FISH_COLOR: '',
    init: function () {
      this.setFishColor(); this.setParameters(), this.reconstructMethods(), this.setup(), this.bindEvent(), this.render()
    },
    setFishColor: function () {
      let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');
      if (isDark) {
        this.FISH_COLOR = '#222'; // 暗黑色，有时间把这整成一个变量
      } else {
        this.FISH_COLOR = '' || 'rgba(66, 185, 133, 0.8)';
      }
    },
    setParameters: function () {
      this.$window = $(window), this.$container = $("#j-fish-skip"), this.$canvas = $("<canvas />"), this.context = this.$canvas.appendTo(this.$container).get(0).getContext("2d"), this.points = [], this.fishes = [], this.watchIds = []
    },
    createSurfacePoints: function () {
      var t = Math.round(this.width / this.POINT_INTERVAL);
      this.pointInterval = this.width / (t - 1), this.points.push(new SURFACE_POINT(this, 0));
      for (var i = 1; i < t; i++) {
        var e = new SURFACE_POINT(this, i * this.pointInterval),
          h = this.points[i - 1];
        e.setPreviousPoint(h), h.setNextPoint(e), this.points.push(e)
      }
    },
    reconstructMethods: function () {
      this.watchWindowSize = this.watchWindowSize.bind(this), this.jdugeToStopResize = this.jdugeToStopResize.bind(this), this.startEpicenter = this.startEpicenter.bind(this), this.moveEpicenter = this.moveEpicenter.bind(this), this.reverseVertical = this.reverseVertical.bind(this), this.render = this.render.bind(this)
    },
    setup: function () {
      this.points.length = 0, this.fishes.length = 0, this.watchIds.length = 0, this.intervalCount = this.MAX_INTERVAL_COUNT, this.width = this.$container.width(), this.height = this.$container.height(), this.fishCount = this.FISH_COUNT * this.width / 500 * this.height / 500, this.$canvas.attr({
        width: this.width,
        height: this.height
      }), this.reverse = !1, this.fishes.push(new FISH(this)), this.createSurfacePoints()
    },
    watchWindowSize: function () {
      this.clearTimer(), this.tmpWidth = this.$window.width(), this.tmpHeight = this.$window.height(), this.watchIds.push(setTimeout(this.jdugeToStopResize, this.WATCH_INTERVAL))
    },
    clearTimer: function () {
      for (; this.watchIds.length > 0;) clearTimeout(this.watchIds.pop())
    },
    jdugeToStopResize: function () {
      var t = this.$window.width(),
        i = this.$window.height(),
        e = t == this.tmpWidth && i == this.tmpHeight;
      this.tmpWidth = t, this.tmpHeight = i, e && this.setup()
    },
    bindEvent: function () {
      this.$window.on("resize", this.watchWindowSize), this.$container.on("mouseenter", this.startEpicenter), this.$container.on("mousemove", this.moveEpicenter)
    },
    getAxis: function (t) {
      var i = this.$container.offset();
      return {
        x: t.clientX - i.left + this.$window.scrollLeft(),
        y: t.clientY - i.top + this.$window.scrollTop()
      }
    },
    startEpicenter: function (t) {
      this.axis = this.getAxis(t)
    },
    moveEpicenter: function (t) {
      var i = this.getAxis(t);
      this.axis || (this.axis = i), this.generateEpicenter(i.x, i.y, i.y - this.axis.y), this.axis = i
    },
    generateEpicenter: function (t, i, e) {
      if (!(i < this.height / 2 - this.THRESHOLD || i > this.height / 2 + this.THRESHOLD)) {
        var h = Math.round(t / this.pointInterval);
        h < 0 || h >= this.points.length || this.points[h].interfere(i, e)
      }
    },
    reverseVertical: function () {
      this.reverse = !this.reverse;
      for (var t = 0, i = this.fishes.length; t < i; t++) this.fishes[t].reverseVertical()
    },
    controlStatus: function () {
      for (var t = 0, i = this.points.length; t < i; t++) this.points[t].updateSelf();
      for (t = 0, i = this.points.length; t < i; t++) this.points[t].updateNeighbors();
      this.fishes.length < this.fishCount && 0 == --this.intervalCount && (this.intervalCount = this.MAX_INTERVAL_COUNT, this.fishes.push(new FISH(this)))
    },
    render: function () {
      requestAnimationFrame(this.render), this.controlStatus(), this.context.clearRect(0, 0, this.width, this.height), this.context.fillStyle = this.FISH_COLOR;
      for (var t = 0, i = this.fishes.length; t < i; t++) this.fishes[t].render(this.context);
      this.context.save(), this.context.globalCompositeOperation = "xor", this.context.beginPath(), this.context.moveTo(0, this.reverse ? 0 : this.height);
      for (t = 0, i = this.points.length; t < i; t++) this.points[t].render(this.context);
      this.context.lineTo(this.width, this.reverse ? 0 : this.height), this.context.closePath(), this.context.fill(), this.context.restore()
    }
  },
  SURFACE_POINT = function (t, i) {
    this.renderer = t, this.x = i, this.init()
  };
  SURFACE_POINT.prototype = {
    SPRING_CONSTANT: .03,
    SPRING_FRICTION: .9,
    WAVE_SPREAD: .3,
    ACCELARATION_RATE: .01,
    init: function () {
      this.initHeight = this.renderer.height * this.renderer.INIT_HEIGHT_RATE, this.height = this.initHeight, this.fy = 0, this.force = {
        previous: 0,
        next: 0
      }
    },
    setPreviousPoint: function (t) {
      this.previous = t
    },
    setNextPoint: function (t) {
      this.next = t
    },
    interfere: function (t, i) {
      this.fy = this.renderer.height * this.ACCELARATION_RATE * (this.renderer.height - this.height - t >= 0 ? -1 : 1) * Math.abs(i)
    },
    updateSelf: function () {
      this.fy += this.SPRING_CONSTANT * (this.initHeight - this.height), this.fy *= this.SPRING_FRICTION, this.height += this.fy
    },
    updateNeighbors: function () {
      this.previous && (this.force.previous = this.WAVE_SPREAD * (this.height - this.previous.height)), this.next && (this.force.next = this.WAVE_SPREAD * (this.height - this.next.height))
    },
    render: function (t) {
      this.previous && (this.previous.height += this.force.previous, this.previous.fy += this.force.previous), this.next && (this.next.height += this.force.next, this.next.fy += this.force.next), t.lineTo(this.x, this.renderer.height - this.height)
    }
  };
  var FISH = function (t) {
    this.renderer = t, this.init()
  };
  FISH.prototype = {
    GRAVITY: .4,
    init: function () {
      this.direction = Math.random() < .5, this.x = this.direction ? this.renderer.width + this.renderer.THRESHOLD : -this.renderer.THRESHOLD, this.previousY = this.y, this.vx = this.getRandomValue(4, 10) * (this.direction ? -1 : 1), this.renderer.reverse ? (this.y = this.getRandomValue(1 * this.renderer.height / 10, 4 * this.renderer.height / 10), this.vy = this.getRandomValue(2, 5), this.ay = this.getRandomValue(.05, .2)) : (this.y = this.getRandomValue(6 * this.renderer.height / 10, 9 * this.renderer.height / 10), this.vy = this.getRandomValue(-5, -2), this.ay = this.getRandomValue(-.2, -.05)), this.isOut = !1, this.theta = 0, this.phi = 0
    },
    getRandomValue: function (t, i) {
      return t + (i - t) * Math.random()
    },
    reverseVertical: function () {
      this.isOut = !this.isOut, this.ay *= -1
    },
    controlStatus: function (t) {
      this.previousY = this.y, this.x += this.vx, this.y += this.vy, this.vy += this.ay, this.renderer.reverse ? this.y > this.renderer.height * this.renderer.INIT_HEIGHT_RATE ? (this.vy -= this.GRAVITY, this.isOut = !0) : (this.isOut && (this.ay = this.getRandomValue(.05, .2)), this.isOut = !1) : this.y < this.renderer.height * this.renderer.INIT_HEIGHT_RATE ? (this.vy += this.GRAVITY, this.isOut = !0) : (this.isOut && (this.ay = this.getRandomValue(-.2, -.05)), this.isOut = !1), this.isOut || (this.theta += Math.PI / 20, this.theta %= 2 * Math.PI, this.phi += Math.PI / 30, this.phi %= 2 * Math.PI), this.renderer.generateEpicenter(this.x + (this.direction ? -1 : 1) * this.renderer.THRESHOLD, this.y, this.y - this.previousY), (this.vx > 0 && this.x > this.renderer.width + this.renderer.THRESHOLD || this.vx < 0 && this.x < -this.renderer.THRESHOLD) && this.init()
    },
    render: function (t) {
      t.save(), t.translate(this.x, this.y), t.rotate(Math.PI + Math.atan2(this.vy, this.vx)), t.scale(1, this.direction ? 1 : -1), t.beginPath(), t.moveTo(-30, 0), t.bezierCurveTo(-20, 15, 15, 10, 40, 0), t.bezierCurveTo(15, -10, -20, -15, -30, 0), t.fill(), t.save(), t.translate(40, 0), t.scale(.9 + .2 * Math.sin(this.theta), 1), t.beginPath(), t.moveTo(0, 0), t.quadraticCurveTo(5, 10, 20, 8), t.quadraticCurveTo(12, 5, 10, 0), t.quadraticCurveTo(12, -5, 20, -8), t.quadraticCurveTo(5, -10, 0, 0), t.fill(), t.restore(), t.save(), t.translate(-3, 0), t.rotate((Math.PI / 3 + Math.PI / 10 * Math.sin(this.phi)) * (this.renderer.reverse ? -1 : 1)), t.beginPath(), this.renderer.reverse ? (t.moveTo(5, 0), t.bezierCurveTo(10, 10, 10, 30, 0, 40), t.bezierCurveTo(-12, 25, -8, 10, 0, 0)) : (t.moveTo(-5, 0), t.bezierCurveTo(-10, -10, -10, -30, 0, -40), t.bezierCurveTo(12, -25, 8, -10, 0, 0)), t.closePath(), t.fill(), t.restore(), t.restore(), this.controlStatus(t)
    }
  }, $(function () {
    RENDERER.init()
    $('.dark').click(function () {
      setTimeout(() => {
        RENDERER.setFishColor();
        RENDERER.context.fill();
      });
    })
  });
</script>
  
  <div class="footer bg-color">
    <div class="footer-main">
      
        
          <div class="link">
            
          </div>
        
      
        
          <div class="footer-copyright">
            <p>Copyright © 2019 - 2020 <a target="_blank" rel="noopener" href="https://github.com/yuang01">yuang01</a> | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/yuang01/theme">Bamboo</a> </p>

          </div>
        
      
        
          <div class="footer-custom">
            
          </div>
        
      
    </div>
  </div>



    <!-- 渲染暗黑按钮 -->
    
      <div class="dark" onclick="toggleDarkMode()">
  <div class="dark-content">
    <i class="fas" id="darkIcon" aria-hidden="true"></i>
  </div>
</div>

<script defer>
  $(function() {
    // 初始化暗黑模式状态
    let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');
    updateDarkModeIcon(isDark);
  });

  function toggleDarkMode() {
    const isDark = $(document.body).hasClass('darkModel');
    $(document.body).toggleClass('darkModel');
    localStorage.setItem('dark', !isDark);
    updateDarkModeIcon(!isDark);
  }

  function updateDarkModeIcon(isDark) {
    const iconElement = document.getElementById('darkIcon');
    if (isDark) {
      iconElement.classList.remove('fa-moon');
      iconElement.classList.add('fa-lightbulb');
    } else {
      iconElement.classList.remove('fa-lightbulb');
      iconElement.classList.add('fa-moon');
    }
  }
</script>

    
    <!-- 渲染回到顶部按钮 -->
    
      <div class="goTop top-btn-color" pointer>
  <i class="fas fa-arrow-up" aria-hidden="true"></i>
</div>
<script defer src="/js/goTop.js"></script>

    
    <!-- 渲染左下角音乐播放器 -->
    
      <link rel="stylesheet" href="/js/aplayer/APlayer@1.10.1.min.css">
<style>
.aplayer .aplayer-lrc p {
  
  font-size: 12px;
  font-weight: 700;
  line-height: 16px !important;
}

.aplayer .aplayer-lrc p.aplayer-lrc-current {
  
  font-size: 15px;
  color: #42b983;
}


.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
  left: -66px !important;
}

.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
  left: 0px !important;
}


</style>
<meting-js  
  class=""
  server="tencent"
  type="playlist"
  id="8062553743"
  fixed='true'
  autoplay='false'
  theme='#42b983'
  loop='all'
  order='random'
  preload='auto'
  volume='0.7'
  list-folded='true'
>
</meting-js>

<!-- <style>
  #aplayer {
    position: fixed;
    left: 0;
    bottom: 300px;
  }
</style> -->
<script defer src="https://unpkg.com/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script defer src="https://unpkg.com/meting@2/dist/Meting.min.js"></script>
    

    <!-- 图片放大 -->
    
      <script src="https://unpkg.com/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>
    

    <!-- 百度解析 -->
    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script async>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <!-- 背景彩带 -->
    
      <script async type="text/javascript" size="100" alpha='0.4' zIndex="-1" src="/js/ribbon.min.js"></script>
    

    <script src="/js/utils/index.js"></script>
    <script src="/js/app.js"></script>
    
    <!-- 文章目录所需js -->
<!-- <link href="/js/tocbot/tocbot.css" rel="stylesheet">
<script src="/js/tocbot/tocbot.min.js"></script> -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.min.js"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.css">

<script>
  var headerEl = 'h2, h3, h4',  //headers 
    content = '.post-detail',//文章容器
    idArr = {};  //标题数组以确定是否增加索引id
  //add #id
  var option = {
    // Where to render the table of contents.
    tocSelector: '.toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: content,
    // Which headings to grab inside of the contentSelector element.
    headingSelector: headerEl,
    scrollSmooth: true,
    scrollSmoothOffset: -70,
    // headingsOffset: -($(window).height() * 0.4 - 45),
    headingsOffset: -($(window).height() * 0.4 - 70),
    // positionFixedSelector: '.toc-main',
    // positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
    activeLinkClass: 'is-active-link',
    orderedList: true,
    collapseDepth: 20,
    // onClick: function (e) {},
  }
  if ($('.toc').length > 0) {

    $(content).children(headerEl).each(function () {
      //去除空格以及多余标点
      var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\：|\，|\。]/g, '');

      headerId = headerId.toLowerCase();
      if (idArr[headerId]) {
        //id已经存在
        $(this).attr('id', headerId + '-' + idArr[headerId]);
        idArr[headerId]++;
      }
      else {
        //id未存在
        idArr[headerId] = 1;
        $(this).attr('id', headerId);
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
      tocbot.init(option);
      mobileTocClick();
    });

  }

  window.tocScrollFn = function () {
    return bamboo.throttle(function () {
      findHeadPosition();
    }, 100)()
  }
  window.addEventListener('scroll', tocScrollFn);

  const findHeadPosition = function (top) {
    if ($('.toc-list').length <= 0) {
      return false;
    }
    setTimeout(() => {  // or DOMContentLoaded 
      autoScrollToc();
    }, 0);
  }

  const autoScrollToc = function () {
    const $activeItem = document.querySelector('.is-active-link');
    const $cardToc = document.querySelector('.toc-content');
    const activePosition = $activeItem.getBoundingClientRect().top
    const sidebarScrollTop = $cardToc.scrollTop
    if (activePosition > (document.documentElement.clientHeight - 100)) {
      $cardToc.scrollTop = sidebarScrollTop + 150
    }
    if (activePosition < 150) {
      $cardToc.scrollTop = sidebarScrollTop - 150
    }
  }

  document.addEventListener('pjax:send', function () {
    if ($('.toc').length) {
      tocbot.destroy();
    }
  });

  document.addEventListener('pjax:complete', function () {
    if ($('.toc').length) {
      tocbot.init(option);
      mobileTocClick();
    }
  });
  
  // 手机端toc按钮点击出现目录
  const mobileTocClick = function () {
    const $cardTocLayout = document.getElementsByClassName('side_toc')[0];
    const $cardToc = $cardTocLayout.getElementsByClassName('toc-content')[0];
    let right = '45px';
    if (window.innerWidth >= 551 && window.innerWidth <= 992) {
      right = '100px'
    }
    const mobileToc = {
      open: () => {
        $cardTocLayout.style.cssText = 'animation: toc-open .3s; opacity: 1; right: ' + right
      },

      close: () => {
        $cardTocLayout.style.animation = 'toc-close .2s'
        setTimeout(() => {
          $cardTocLayout.style.cssText = "opacity:''; animation: ''; right: ''"
        }, 100)
      }
    }
    document.getElementById('toc-mobile-btn').addEventListener('click', () => {
      if (window.getComputedStyle($cardTocLayout).getPropertyValue('opacity') === '0') mobileToc.open()
      else mobileToc.close()
    })

    $cardToc.addEventListener('click', (e) => {
      if (window.innerWidth < 992) { // 小于992px的时候
        mobileToc.close()
      }
    })
  }
</script>

<style>
  /* .is-position-fixed {
    position: sticky !important;
    top: 74px;
  }

  .toc-main ul {
    counter-reset: show-list;
  }

  .toc-main ul li::before {
    content: counter(item)".";
    display: block;
    position: absolute;
    left: 12px;
    top: 0;
  } */
</style>
 

<!-- 设置导航背景 -->
<script>
  let setHeaderClass = () => {
    const nav = $('#navHeader');
    const navTop = nav.outerHeight();
    const winTop = $(window).scrollTop();
    if(winTop > navTop) {
      nav.addClass('header-bg-color');
    }
    else {
      nav.removeClass('header-bg-color');
    }
  };

  let scrollCollect = () => {
    return bamboo.throttle(function (e) {
      setHeaderClass();
    }, 200)()
  }

  let initHeaderBg = () => {
    setHeaderClass();
  }

  setHeaderClass();
  window.addEventListener('scroll', scrollCollect);

  document.addEventListener('pjax:send', function () {
    window.removeEventListener('scroll', scrollCollect)
  })
  document.addEventListener('pjax:complete', function () {
    window.addEventListener('scroll', scrollCollect);
    setHeaderClass();
  })
</script> 

<!-- 渲染issues标签里的内容 -->
<script>
  function loadIssuesJS() {
    if ($(".post-detail").find(".issues-api").length == 0) {
      return;
    } 
    loadScript('/js/issues/index.js');
  };
  $(function () {
    loadIssuesJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof IssuesAPI == "undefined") {
      loadIssuesJS();
    }
  })
</script>

<!-- 渲染远程json加载的图片标签(getPhotoOnline)里的内容 -->
<script>
  function loadPhotoOnlineJS() {
    if ($(".post-detail").find(".getJsonPhoto-api").length == 0) {
      return;
    } 
    loadScript('/js/getPhotoOnline/index.js');
  };
  $(function () {
    loadPhotoOnlineJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof getPhotoJson == "undefined") {
      loadPhotoOnlineJS();
    }
  })
</script>

<!-- 渲染远程json加载的talk标签(getTalkOnline)里的内容 -->
<script>
  function loadTalkOnlineJS() {
    if ($(".post-detail").find(".getJsonTalk-api").length == 0) {
      return;
    } 
    loadScript('https://cdnjs.cloudflare.com/ajax/libs/waterfall.js/1.0.2/waterfall.min.js'); // 瀑布流插件，https://raphamorim.io/waterfall.js/
    loadScript('/js/getTalkOnline/index.js');
  };
  $(function () {
    loadTalkOnlineJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof getTalkJson == "undefined") {
      loadTalkOnlineJS();
    }
  })
</script>

<!-- 渲染远程json加载的site-card标签(getSiteOnline)里的内容 -->
<script>
  function loadSiteOnlineJS() {
    if ($(".post-detail").find(".getJsonSite-api").length == 0) {
      return;
    } 
    loadScript('/js/getSiteOnline/index.js');
  };
  $(function () {
    loadSiteOnlineJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof getSiteJson == "undefined") {
      loadSiteOnlineJS();
    }
  })
</script>

<!-- 输入框打字特效 -->
<!-- 输入框打字特效 -->

  <script src="/js/activate-power-mode.js"></script>
  <script>
    POWERMODE.colorful = true;  // 打开随机颜色特效
    POWERMODE.shake = false;    // 关闭输入框抖动
    document.body.addEventListener('input', POWERMODE);//监听打字事件
  </script>


<!-- markdown代码一键复制功能 -->

  <link rel="stylesheet" href="https://unpkg.com/v-plugs-ayu/lib/ayu.css">
  <script src="https://unpkg.com/v-plugs-ayu/lib/ayu.umd.min.js"></script>
  <script src="/js/clipboard/clipboard.min.js"></script>
  <div id="appCopy">
  </div>
  <script data-pjax>
    var vm = new Vue({
      el: '#appCopy',
      data: {
      },
      computed: {
      },
      mounted() {
        const that = this;
        var copy = 'copy';
        /* code */
        var initCopyCode = function () {
          var copyHtml = '';
          copyHtml += '<button class="btn-copy" data-clipboard-snippet="" style="position:absolute;top:0;right:0;z-index:1;">';
          copyHtml += '<i class="fas fa-copy"></i><span>' + copy + '</span>';
          copyHtml += '</button>';
          $(".post-detail pre").not('.gutter pre').wrap("<div class='codeBox' style='position:relative;width:100%;'></div>")
          $(".post-detail pre").not('.gutter pre').before(copyHtml);
          new ClipboardJS('.btn-copy', {
            target: function (trigger) {
              return trigger.nextElementSibling;
            }
          });
        }
        initCopyCode();
        $('.btn-copy').unbind('click').bind('click', function () {
          doSomething();
        })
        $(document).unbind('keypress').bind('keypress', function (e) {
          if (e.ctrlKey && e.keyCode == 67) {
            doSomething();
          }
        })

        function doSomething() {
          that.$notify({
            title: "成功",
            content: "代码已复制，请遵守相关授权协议。",
            type: 'success'
          })
        }
      },
      methods: {
      },
      created() { }
    })
  </script>
  

<!-- 图片懒加载 -->
<script defer src="https://unpkg.com/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>


<!-- 卡片滚动动画 -->
   

<!-- 评论所需js -->

  
        <script type="text/javascript">
  var utteranceComment = {};

  function check_utterance() {
    let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');
    if (isDark) {
      utteranceComment.Theme = 'github-dark';
    } else {
      utteranceComment.Theme = 'github-light';
    }

    return document.getElementById("gitment-container");
  }
  comment_el = '#gitment-container';
  load_utterance = function () {
    if ($(comment_el).length) {
      // 匿名函数，防止污染全局变量
      const HEAD = check_utterance();

      var utterances = document.createElement('script');
      utterances.type = 'text/javascript';
      utterances.async = true;
      utterances.setAttribute('issue-term', 'pathname')
      utterances.setAttribute('theme', utteranceComment.Theme)
      utterances.setAttribute('repo', '')
      utterances.crossorigin = 'anonymous';
      utterances.src = 'https://utteranc.es/client.js';
      // content 是要插入评论的地方
      document.getElementById('gitment-container').appendChild(utterances);

    }
  }

  function dark_utterance() {
    const HEAD = check_utterance();
    if (!HEAD) return;
    const message = {
      type: 'set-theme',
      theme: utteranceComment.Theme
    };
    const utteranceIframe = document.querySelector('iframe');
    utteranceIframe.contentWindow.postMessage(message, 'https://utteranc.es');
  }

  $(document).ready(load_utterance);
  document.addEventListener('pjax:complete', function () {
    load_utterance();
  });

  $('.dark').click(function () {
    setTimeout(() => {
      dark_utterance();
    });
  })

</script>

<style>
  .utterances {
    max-width: inherit !important;
  }
</style>
      


<!-- 鼠标点击特效 -->
<!-- 爱心点击 -->

  
    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 999; pointer-events: none;" ></canvas>
    <script async src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script async src="/js/cursor/explosion.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" data-pjax></script>


<!-- 轮播图标签 -->
<script>
  var bambooSwiperTag = {};
  function load_swiper() {
    if (!document.querySelectorAll(".post-swiper-container")[0]) return;
    loadCSS("https://unpkg.com/swiper@6/swiper-bundle.min.css")
    loadScript("https://unpkg.com/swiper@6/swiper-bundle.min.js").then(() => {
      pjax_swiper();
    });
  }

  load_swiper();

  function pjax_swiper() {
    bambooSwiperTag.swiper = new Swiper('.post-swiper-container', {
      slidesPerView: 'auto',
      spaceBetween: 8,
      centeredSlides: true,
      loop: true,
      autoplay: true ? {
        delay: 3000,
        stopOnLastSlide: false,
        disableOnInteraction: false,
      } : false,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
      on:{
        init: function(){
          swiperAnimateCache(this); //隐藏动画元素 
          swiperAnimate(this); //初始化完成开始动画
        }, 
        slideChangeTransitionEnd: function(){ 
          swiperAnimate(this); //每个slide切换结束时也运行当前slide动画
          //this.slides.eq(this.activeIndex).find('.ani').removeClass('ani'); 动画只展现一次，去除ani类名
        } 
      }
    });
  }

  document.addEventListener('pjax:complete', function () {
    if (!document.querySelectorAll(".post-swiper-container")[0]) return;
    if (typeof bambooSwiperTag.swiper === "undefined") {
      load_swiper();
    } else {
      pjax_swiper();
    }
  });
</script>
    <!-- pjax -->
    

<!-- pjax -->


  <script src="/js/pjax@0.2.8/index.js"></script>
  
    <div class="pjax-animate">
  
    <div class="loading-circle"><div id="loader-circle"></div></div>
    <script>
      window.ShowLoading = function() {
        $(".loading-circle").css("display", "block");
      };
      window.HideLoading = function() {
        $(".loading-circle").css("display", "none");
      }
    </script>
  
	<script>
    document.addEventListener('pjax:complete', function () {
      window.HideLoading();
    })
    document.addEventListener('pjax:send', function () {
      window.ShowLoading();
    })
    document.addEventListener('pjax:error', function () {
      window.HideLoading();
    })
	</script>
</div>

  

  <script>
    var pjax = new Pjax({
      elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([no-pjax])',   // 拦截正常带链接的 a 标签
      selectors: ["#pjax-container","title"],                                   // 根据实际需要确认重载区域
      cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
      timeout: 5000
    });

    document.addEventListener('pjax:send', function (e) {

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');

    })
    
    document.addEventListener('pjax:complete', function () {
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
    });

    document.addEventListener('pjax:error', function (e) {
      window.location.href = e.triggerElement.href;
    })
    
    // 刷新不从顶部开始
    document.addEventListener("DOMContentLoaded", function () {
      history.scrollRestoration = 'auto';
    })
  </script>



  </body>
</html>